;-----------------------------------------------------------------------------------------
; => Look at threshold conditions for Gary et. al. [1994,1999]
;
; => whistler heat flux instability  = WHFI
; => whistler anisotropy instability = WAI
;
; => Gary et al., [1999] found the whistler heat flux instability (WHFI) to ALWAYS be 
;      unstable if Thperp/Thpara > 1.01 and ALWAYS stable for beta_para,c < 0.25.  
;      Also, Gary et al., [1994] suggested that even when Thpara/Tcpara is small but 
;      Thperp/Thpara > 1.01, the WAI can still be unstable even in the absence of a
;      relative drift between halo and core.
;-----------------------------------------------------------------------------------------

gary_test_0 = (beta_cpar GT 6d-1 AND tanih GT 75d-2) OR  (beta_cpar GT 6d-1 AND tparhc GT 75d-1)
gary_test_1 = (beta_cpar GT 6d-1 AND tanih GT 75d-2) AND (beta_cpar GT 6d-1 AND tparhc GT 75d-1)
gary_test_2 = (beta_cpar GT 6d-1 AND tanih GT 75d-2)
gary_test_3 = (tparhc GT 75d-1)
gary_test_4 = (tanih GT 75d-2)
gary_test_5 = (tanih GT 1.01)
gary_test_6 = (beta_cpar LE 0.25)

'Whistler Only'
;----------------------------------------------------------------------------------------------
;      Date        Time                 Test 0      Test 1      Test 2      Test 3      Test 4
;==============================================================================================
;    1998-08-26/06:41:37.623 UT           1           0           1           0           1
;    1998-08-26/06:41:44.013 UT           1           0           1           0           1
;    1998-08-26/06:41:53.249 UT           1           0           1           0           1
;    1998-08-26/06:41:56.315 UT           1           0           1           0           1
;    1998-08-26/06:41:57.909 UT           1           0           1           0           1
;    1998-08-26/06:41:59.233 UT           1           0           1           0           1
;    1998-08-26/06:42:05.763 UT           1           0           1           0           1
;    1998-08-26/06:42:09.131 UT           1           0           1           0           1
;----------------------------------------------------------------------------------------------
;    2000-02-11/23:34:27.503 UT           0           0           0           0           1
;    2000-02-11/23:34:29.065 UT           0           0           0           0           1
;    2000-02-12/00:14:21.709 UT           1           1           1           1           1
;    2000-02-12/00:26:17.217 UT           1           1           1           1           1
;    2000-02-12/00:27:19.142 UT           1           0           1           0           1
;----------------------------------------------------------------------------------------------


;-----------------------------------------------------------------------------------------
;      Date        Time                 Test 5      Test 6
;=========================================================================================
;    1998-08-26/06:41:37.623 UT           1           0  => UNSTABLE
;    1998-08-26/06:41:44.013 UT           1           0  => UNSTABLE
;    1998-08-26/06:41:53.249 UT           1           0  => UNSTABLE
;    1998-08-26/06:41:56.315 UT           1           0  => UNSTABLE
;    1998-08-26/06:41:57.909 UT           1           0  => UNSTABLE
;    1998-08-26/06:41:59.233 UT           1           0  => UNSTABLE
;    1998-08-26/06:42:05.763 UT           1           0  => UNSTABLE
;    1998-08-26/06:42:09.131 UT           1           0  => UNSTABLE
;-----------------------------------------------------------------------------------------
;    2000-02-11/23:34:27.503 UT           1           0  => UNSTABLE
;    2000-02-11/23:34:29.065 UT           1           0  => UNSTABLE
;    2000-02-12/00:14:21.709 UT           0           0  => STABLE
;    2000-02-12/00:26:17.217 UT           0           0  => STABLE
;    2000-02-12/00:27:19.142 UT           0           0  => STABLE
;-----------------------------------------------------------------------------------------


;----------------------------------------------------------------------------------------------
;      Date        Time                Betaparc        Teh_ani      Th/Tc [para]
;==============================================================================================
;    1998-08-26/06:41:37.623 UT          1.003          1.305          4.651
;    1998-08-26/06:41:44.013 UT          0.894          1.298          4.501
;    1998-08-26/06:41:53.249 UT          0.772          1.297          4.463
;    1998-08-26/06:41:56.315 UT          0.774          1.306          4.324
;    1998-08-26/06:41:57.909 UT          0.747          1.305          4.280
;    1998-08-26/06:41:59.233 UT          0.723          1.300          4.259
;    1998-08-26/06:42:05.763 UT          0.778          1.219          4.405
;    1998-08-26/06:42:09.131 UT          0.938          1.092          4.846
;----------------------------------------------------------------------------------------------
;    2000-02-11/23:34:27.503 UT          0.398          1.645          5.052
;    2000-02-11/23:34:29.065 UT          0.390          1.627          5.180
;    2000-02-12/00:14:21.709 UT          0.749          0.842          8.771
;    2000-02-12/00:26:17.217 UT          1.013          0.760          8.297
;    2000-02-12/00:27:19.142 UT          1.031          0.777          7.267
;----------------------------------------------------------------------------------------------



'Lower-Hybrid Whistler Mix'
;----------------------------------------------------------------------------------------------
;      Date        Time                 Test 0      Test 1      Test 2      Test 3      Test 4
;==============================================================================================
;    1997-12-10/04:33:15.605 UT           1           1           1           1           1
;----------------------------------------------------------------------------------------------
;    1998-08-26/06:40:26.120 UT           1           0           1           0           1
;----------------------------------------------------------------------------------------------
;    1998-09-24/23:20:38.842 UT           0           0           0           0           1
;    1998-09-24/23:22:26.632 UT           0           0           0           0           1
;    1998-09-24/23:22:48.150 UT           0           0           0           0           1
;    1998-09-24/23:30:48.542 UT           0           0           0           0           1
;    1998-09-24/23:45:52.184 UT           0           0           0           0           1
;    1998-09-24/23:45:53.379 UT           0           0           0           1           0
;    1998-09-24/23:48:42.131 UT           0           0           0           0           1
;    1998-09-25/00:05:23.432 UT           1           0           1           1           0
;----------------------------------------------------------------------------------------------
;    2000-02-11/23:33:56.491 UT           1           0           1           0           1
;    2000-02-11/23:33:58.351 UT           1           0           1           0           1
;    2000-02-11/23:34:00.731 UT           1           0           1           0           1
;----------------------------------------------------------------------------------------------

;-----------------------------------------------------------------------------------------
;      Date        Time                 Test 5      Test 6
;=========================================================================================
;    1997-12-10/04:33:15.605 UT           0           0  => STABLE
;-----------------------------------------------------------------------------------------
;    1998-08-26/06:40:26.120 UT           1           0  => UNSTABLE
;-----------------------------------------------------------------------------------------
;    1998-09-24/23:20:38.842 UT           0           1  => STABLE
;    1998-09-24/23:22:26.632 UT           1           1  => STABLE
;    1998-09-24/23:22:48.150 UT           1           1  => STABLE
;    1998-09-24/23:30:48.542 UT           1           0  => UNSTABLE
;    1998-09-24/23:45:52.184 UT           1           0  => UNSTABLE
;    1998-09-24/23:45:53.379 UT           1           0  => UNSTABLE
;    1998-09-24/23:48:42.131 UT           0           0  => STABLE
;    1998-09-25/00:05:23.432 UT           1           0  => UNSTABLE
;-----------------------------------------------------------------------------------------
;    2000-02-11/23:33:56.491 UT           0           0  => STABLE
;    2000-02-11/23:33:58.351 UT           1           0  => UNSTABLE
;    2000-02-11/23:34:00.731 UT           1           0  => UNSTABLE
;-----------------------------------------------------------------------------------------

;----------------------------------------------------------------------------------------------
;          Date        Time                Betaparc        Teh_ani      Th/Tc [para]
;            [Start TDSS]
;==============================================================================================
; => For 1997-12-10/04:33:15.605 UT          0.711          0.828          8.408
; => For 1998-08-26/06:40:26.120 UT          0.736          1.073          7.209
; => For 1998-09-24/23:20:38.842 UT          0.147          0.880          4.879
; => For 1998-09-24/23:22:26.632 UT          0.205          1.753          2.741
; => For 1998-09-24/23:22:48.150 UT          0.205          1.725          2.795
; => For 1998-09-24/23:30:48.542 UT          0.259          1.455          3.062
; => For 1998-09-24/23:45:52.184 UT          0.290          1.013          3.456
; => For 1998-09-24/23:45:53.379 UT          0.283          1.015          3.455
; => For 1998-09-24/23:48:42.131 UT          0.346          0.807          4.195
; => For 1998-09-25/00:05:23.432 UT          0.851          1.013          3.637
; => For 2000-02-11/23:33:56.491 UT          0.823          0.930          7.214
; => For 2000-02-11/23:33:58.351 UT          0.865          1.023          6.872
; => For 2000-02-11/23:34:00.731 UT          0.957          1.105          6.742
;----------------------------------------------------------------------------------------------
;          Date        Time                Betaparc        Teh_ani      Th/Tc [para]
;             [End TDSS]
;==============================================================================================
; => For 1997-12-10/04:33:16.696 UT          0.321          0.873          8.634
; => For 1998-08-26/06:40:27.211 UT          0.841          1.027          6.930
; => For 1998-09-24/23:20:39.933 UT          0.195          0.892          4.830
; => For 1998-09-24/23:22:27.723 UT          0.205          1.752          2.744
; => For 1998-09-24/23:22:49.241 UT          0.205          1.723          2.797
; => For 1998-09-24/23:30:49.633 UT          0.250          1.454          3.063
; => For 1998-09-24/23:45:53.275 UT          0.273          1.015          3.455
; => For 1998-09-24/23:45:54.470 UT          0.298          1.018          3.455
; => For 1998-09-24/23:48:43.222 UT          0.361          0.804          4.203
; => For 1998-09-25/00:05:24.523 UT          0.868          1.013          3.637
; => For 2000-02-11/23:33:57.582 UT          0.905          0.983          7.016
; => For 2000-02-11/23:33:59.442 UT          1.035          1.074          6.727
; => For 2000-02-11/23:34:01.822 UT          0.790          1.133          6.756
;----------------------------------------------------------------------------------------------


'Lower-Hybrid Only'

;----------------------------------------------------------------------------------------------
;      Date        Time                 Test 0      Test 1      Test 2      Test 3      Test 4
;==============================================================================================
;    1998-08-26/06:40:54.941 UT           1           0           1           0           1
;    1998-08-26/06:41:10.001 UT           1           0           1           0           1
;----------------------------------------------------------------------------------------------
;    1998-09-24/23:30:00.465 UT           0           0           0           0           1
;    1998-09-24/23:43:18.951 UT           0           0           0           0           1
;    1998-09-24/23:48:39.020 UT           0           0           0           0           1
;    1998-09-24/23:48:51.622 UT           0           0           0           0           1
;    1998-09-25/00:04:04.545 UT           1           0           1           0           1
;    1998-09-25/00:14:50.603 UT           0           0           0           0           1
;----------------------------------------------------------------------------------------------

;-----------------------------------------------------------------------------------------
;      Date        Time                 Test 5      Test 6
;=========================================================================================
;    1998-08-26/06:40:54.941 UT           1           0  => UNSTABLE
;    1998-08-26/06:41:10.001 UT           1           0  => UNSTABLE
;-----------------------------------------------------------------------------------------
;    1998-09-24/23:30:00.465 UT           1           0  => UNSTABLE
;    1998-09-24/23:43:18.951 UT           0           0  => STABLE
;    1998-09-24/23:48:39.020 UT           0           0  => STABLE
;    1998-09-24/23:48:51.622 UT           0           0  => STABLE
;    1998-09-25/00:04:04.545 UT           1           0  => UNSTABLE
;    1998-09-25/00:14:50.603 UT           1           0  => UNSTABLE
;-----------------------------------------------------------------------------------------

;----------------------------------------------------------------------------------------------
;          Date        Time                Betaparc        Teh_ani      Th/Tc [para]
;            [Start TDSS]
;==============================================================================================
; => For 1998-08-26/06:40:54.941 UT          0.809          1.296          4.952
; => For 1998-08-26/06:41:10.001 UT          0.841          1.196          5.154
; => For 1998-09-24/23:30:00.465 UT          0.260          1.439          3.041
; => For 1998-09-24/23:43:18.951 UT          0.361          0.984          3.778
; => For 1998-09-24/23:48:39.020 UT          0.362          0.816          4.172
; => For 1998-09-24/23:48:51.622 UT          0.388          0.780          4.264
; => For 1998-09-25/00:04:04.545 UT          0.740          1.016          3.626
; => For 1998-09-25/00:14:50.603 UT          0.434          1.143          3.758
;----------------------------------------------------------------------------------------------
;          Date        Time                Betaparc        Teh_ani      Th/Tc [para]
;             [End TDSS]
;==============================================================================================
; => For 1998-08-26/06:40:56.032 UT          0.973          1.397          4.650
; => For 1998-08-26/06:41:11.092 UT          0.746          1.270          5.139
; => For 1998-09-24/23:30:01.556 UT          0.251          1.440          3.042
; => For 1998-09-24/23:43:20.042 UT          0.350          0.980          3.783
; => For 1998-09-24/23:48:40.111 UT          0.359          0.813          4.180
; => For 1998-09-24/23:48:52.713 UT          0.374          0.778          4.268
; => For 1998-09-25/00:04:05.636 UT          0.795          1.016          3.626
; => For 1998-09-25/00:14:51.694 UT          0.462          1.144          3.757
;----------------------------------------------------------------------------------------------



'----------------------------------------------------------------------------------------------'
'Resonance Estimates (from 3DP DFs)                                                            '
'----------------------------------------------------------------------------------------------'
; => Constants and dummy variables
f      = !VALUES.F_NAN
d      = !VALUES.D_NAN
me     = 9.1093897d-31     ; -Electron mass (kg)
mp     = 1.6726231d-27     ; -Proton mass (kg)
mrat   = SQRT(mp/me)

vpara = [7e3,20e3]     ; => Parallel Resonance Velocity determined from tail of 3DP ELB DF
freq  = [1d1,15d0]     ; => Frequency (Hz) [range estimate for f_lh]
rhoe  = [1.3777274,1.2527239]     ; => electron thermal gyroradius (km)

;  [freq, vpara]
;  [  i ,   j  ]
kpara = DBLARR(2,2)    ; => Parallel Wave Number [km^(-1)]
kperp = DBLARR(2,2)    ; => Perpendicular Wave Number [km^(-1)]

FOR j=0L, 1L DO BEGIN                                      $
  kpara[*,j] = (2d0*!DPI*freq)/vpara[j]

print, kpara[*,0], kpara[*,1]
;    0.0089759790     0.013463969
;    0.0031415927    0.0047123890

kperp = mrat[0]*kpara
print, kperp[*,0], kperp[*,1]
;      0.38462387      0.57693580
;      0.13461835      0.20192753

knumb = SQRT(kpara^2 + kperp^2)
print, knumb[*,0], knumb[*,1]
;      0.38472859      0.57709289
;      0.13465501      0.20198251

;  [freq, vpara, rho_e]
;  [  i ,   j  ,   k  ]
kpar_rho = DBLARR(2,2,2)    ; => Parallel Wave Number [electron thermal gyroradii]
kper_rho = DBLARR(2,2,2)    ; => Perpendicular Wave Number [electron thermal gyroradii]
FOR i=0L, 1L DO BEGIN                                      $
  FOR j=0L, 1L DO BEGIN                                    $
    kpar_rho[i,j,*] = kpara[i,j]*rhoe[*]                 & $
    kper_rho[i,j,*] = kperp[i,j]*rhoe[*]

print, kpar_rho[*,*,0]
;     0.012366452     0.018549678
;    0.0043282582    0.0064923874
print, kpar_rho[*,*,1]
;     0.011244424     0.016866636
;    0.0039355483    0.0059033225

print, kper_rho[*,*,0]
;      0.52990684      0.79486026
;      0.18546739      0.27820109
print, kper_rho[*,*,1]
;      0.48182753      0.72274129
;      0.16863963      0.25295945

print, minmax(kpar_rho[*,*,0]), minmax(kpar_rho[*,*,1])
;    0.0043282582     0.018549678
;    0.0039355483     0.016866636
print, minmax(kper_rho[*,*,0]), minmax(kper_rho[*,*,1])
;      0.18546739      0.79486026
;      0.16863963      0.72274129

kper_ra  = minmax(kperp)
kpar_ra  = minmax(kpara)
kn_ra    = minmax(knumb)
vph_perp = DBLARR(2,2)    ; => Perpendicular Phase Speed (km/s)
vph_para = DBLARR(2,2)    ; => Parallel Phase Speed (km/s)
vphase   = DBLARR(2,2)    ; => Total phase speed (km/s)
FOR i=0L, 1L DO BEGIN                                      $
  FOR j=0L, 1L DO BEGIN                                    $
    vph_para[i,j] = (2d0*!DPI*freq[i])/kpar_ra[j]        & $
    vph_perp[i,j] = (2d0*!DPI*freq[i])/kper_ra[j]        & $
    vphase[i,j]   = (2d0*!DPI*freq[i])/kn_ra[j]

print, reform(vph_para)
;       20000.000       30000.000
;       4666.6667       7000.0000
print, reform(vph_perp)
;       466.74063       700.11094
;       108.87650       163.31475
print, reform(vphase)
;       466.61357       699.92035
;       108.87650       163.31475

'----------------------------------------------------------------------------------------------'
'Cold Plasma Estimates                                                                         '
'----------------------------------------------------------------------------------------------'

f0    = 7e0
f1    = 30e0
bo    = [17.65e0,20.07e0]
no    = [14.15e0,21.99e0]
theta = [54.00e0,74.00e0]

cp_f0b0n0th0 = cold_plasma_whistler_params(bo[0],no[0],f0,theta[0])
cp_f0b1n0th0 = cold_plasma_whistler_params(bo[1],no[0],f0,theta[0])
cp_f0b0n1th0 = cold_plasma_whistler_params(bo[0],no[1],f0,theta[0])
cp_f0b0n0th1 = cold_plasma_whistler_params(bo[0],no[0],f0,theta[1])
cp_f0b1n1th0 = cold_plasma_whistler_params(bo[1],no[1],f0,theta[0])
cp_f0b1n0th1 = cold_plasma_whistler_params(bo[1],no[0],f0,theta[1])
cp_f0b1n1th1 = cold_plasma_whistler_params(bo[1],no[1],f0,theta[1])

cp_f1b0n0th0 = cold_plasma_whistler_params(bo[0],no[0],f1,theta[0])
cp_f1b1n0th0 = cold_plasma_whistler_params(bo[1],no[0],f1,theta[0])
cp_f1b0n1th0 = cold_plasma_whistler_params(bo[0],no[1],f1,theta[0])
cp_f1b0n0th1 = cold_plasma_whistler_params(bo[0],no[0],f1,theta[1])
cp_f1b1n1th0 = cold_plasma_whistler_params(bo[1],no[1],f1,theta[0])
cp_f1b1n0th1 = cold_plasma_whistler_params(bo[1],no[0],f1,theta[1])
cp_f1b1n1th1 = cold_plasma_whistler_params(bo[1],no[1],f1,theta[1])


kn_f0b0n0th0 = 2d0*!DPI/cp_f0b0n0th0.WAVE_LENGTH
kn_f0b1n0th0 = 2d0*!DPI/cp_f0b1n0th0.WAVE_LENGTH
kn_f0b0n1th0 = 2d0*!DPI/cp_f0b0n1th0.WAVE_LENGTH
kn_f0b0n0th1 = 2d0*!DPI/cp_f0b0n0th1.WAVE_LENGTH
kn_f0b1n1th0 = 2d0*!DPI/cp_f0b1n1th0.WAVE_LENGTH
kn_f0b1n0th1 = 2d0*!DPI/cp_f0b1n0th1.WAVE_LENGTH
kn_f0b1n1th1 = 2d0*!DPI/cp_f0b1n1th1.WAVE_LENGTH

kn_f1b0n0th0 = 2d0*!DPI/cp_f1b0n0th0.WAVE_LENGTH
kn_f1b1n0th0 = 2d0*!DPI/cp_f1b1n0th0.WAVE_LENGTH
kn_f1b0n1th0 = 2d0*!DPI/cp_f1b0n1th0.WAVE_LENGTH
kn_f1b0n0th1 = 2d0*!DPI/cp_f1b0n0th1.WAVE_LENGTH
kn_f1b1n1th0 = 2d0*!DPI/cp_f1b1n1th0.WAVE_LENGTH
kn_f1b1n0th1 = 2d0*!DPI/cp_f1b1n0th1.WAVE_LENGTH
kn_f1b1n1th1 = 2d0*!DPI/cp_f1b1n1th1.WAVE_LENGTH

kn_f0_range  = [kn_f0b0n0th0,kn_f0b1n0th0,kn_f0b0n1th0,kn_f0b0n0th1,kn_f0b1n1th0,kn_f0b1n0th1,kn_f0b1n1th1]
kn_f1_range  = [kn_f1b0n0th0,kn_f1b1n0th0,kn_f1b0n1th0,kn_f1b0n0th1,kn_f1b1n1th0,kn_f1b1n0th1,kn_f1b1n1th1]

PRINT, minmax(kn_f0_range), minmax(kn_f1_range)
;      0.10417101      0.19200549
;      0.22376267      0.43255379


f0    = 5e0
f1    = 15e0
PRINT, minmax(kn_f0_range), minmax(kn_f1_range)
;     0.087769451      0.16118775
;      0.15441365      0.28899425

f0    = 1e1
f1    = 30e0
PRINT, minmax(kn_f0_range), minmax(kn_f1_range)
;      0.11124845      0.23185468
;      0.22376267      0.43255379


f0    = 5e0
f1    = 30e0
PRINT, minmax(kn_f0_range), minmax(kn_f1_range)
;     0.087769451      0.16118775
;      0.22376267      0.43255379


;----------------------------------------------------------------------------------------------
; => Calculations of Eq. 4 from Coroniti et al., [1982]
;
;  Coroniti, F. V., C. F. Kennel, F. L. Scarf, and E. J. Smith (1982),
;    Whistler mode turbulence in the disturbed solar wind, J. Geophys.
;    Res., 87, 6029–6044, doi:10.1029/JA087iA08p06029.
;----------------------------------------------------------------------------------------------

; => Constants and dummy variables
f      = !VALUES.F_NAN
d      = !VALUES.D_NAN
kB     = 1.3806504d-23     ; -Boltzmann Constant (J/K)
muo    = 4d0*!DPI*1d-7     ; -Permeability of free space (N/A^2 or H/m)
K_eV   = 1.160474d4        ; -Conversion = degree Kelvin/eV
epo    = 8.854187817d-12   ; -Permittivity of free space (F/m)
muo    = 4d0*!DPI*1d-7     ; -Permeability of free space (N/A^2 or H/m)
me     = 9.1093897d-31     ; -Electron mass (kg)
mp     = 1.6726231d-27     ; -Proton mass (kg)
qq     = 1.60217733d-19    ; -Fundamental charge (C)
c      = 2.99792458d8      ; -Speed of light in vacuum (m/s)
c2     = (c*1d-3)^2        ; -" " squared (km/s)^2
me_ev  = 0.5109906d6       ; -Electron mass in eV/c^2
me_3dp = me_ev/c2          ; -Electron mass [eV/(km/s)^2]
mp_ev  = 938.27231d6       ; -Proton mass in eV/c^2
mp_3dp = mp_ev/c2          ; -Proton mass [eV/(km/s)^2]

; => Relevant parameters for the 1998-08-26/06:40:26.120 UT Event
wreal    = [5d0,15d0]*(2d0*!DPI)  ; => SC Frame frequency of observed wave [rad/s]

theta_kB = [54.00e0,74.00e0]*(!DPI/18d1)  ; => Determined from MVA (rad)
theta_kV = [11.00e0,40.00e0]*(!DPI/18d1)  ; => Determined from MVA (rad)

; => Relevant parameters interpolated to 1998-08-26/06:40:26.120 UT and 1998-08-26/06:40:29.120 UT
;      from measurements at 06:40:21.000 UT, 06:40:24.000 UT, and 06:40:27.000 UT
vsw_vec  = TRANSPOSE([[-555.071,-2.777,-69.159],[-635.562,-10.969,-142.438]])        ; => Determined from Wind/3DP
vsw_mg   = SQRT(TOTAL(vsw_vec^2,2,/NAN))
print, vsw_mg
;      559.370      651.420
bo_mg    = [17.645,20.072]    ; => Determined from Wind/MFI
ni_mg    = [14.147,21.989]    ; => Determined from Wind/WAVES-TNR data
te_avg   = [51.970,55.600]

eAlfvenf = 0d0                ; => Factor for "electron Alfven" speed
eAlfvenv = 0d0                ; => "electron Alfven" speed [m/s] (= V_Ae)
vsw_eAlf = 0d0                ; => |Vsw|/(2d0*V_Ae)
wcefac   = 0d0                ; => Factor for electron cyclotron frequency
wcpfac   = 0d0                ; => Factor for proton cyclotron frequency
wpefac   = 0d0                ; => Factor for electron plasma frequency
vtefac   = 0d0                ; => Factor for electron thermal speed
wce      = 0d0                ; => electron cyclotron frequency (rad/s)
wcp      = 0d0                ; => proton cyclotron frequency (rad/s)
wlh      = 0d0                ; => lower hybrid resonance frequency (rad/s)
wpe      = 0d0                ; => electron plasma frequency (rad/s)
vte      = 0d0                ; => electron thermal speed (m/s)
rhoe     = 0d0                ; => electron thermal gyroradius (km)
e_inert  = 0d0                ; => electron inertial length (km)
wr_wce   = DBLARR(2,2)        ; => w_r/w_ce  [real freqs, Bo]

eAlfvenf = 1d-9/SQRT(2d0*muo*me*1d6)
wcefac   = qq*1d-9/me
wcpfac   = qq*1d-9/mp
wpefac   = SQRT(qq^2*1d6/(epo*me))
vtefac   = SQRT(2d0*K_eV*kB/me)

eAlfvenv = eAlfvenf[0]*bo_mg/SQRT(ni_mg)
vsw_eAlf = vsw_mg/(2d0*eAlfvenv*1d-3)
print, eAlfvenv*1d-3, vsw_eAlf
;       3100.4514       2828.9376
;     0.090207792      0.11513509
wce      = wcefac[0]*bo_mg
wcp      = wcpfac[0]*bo_mg
wlh      = SQRT(wce*wcp)
wpe      = wpefac[0]*SQRT(ni_mg)
vte      = vtefac[0]*SQRT(te_avg)
rhoe     = vte*1d-3/wce
e_inert  = c*1d-3/wpe        ; => electron inertial length (km)
print, wce, wpe*1d-3, vte*1d-3, rhoe, e_inert
;       3103.4373       3530.3028
;       212.18943       264.54180
;       4275.6907       4422.4946
;       1.3777274       1.2527239
;       1.4128529       1.1332518

; => Estimate SC-Frame wave numbers from above data
; [wr, Bo/Ni/Vsw, theta_kB, theta_kV]
; [i ,     j    ,    k    ,    m    ]
wr_wce[*,0] = wreal[*]/wce[0]
wr_wce[*,1] = wreal[*]/wce[1]

costhkb     = ABS(COS(theta_kB))
costhkv     = ABS(COS(theta_kV))
costhkb2    = costhkb^2
costhkv2    = costhkv^2

kscframel   = DBLARR(2,2,2,2)   ; => Units of inverse electron inertial lengths
kscframeh   = DBLARR(2,2,2,2)   ; => Units of inverse electron inertial lengths

FOR i=0L, 1L DO BEGIN                                            $
  FOR j=0L, 1L DO BEGIN                                          $
    FOR k=0L, 1L DO BEGIN                                        $
      FOR m=0L, 1L DO BEGIN                                      $
        temp0 = vsw_eAlf[j]*costhkv[m]/costhkb[k]              & $
        temp1 = temp0^2                                        & $
        temp2 = wr_wce[i,j]/costhkb[k]                         & $
        kscframel[i,j,k,m] = -1d0*temp0 + SQRT(temp1 + temp2)  & $
        kscframeh[i,j,k,m] = temp0 + SQRT(temp1 + temp2)

kscframe_el  = DBLARR(2,2,2,2)   ; => [km^(-1)]
kscframe_eh  = DBLARR(2,2,2,2)   ; => [km^(-1)]

FOR j=0L, 1L DO BEGIN                                      $
  kscframe_el[*,j,*,*] = kscframel[*,j,*,*]/e_inert[j]   & $
  kscframe_eh[*,j,*,*] = kscframeh[*,j,*,*]/e_inert[j]

print, minmax(kscframel[0,*,*,*]), minmax(kscframe_el[0,*,*,*])
;     0.035999038     0.064856118
;     0.031766143     0.045904366
print, minmax(kscframel[1,*,*,*]), minmax(kscframe_el[1,*,*,*])
;     0.094757938      0.16526418
;     0.083615964      0.11697196

print, minmax(kscframeh[0,*,*,*]), minmax(kscframe_eh[0,*,*,*])
;      0.29375784      0.85770229
;      0.20791821      0.75685061
print, minmax(kscframeh[1,*,*,*]), minmax(kscframe_eh[1,*,*,*])
;      0.37347190      0.92479248
;      0.26433884      0.81605210


print, minmax(kscframel), minmax(kscframe_el)
;     0.035999038      0.16526418
;     0.031766143      0.11697196
print, minmax(kscframeh), minmax(kscframe_eh)
;      0.29375784      0.92479248
;      0.20791821      0.81605210

;  => k_perp = (M_i/m_e)^(1/2) alpha k_para  [Cairns and McMillan, 2005]
;       where:  0.5 < alpha < 2.0
;
;  Cairns, I. H., and B. F. McMillan (2005), Electron acceleration by 
;    lower hybrid waves in magnetic reconnection regions, Phys. Plasmas, 
;    12, 102,110–+, doi:10.1063/1.2080567.

kscframe_el_low  = kscframe_el/2d0
kscframe_el_high = kscframe_el*2d0

kscframe_eh_low  = kscframe_eh/2d0
kscframe_eh_high = kscframe_eh*2d0

print, minmax(kscframe_el_low), minmax(kscframe_el_high)
;     0.015883072     0.058485982
;     0.063532286      0.23394393
print, minmax(kscframe_eh_low), minmax(kscframe_eh_high)
;      0.10395910      0.40802605
;      0.41583641       1.6321042


;-------------------------------------------------------------------------------------------------
; => Relevant parameters for the 1998-08-26/06:40:26.120 UT Event
;-------------------------------------------------------------------------------------------------
wreal    = [5d0,30d0]*(2d0*!DPI)  ; => SC Frame frequency of observed wave [rad/s]

print, minmax(kscframel[0,*,*,*]), minmax(kscframe_el[0,*,*,*])
;     0.035999038     0.064856118
;     0.031766143     0.045904366
print, minmax(kscframel[1,*,*,*]), minmax(kscframe_el[1,*,*,*])
;      0.16522523      0.28146748
;      0.14463954      0.19921924

print, minmax(kscframeh[0,*,*,*]), minmax(kscframe_eh[0,*,*,*])
;      0.29375784      0.85770229
;      0.20791821      0.75685061
print, minmax(kscframeh[1,*,*,*]), minmax(kscframe_eh[1,*,*,*])
;      0.45984405       1.0115575
;      0.32547199      0.89261495

print, minmax(kscframel), minmax(kscframe_el)
;     0.035999038      0.28146748
;     0.031766143      0.19921924
print, minmax(kscframeh), minmax(kscframe_eh)
;      0.29375784       1.0115575
;      0.20791821      0.89261495

; [wr, Bo/Ni/Vsw, theta_kV,   +/-   ]
; [i ,     j    ,    k    ,    m    ]
kwave_e = [minmax(kscframe_el), minmax(kscframe_eh)]
costhkv = COS(theta_kV)
wplasma = DBLARR(2,2,2,4)
FOR i=0L, 1L DO BEGIN                                            $
  FOR j=0L, 1L DO BEGIN                                          $
    FOR k=0L, 1L DO BEGIN                                        $
      FOR m=0L, 3L DO BEGIN                                      $
        wplasma[i,j,k,m] = wreal[i] - kwave_e[m]*vsw_mg[j]*costhkv[k]

print, minmax(wplasma[*,*,*,0:1]), minmax(wplasma[*,*,*,2:3])
;      -95.975127       174.88370
;      -539.36810       99.402174

print, kwave_e
;     0.031766143      0.19921924      0.20791821      0.89261495
print, minmax(wplasma[*,*,*,0]), minmax(wplasma[*,*,*,1])
;       11.103017       174.88370
;      -95.975127       103.12970
print, minmax(wplasma[*,*,*,2]), minmax(wplasma[*,*,*,3])
;      -101.53769       99.402174
;      -539.36810      -193.99181

print, minmax(wplasma[0,*,*,0]), minmax(wplasma[1,*,*,0])
;       11.103017       17.804068
;       168.18265       174.88370
print, minmax(wplasma[0,*,*,1]), minmax(wplasma[1,*,*,1])
;      -95.975127      -53.949933
;       61.104506       103.12970
print, minmax(wplasma[0,*,*,2]), minmax(wplasma[1,*,*,2])
;      -101.53769      -57.677459
;       55.541938       99.402174
print, minmax(wplasma[0,*,*,3]), minmax(wplasma[1,*,*,3])
;      -539.36810      -351.07145
;      -382.28847      -193.99181


print, minmax(wplasma[*,*,*,0],/POS), minmax(wplasma[*,*,*,1],/POS)
;       11.103017       174.88370
;       61.104506       103.12970
print, minmax(wplasma[*,*,*,2],/POS), minmax(wplasma[*,*,*,3],/POS)
;       55.541938       99.402174
;       0.0000000       0.0000000

;-------------------------------------------------------------------------------------------------
; => wave number estimates from EM cold plasma LHW dispersion
;-------------------------------------------------------------------------------------------------
wreal    = [5d0,30d0]*(2d0*!DPI)  ; => SC Frame frequency of observed wave [rad/s]
kwave_e = [0.0401991d0,0.238247d0]
costhkv = COS(theta_kV)
wplasma = DBLARR(2,2,2,2)
FOR i=0L, 1L DO BEGIN                                            $
  FOR j=0L, 1L DO BEGIN                                          $
    FOR k=0L, 1L DO BEGIN                                        $
      FOR m=0L, 1L DO BEGIN                                      $
        wplasma[i,j,k,m] = wreal[i] - kwave_e[m]*vsw_mg[j]*costhkv[k]

print, minmax(wplasma[*,*,*,0]), minmax(wplasma[*,*,*,1])
;       5.7105492       171.27016
;      -120.93149       86.406222

print, minmax(wplasma[0,*,*,0]), minmax(wplasma[1,*,*,0])
;       5.7105492       14.190528
;       162.79018       171.27016
print, minmax(wplasma[0,*,*,1]), minmax(wplasma[1,*,*,1])
;      -120.93149      -70.673411
;       36.148143       86.406222


;--------------------------------------------------------
; => Now use every permutation of each measured parameter
;--------------------------------------------------------
vsw_vec  = TRANSPOSE([[-555.071,-2.777,-69.159],[-635.562,-10.969,-142.438]])        ; => Determined from Wind/3DP
vsw_mg   = SQRT(TOTAL(vsw_vec^2,2,/NAN))
print, vsw_mg
;      559.370      651.420
theta_kB = [54.00e0,74.00e0]*(!DPI/18d1)  ; => Determined from MVA (rad)
theta_kV = [11.00e0,40.00e0]*(!DPI/18d1)  ; => Determined from MVA (rad)
bo_mg    = [17.645,20.072]    ; => Determined from Wind/MFI
ni_mg    = [14.147,21.989]    ; => Determined from Wind/WAVES-TNR data
te_avg   = [51.970,55.600]

eAlfvenf = 1d-9/SQRT(2d0*muo*me*1d6)
wcefac   = qq*1d-9/me
wcpfac   = qq*1d-9/mp
wpefac   = SQRT(qq^2*1d6/(epo*me))
vtefac   = SQRT(2d0*K_eV*kB/me)

; [Bo, Ni]
; [i , j ]
eAlfvenv = DBLARR(2,2)
eAlfvenv[*,0] = eAlfvenf[0]*bo_mg[*]/SQRT(ni_mg[0])
eAlfvenv[*,1] = eAlfvenf[0]*bo_mg[*]/SQRT(ni_mg[1])
; [Bo, Ni, Vsw]
; [i , j ,  k ]
vsw_eAlf = DBLARR(2,2,2)
FOR i=0L, 1L DO BEGIN                                      $
  FOR j=0L, 1L DO BEGIN                                    $
    vsw_eAlf[i,j,*] = vsw_mg[*]/(2d0*eAlfvenv[i,j]*1d-3)

print, minmax(eAlfvenv)*1d-3, minmax(vsw_eAlf)
;       2486.8774       3526.9062
;     0.079300344      0.13097147

wce      = wcefac[0]*bo_mg
wcp      = wcpfac[0]*bo_mg
wlh      = SQRT(wce*wcp)
wpe      = wpefac[0]*SQRT(ni_mg)
e_inert  = c*1d-3/wpe        ; => electron inertial length (km)
vte      = vtefac[0]*SQRT(te_avg)
; [Bo, Te]
; [i , j ]
rhoe      = DBLARR(2,2)
rhoe[*,0] = vte[0]*1d-3/wce[*]
rhoe[*,1] = vte[1]*1d-3/wce[*]
print, wce, wpe*1d-3, vte*1d-3, minmax(rhoe), e_inert
;       3103.4373       3530.3028
;       212.18943       264.54180
;       4275.6907       4422.4946
;       1.2111399       1.4250311
;       1.4128529       1.1332518

; [wr, Bo]
; [i , j ]
wr_wce      = DBLARR(2,2)        ; => w_r/w_ce  [real freqs, Bo]
wr_wce[*,0] = wreal[*]/wce[0]
wr_wce[*,1] = wreal[*]/wce[1]

costhkb     = ABS(COS(theta_kB))
costhkv     = ABS(COS(theta_kV))

; => Estimate SC-Frame wave numbers from above data
; [wr, Bo, Ni, Vsw, theta_kB, theta_kV]
; [i , j , k ,  l ,     m   ,     n   ]
kscframe  = DBLARR(2,2,2,2,2,2)   ; => Units of inverse electron inertial lengths
FOR i=0L, 1L DO BEGIN                                               $
  FOR j=0L, 1L DO BEGIN                                             $
    FOR k=0L, 1L DO BEGIN                                           $
      FOR l=0L, 1L DO BEGIN                                         $
        FOR m=0L, 1L DO BEGIN                                       $
          temp0 = vsw_eAlf[j,k,l]*costhkv[*]/costhkb[m]           & $
          temp1 = temp0^2                                         & $
          temp2 = wr_wce[i,j]/costhkb[k]                          & $
          kscframe[i,j,k,l,m,*] = temp0 + SQRT(temp1 + temp2[0])


; [wr, Bo, Ni, Vsw, theta_kB, theta_kV, c/wpe]
; [i , j , k ,  l ,     m   ,     n   ,   o  ]
kscframe_e  = DBLARR(2,2,2,2,2,2,2)   ; => [km^(-1)]


FOR j=0L, 1L DO BEGIN                                      $
  kscframe_e[*,*,*,*,*,*,j] = kscframe[*,*,*,*,*,*]/e_inert[j]

print, minmax(kscframe), minmax(kscframe_e)
;      0.26403906       1.0389078
;      0.18688362      0.91674938

;-----------------------------------------------------------------------
;  => k_perp = (M_i/m_e)^(1/2) alpha k_para  [Cairns and McMillan, 2005]
;       where:  0.5 < alpha < 2.0
;
;  Cairns, I. H., and B. F. McMillan (2005), Electron acceleration by 
;    lower hybrid waves in magnetic reconnection regions, Phys. Plasmas, 
;    12, 102,110–+, doi:10.1063/1.2080567.
;-----------------------------------------------------------------------

kscframe_e_low  = kscframe_e/2d0
kscframe_e_high = kscframe_e*2d0

print, minmax(kscframe_e_low), minmax(kscframe_e_high)
;     0.093441808      0.45837469
;      0.37376723       1.8334988


; => Relevant parameters for the 1998-08-26/06:40:26.120 UT Event
wreal    = [5d0,30d0]*(2d0*!DPI)  ; => SC Frame frequency of observed wave [rad/s]

print, minmax(kscframe), minmax(kscframe_e)
;      0.26403906       1.1281757
;      0.18688362      0.99552083

kscframe_e_low  = kscframe_e/2d0
kscframe_e_high = kscframe_e*2d0

print, minmax(kscframe_e_low), minmax(kscframe_e_high)
;     0.093441808      0.49776042
;      0.37376723       1.9910417



'----------------------------------------------------------------------------------------------'
'Specific Filters and corresponding parameters                                                 '
'----------------------------------------------------------------------------------------------'
; => Relevant parameters for the 1998-08-26/06:40:26.120 UT Event 
wreal    = [4d0,20d0]*(2d0*!DPI)  ; => SC Frame frequency of observed wave [rad/s]

theta_kB = [54.37e0,54.37e0]*(!DPI/18d1)  ; => Determined from MVA (rad)
theta_kV = [39.17e0,39.17e0]*(!DPI/18d1)  ; => Determined from MVA (rad)

print, reform(kscframe[0,*,0,0]), reform(kscframe_e[0,*,0,0])
print, reform(kscframe[0,*,0,1]), reform(kscframe_e[0,*,0,1])
print, reform(kscframe[0,*,1,0]), reform(kscframe_e[0,*,1,0])
print, reform(kscframe[0,*,1,1]), reform(kscframe_e[0,*,1,1])
;      0.28831913      0.34216689
;      0.20406875      0.30193369

print, reform(kscframe[1,*,0,0]), reform(kscframe_e[1,*,0,0])
print, reform(kscframe[1,*,0,1]), reform(kscframe_e[1,*,0,1])
print, reform(kscframe[1,*,1,0]), reform(kscframe_e[1,*,1,0])
print, reform(kscframe[1,*,1,1]), reform(kscframe_e[1,*,1,1])
;      0.40974168      0.44405473
;      0.29001015      0.39184120

print, minmax(kscframe), minmax(kscframe_e)
;      0.28831913      0.44405473
;      0.20406875      0.39184120


; => Relevant parameters for the 1998-08-26/06:40:26.120 UT Event 
wreal    = [7d0,30d0]*(2d0*!DPI)  ; => SC Frame frequency of observed wave [rad/s]

theta_kB = [54.07e0,84.18e0]*(!DPI/18d1)  ; => Determined from MVA (rad)
theta_kV = [23.81e0,56.86e0]*(!DPI/18d1)  ; => Determined from MVA (rad)

print, reform(kscframe[0,*,0,0]), reform(kscframe_e[0,*,0,0])
;      0.35024674      0.41071397
;      0.24790035      0.36242077
print, reform(kscframe[0,*,0,1]), reform(kscframe_e[0,*,0,1])
;      0.26071858      0.28819944
;      0.18453342      0.25431193
print, reform(kscframe[0,*,1,0]), reform(kscframe_e[0,*,1,0])
;       1.7095103       2.1351005
;       1.2099705       1.8840478
print, reform(kscframe[0,*,1,1]), reform(kscframe_e[0,*,1,1])
;       1.0997403       1.3335618
;      0.77838271       1.1767568

print, reform(kscframe[1,*,0,0]), reform(kscframe_e[1,*,0,0])
;      0.49176963      0.53053077
;      0.34806853      0.46814908
print, reform(kscframe[1,*,0,1]), reform(kscframe_e[1,*,0,1])
;      0.41656280      0.42741748
;      0.29483805      0.37716022
print, reform(kscframe[1,*,1,0]), reform(kscframe_e[1,*,1,0])
;       1.9369842       2.3059040
;       1.3709737       2.0347676
print, reform(kscframe[1,*,1,1]), reform(kscframe_e[1,*,1,1])
;       1.4003766       1.5756160
;      0.99116941       1.3903495

print, minmax(kscframe), minmax(kscframe_e)
;      0.26071858       2.3059040
;      0.18453342       2.0347676


; => Relevant parameters for the 1998-08-26/06:40:26.120 UT Event 
wreal    = [7d0,30d0]*(2d0*!DPI)  ; => SC Frame frequency of observed wave [rad/s]

theta_kB = [54.07e0,76.27e0]*(!DPI/18d1)  ; => Determined from MVA (rad)
theta_kV = [38.96e0,56.86e0]*(!DPI/18d1)  ; => Determined from MVA (rad)

print, reform(kscframe[0,*,0,0]), reform(kscframe_e[0,*,0,0])
;      0.31560118      0.36354099
;      0.22337865      0.32079455
print, reform(kscframe[0,*,0,1]), reform(kscframe_e[0,*,0,1])
;      0.26071858      0.28819944
;      0.18453342      0.25431193
print, reform(kscframe[0,*,1,0]), reform(kscframe_e[0,*,1,0])
;      0.67900747      0.81852892
;      0.48059318      0.72228338
print, reform(kscframe[0,*,1,1]), reform(kscframe_e[0,*,1,1])
;      0.52853027      0.61564771
;      0.37408726      0.54325767

print, reform(kscframe[1,*,0,0]), reform(kscframe_e[1,*,0,0])
;      0.46275251      0.49060693
;      0.32753056      0.43291963
print, reform(kscframe[1,*,0,1]), reform(kscframe_e[1,*,0,1])
;      0.41656280      0.42741748
;      0.29483805      0.37716022
print, reform(kscframe[1,*,1,0]), reform(kscframe_e[1,*,1,0])
;      0.88140442      0.98320397
;      0.62384726      0.86759536
print, reform(kscframe[1,*,1,1]), reform(kscframe_e[1,*,1,1])
;      0.75465446      0.80859720
;      0.53413519      0.71351947

print, minmax(kscframe), minmax(kscframe_e)
;      0.26071858      0.98320397
;      0.18453342      0.86759536


; => Relevant parameters for the 1998-08-26/06:40:26.120 UT Event 
wreal    = [1d1,3d1]*(2d0*!DPI)  ; => SC Frame frequency of observed wave [rad/s]

theta_kB = [73.73e0,76.03e0]*(!DPI/18d1)  ; => Determined from MVA (rad)
theta_kV = [34.11e0,48.13e0]*(!DPI/18d1)  ; => Determined from MVA (rad)

print, reform(kscframe[0,*,0,0]), reform(kscframe_e[0,*,0,0])
;      0.64518397      0.76369538
;      0.45665332      0.67389737
print, reform(kscframe[0,*,0,1]), reform(kscframe_e[0,*,0,1])
;      0.55906787      0.64679642
;      0.39570140      0.57074380
print, reform(kscframe[0,*,1,0]), reform(kscframe_e[0,*,1,0])
;      0.73314898      0.87408714
;      0.51891387      0.77130888
print, reform(kscframe[0,*,1,1]), reform(kscframe_e[0,*,1,1])
;      0.63158294      0.73670544
;      0.44702668      0.65008100

print, reform(kscframe[1,*,0,0]), reform(kscframe_e[1,*,0,0])
;      0.80311764      0.89374864
;      0.56843684      0.78865850
print, reform(kscframe[1,*,0,1]), reform(kscframe_e[1,*,0,1])
;      0.72771759      0.78986160
;      0.51506961      0.69698687
print, reform(kscframe[1,*,1,0]), reform(kscframe_e[1,*,1,0])
;      0.89870834       1.0089518
;      0.63609477      0.89031571
print, reform(kscframe[1,*,1,1]), reform(kscframe_e[1,*,1,1])
;      0.80957083      0.88620410
;      0.57300433      0.78200108

print, minmax(kscframe), minmax(kscframe_e)
;      0.55906787       1.0089518
;      0.39570140      0.89031571

'----------------------------------------------------------------------------------------------'
'Calculate Particle Diffusion Coefficient                                                      '
'----------------------------------------------------------------------------------------------'

; => Constants and dummy variables
f      = !VALUES.F_NAN
d      = !VALUES.D_NAN
kB     = 1.380658d-23      ; -Boltzmann Constant (J/K)
muo    = 4d0*!DPI*1d-7     ; -Permeability of free space (N/A^2 or H/m)
K_eV   = 1.160474d4        ; -Conversion = degree Kelvin/eV
epo    = 8.854187817d-12   ; -Permittivity of free space (F/m)
muo    = 4d0*!DPI*1d-7     ; -Permeability of free space (N/A^2 or H/m)
me     = 9.1093897d-31     ; -Electron mass (kg)
mp     = 1.6726231d-27     ; -Proton mass (kg)
qq     = 1.60217733d-19    ; -Fundamental charge (C)
c      = 2.99792458d8      ; -Speed of light in vacuum (m/s)
c2     = (c*1d-3)^2        ; -" " squared (km/s)^2
me_ev  = 0.5109906d6       ; -Electron mass in eV/c^2
me_3dp = me_ev/c2          ; -Electron mass [eV/(km/s)^2]
mp_ev  = 938.27231d6       ; -Proton mass in eV/c^2
mp_3dp = mp_ev/c2          ; -Proton mass [eV/(km/s)^2]
beta_fac = 1d6*(kB*K_eV)*(2d0*muo)
wpefac = SQRT(1d6*qq^2/me/epo)
wppfac = SQRT(1d6*qq^2/mp/epo)


no = [14.147d0,21.989d0]*1d6      ; => range of densities [m^(-3)]
bo = [17.6d0,20.1d0]*1d-9         ; => " " ambient B-fields [T]
te = [51.97d0,55.60d0]*K_eV*kB    ; => " " electron temperatures (J)
ti = [48.25d0,80.31d0]*K_eV*kB    ; => " " ion temperatures (J)
wce = qq*bo/me                    ; => " " electron cyclotron frequencies (rad/s)
wcp = qq*bo/mp                    ; => " " proton cyclotron frequencies (rad/s)
wlh = sqrt(wce*wcp)               ; => " " lower hybrid frequencies (rad/s)

print, wce, wcp, wlh
;       3095.5225       3535.2274
;       1.6858742       1.9253449
;       72.240304       82.501711
wpe = SQRT((no*qq^2)/(me*epo))    ; => " " electron plasma frequencies (rad/s)
wpp = SQRT((no*qq^2)/(mp*epo))    ; => " " proton plasma frequencies (rad/s)
vte = SQRT(2d0*te/me)             ; => " " electron thermal speeds (m/s)
vti = SQRT(2d0*ti/mp)             ; => " " proton thermal speeds (m/s)
; => Free parameters:
;      1)  Ti and Te
;      2)  Bo
;  [i,j] = [Temps, B-Fields]
rhoe = vte # (1d0/wce)            ; => " " electron thermal gyroradii (m)
rhoi = vti # (1d0/wcp)            ; => " " proton thermal gyroradii (m)
print, minmax(rhoe)*1d-3, minmax(rhoi)*1d-3
;       1.2094561       1.4286786
;       49.936354       73.576033

date    = '082698'
t       = ['1998-08-26/05:40:00','1998-08-26/07:40:00']  ; -For moment writing
tramp   = '1998-08-26/06:40:24.972'
tr3    = time_double(t)
tura   = time_double(tramp)

mydate = my_str_date(DATE=date)
sdate  = mydate.S_DATE[0]  ; -('MMDDYY')
ldate  = mydate.DATE[0]    ; -('YYYYMMDD')
tdate  = mydate.TDATE[0]   ; => 'YYYY-MM-DD'

sh_mit     = read_shocks_jck_database()
mit_dates  = sh_mit.SDATES                 ; => 'MMDDYY'
shocks     = sh_mit.SHOCK
header     = sh_mit.HEADER
ymdb_ra    = header.DATE_TIME              ; => ['YYYY-MM-DD/HH:MM:SS.sss']
mts        = my_time_string(ymdb_ra,STR=1,FORM=1)
unix_ra    = mts.UNIX

a_ushn     = shocks.USH_N                  ; => Shock normal velocity (Shock-Frame) [km/s]
a_dushn    = shocks.D_USH_N
a_compr    = shocks.COMPRESSION            ; => Shock compression ratio [ = N_i2/N_i1]

gshock     = WHERE(mit_dates EQ date,gsh)
IF (sdate[0] EQ '021100') THEN kk = 1 ELSE kk = 0
midra  = tura
gushn  = (REFORM(a_ushn[gshock[kk]]))[0]
dgushn = (REFORM(a_dushn[gshock[kk]]))[0]
gcomp  = (REFORM(a_compr[gshock[kk]]))[0]
print, gushn, dgushn
;      379.600      3.90000

delta_tra  = 0.287d0                       ; => Time duration of magnetic ramp (s)
ddelta_tra = 0.092d0                       ; => Uncertainty

L_shock    = gushn*delta_tra*1d3           ; => Shock Thickness (m) along normal
dL_shock   = 0d0                           ; => Uncertainty
dL_shock   = L_shock*SQRT((dgushn/gushn)^2 + (ddelta_tra/delta_tra)^2)
print, L_shock*1d-3, dL_shock*1d-3
;       108.94520       34.941133

;----------------------------------------------------------------------------------------------
; => particle diffusion coefficient [LaBelle and Treumann, {1988a} SSR, Eq. 17]
;
;    LaBelle, J. and R.A. Treumann (1988a), Plasma waves at the dayside,
;      magnetopause, Space Sci. Rev., 47, 175-202, doi:10.1007/BF00223240.
;----------------------------------------------------------------------------------------------

; => Free parameters:
;      1)  Ti
;      2)  Te
;      3)  Bo
;      4)  lambda (wavelength)

fact    = 3d0/(16d0*!DPI)*SQRT(me/mp)
bwave   = 18.75d-9                     ; => Wave amplitude (T)
kwave   = [0.13465501d0,0.57709289d0]  ; => Wave number range [km^(-1)]
lambda  = 2d0*!DPI/kwave*1d3           ; => Wavelengths (m)
print, lambda*1d-3
;       46.661356       10.887650

;  [i,j,k,p] = [Ti, Te, Bo, lambda]
diffcoe = DBLARR(2,2,2,2)              ; => particle diffusion coefficient [m^2 s^(-1)]

FOR i=0L, 1L DO BEGIN                                      $
  FOR j=0L, 1L DO BEGIN                                    $
    FOR k=0L, 1L DO BEGIN                                  $
      FOR p=0L, 1L DO BEGIN                                $
        temp0 = ti[i]/te[j]*SQRT(rhoe[j,k]/L_shock[0])   & $
        temp1 = lambda[p]*vte[j]*(bwave[0]/bo[k])^2      & $
        diffcoe[i,j,k,p] = fact[0]*temp0[0]*temp1[0]

print, diffcoe*1d-6
; => Range of particle diffusion coefficients [km^2 s^(-1)]
;       32.969802       54.876783
;       32.417970       53.958284
;
;       23.654178       39.371338
;       23.258267       38.712360
;
;       7.6929539       12.804583
;       7.5641932       12.590266
;
;       5.5193083       9.1866456
;       5.4269290       9.0328843

print, minmax(diffcoe)*1d-6
;       5.4269290       54.876783

e_inert = c/wpe   ; => Electron inertial length (m)
i_inert = c/wpp   ; => Proton inertial length (m)
print, e_inert, i_inert
;       1412.8529       1133.2517
;       60541.246       48560.236

; => Free parameters:
;      1)  Ti
;      2)  Te
;      3)  Bo
;      4)  lambda (wavelength)
;      5)  Ne
diff_time_i = DBLARR(2,2,2,2,2)     ; => Diffusion Time Scale (s) [for ion inertial distances]
diff_time_e = DBLARR(2,2,2,2,2)     ; => Diffusion Time Scale (s) [for electron inertial distances]

diff_time_i[*,*,*,*,0] = i_inert[0]^2/diffcoe[*,*,*,*]
diff_time_i[*,*,*,*,1] = i_inert[1]^2/diffcoe[*,*,*,*]
diff_time_e[*,*,*,*,0] = e_inert[0]^2/diffcoe[*,*,*,*]
diff_time_e[*,*,*,*,1] = e_inert[1]^2/diffcoe[*,*,*,*]

print, minmax(diff_time_e), minmax(diff_time_i)
;     0.023402601      0.36782374
;       42.970750       675.38058
















