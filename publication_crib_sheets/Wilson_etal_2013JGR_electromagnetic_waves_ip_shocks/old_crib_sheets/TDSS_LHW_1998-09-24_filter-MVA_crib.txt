;-----------------------------------------------------------------------------------------
; -Constants
;-----------------------------------------------------------------------------------------
f      = !VALUES.F_NAN
d      = !VALUES.D_NAN
epo    = 8.854187817d-12   ; -Permittivity of free space (F/m)
muo    = 4d0*!DPI*1d-7     ; -Permeability of free space (N/A^2 or H/m)
me     = 9.1093897d-31     ; -Electron mass (kg)
mp     = 1.6726231d-27     ; -Proton mass (kg)
ma     = 4d0*(mp + me)     ; -Alpha-Particle mass (kg)
qq     = 1.60217733d-19    ; -Fundamental charge (C)
kB     = 1.380658d-23      ; -Boltzmann Constant (J/K)
K_eV   = 1.160474d4        ; -Conversion = degree Kelvin/eV
c      = 2.99792458d8      ; -Speed of light in vacuum (m/s)
c2     = (c*1d-3)^2        ; -" " squared (km/s)^2
mm     = [-1d0,0d0,1d0]    ; -[Normal Cyclotron, Landau, Anomalous Cyclotron]
mass_e = 0.5109906d6       ; -Electron mass in eV/c^2
mass_p = mp*c^2/qq         ; -Proton mass in eV/c^2
u_mass = mass_e/c2         ; -Electron mass [eV/(km/s)^2]
p_mass = mass_p/c2         ; -Proton mass [eV/(km/s)^2]
pressc = 1.60217646d-13    ; => Conversion from eV/cm^3 to J/m^3 (or Pascals)
picops = pressc*1d12       ; => Conversion from eV/cm^3 to pJ/m^3 (or pPa)
;-----------------------------------------------------------------------------------------
; => Dates and time ranges
;-----------------------------------------------------------------------------------------
date = '092498'
t    = ['1998-09-24/22:20:00','1998-09-25/00:30:00']
tramp = '1998-09-24/23:20:37.374'
tr3   = time_double(t)
tura  = time_double(tramp)

mydate = my_str_date(DATE=date)
sdate  = mydate.S_DATE[0]  ; -('MMDDYY')
ldate  = mydate.DATE[0]    ; -('YYYYMMDD')
tdate  = mydate.TDATE[0]   ; => 'YYYY-MM-DD'
;-----------------------------------------------------------------------------------------
; => Load MFI data
;-----------------------------------------------------------------------------------------
htr_mfi2tplot,DATE=date
get_data,'WIND_B3_HTR(GSE,nT)',DATA=temporary_mfi
magf_htr = temporary_mfi
str_element,magf_htr,'R',REPLICATE(1L,N_ELEMENTS(magf_htr.X)),/ADD_REPLACE


mag3  = read_wind_mfi(TRANGE=tr3)
t3x   = mag3.MAG.X
magf4 = mag3.BGSE.Y

magf_3s = {X:t3x,Y:magf4}
;-----------------------------------------------------------------------------------------
; => Find shock info
;-----------------------------------------------------------------------------------------
gnorm      = [-0.914,-0.220,-0.341]   ; => Using RH08 from JCK's site
dgnorm     = [ 0.004, 0.009, 0.327]

gnorm2     = [-0.939,-0.175,-0.296]   ; => Using RH09 from JCK's site
dgnorm2    = [ 0.024, 0.070, 0.287]
;-----------------------------------------------------------------------------------------
; => Get TDS data
;-----------------------------------------------------------------------------------------
; => Get TDSS data
my_tdss    = get_wind_tds_data(DATE=date,FIXFILE=1,/TDSS)
x          = LINDGEN(N_ELEMENTS(my_tdss.SCET))
IF (sdate[0] EQ '092498') THEN gels = [x[24L:43L],x[47L:50L],x[53L:72L],x[76L:91L]]
; => Get ONLY whistler TDSS
IF (gels[0] NE -1) THEN scetss  = my_tdss.SCET[gels[*]]             ELSE scetss  = ''
IF (gels[0] NE -1) THEN fieldss = REFORM(my_tdss.EFIELD[gels[*],*]) ELSE fieldss = dumbf
IF (gels[0] NE -1) THEN timess  = REFORM(my_tdss.TIME[gels[*],*])   ELSE timess  = dumbd
IF (gels[0] NE -1) THEN evnums  = my_tdss.EVENT_N[gels[*]]          ELSE evnums  = -1
IF (gels[0] NE -1) THEN atypes  = my_tdss.A_TYPE[gels[*]]           ELSE atypes  = ''
IF (gels[0] NE -1) THEN sangss  = my_tdss.S_ANG[gels[*]]            ELSE sangss  = 0.
IF (gels[0] NE -1) THEN eangss  = my_tdss.E_ANG[gels[*]]            ELSE eangss  = 0.

ascets     = scetss
; => STRMID(scet,0,2)+STRMID(scet,3,2)+'-'+STRMID(scet,6,2)+'x'+STRMID(scet,9,3)
ascets2    = string_replace_char(string_replace_char(ascets,'/','-'),' ','_')
ascets2    = STRMID(ascets2[*],0L,23L)  ; => Remove the _UT
fdates     = STRMID(ascets2[*],0L,11L)
fscets     = STRMID(ascets2[*],11L)
fscets     = STRMID(fscets[*],0,2)+STRMID(fscets[*],3,2)+'-'+$
             STRMID(fscets[*],6,2)+'x'+STRMID(fscets[*],9,3)
fn_scets   = fdates[*]+fscets[*]

afields    = fieldss
atimes     = timess
aevnum     = evnums
aatype     = atypes
asangs     = sangss
aeangs     = eangss
; => Eliminate bad elements
bad        = WHERE(ascets EQ '',bd,COMPLEMENT=good,NCOMPLEMENT=gd)
IF (gd GT 0) THEN ascets  = ascets[good]
IF (gd GT 0) THEN afields = afields[good,*]
IF (gd GT 0) THEN atimes  = atimes[good,*]
IF (gd GT 0) THEN aevnum  = aevnum[good]
IF (gd GT 0) THEN aatype  = aatype[good]
IF (gd GT 0) THEN asangs  = asangs[good]
IF (gd GT 0) THEN aeangs  = aeangs[good]
; => sort elements
mts        = my_time_string(ascets,STR=1,FORM=1,PREC=3,/NOMSSG)
ascets     = mts.DATE_TIME
aunix      = mts.UNIX
sp         = SORT(aunix)
ascets     = ascets[sp]
aunix      = aunix[sp]
afields    = afields[sp,*]
atimes     = atimes[sp,*]
aevnum     = aevnum[sp]
aatype     = aatype[sp]
asangs     = asangs[sp]
aeangs     = aeangs[sp]
;-----------------------------------------------------------------------------------------
; => define fields
;-----------------------------------------------------------------------------------------
nsams   = N_ELEMENTS(REFORM(my_tdss.TIME[0,*]))
efxyz   = DBLARR(N_ELEMENTS(UNIQ(ascets,SORT(ascets))),nsams,3L)  ; => Dummy array of E-fields (mV/m)
bfxyz   = DBLARR(N_ELEMENTS(UNIQ(ascets,SORT(ascets))),nsams,3L)  ; => Dummy array of B-fields (nT)
unqel   = UNIQ(aevnum,SORT(aevnum))
n_uq    = N_ELEMENTS(unqel) - 1L
tempevn = aevnum[unqel]
n_avgs  = N_ELEMENTS(aevnum)/N_ELEMENTS(unqel) - 1L

jj      = 0L
FOR j=0L, n_uq DO BEGIN                                                    $
  t_evn   = tempevn[j]                                                   & $
  ggd     = WHERE(t_evn[0] EQ aevnum)                                    & $
  t_types = STRMID(aatype[ggd],0L,2L)                                    & $
  t_field = afields[ggd,*]                                               & $
  FOR k=0L, n_avgs DO BEGIN                                                $
    t_type = STRMID(t_types[k],0L,2L)                                    & $
    IF (t_type EQ 'EX') THEN efxyz[j,*,0] = t_field[k,*]                 & $
    IF (t_type EQ 'EY') THEN efxyz[j,*,1] = t_field[k,*]                 & $
    IF (t_type EQ 'EZ') THEN efxyz[j,*,2] = t_field[k,*]                 & $
    IF (t_type EQ 'BX') THEN bfxyz[j,*,0] = t_field[k,*]                 & $
    IF (t_type EQ 'BY') THEN bfxyz[j,*,1] = t_field[k,*]                 & $
    IF (t_type EQ 'BZ') THEN bfxyz[j,*,2] = t_field[k,*]                 & $
  ENDFOR                                                                 & $
  jj += 1L

FOR j=0L, n_uq DO BEGIN                                                    $
  jstr  = 'T'+STRTRIM(j,2)                                               & $
  str_element,waves_ef,jstr,REFORM(efxyz[j,*,*]),/ADD_REPLACE            & $
  str_element,waves_bf,jstr,REFORM(bfxyz[j,*,*]),/ADD_REPLACE
;-----------------------------------------------------------------------------------------
; => find unique elements of fields
;-----------------------------------------------------------------------------------------
unqel   = UNIQ(ascets,SORT(ascets))
nscets  = REFORM(ascets[unqel])
nunix   = REFORM(aunix[unqel])
nsangs  = REFORM(asangs[unqel])
neangs  = REFORM(aeangs[unqel])
nevnm   = REFORM(aevnum[unqel])
natype  = aatype[unqel]
fn_scet = fn_scets[unqel]
ntimes  = REFORM(atimes[unqel,*],N_ELEMENTS(unqel),nsams)
n_uq    = N_ELEMENTS(unqel) - 1L
;-----------------------------------------------------------------------------------------
; => interpolate angles
;-----------------------------------------------------------------------------------------
nangsi = DBLARR(nsams,n_uq+1L)
FOR k=0L, n_uq DO BEGIN                                              $
  kstr  = 'T'+STRTRIM(k,2)                                         & $
  tt0         = REFORM(ntimes[k,*])*1d-3 + nunix[k]                & $
  tts0        = [MIN(tt0,/NAN),MAX(tt0,/NAN)]                      & $
  temp0       = interp([nsangs[k],neangs[k]],tts0,tt0,/NO_EXTRAP)  & $
  str_element,tds_unx,kstr,tt0,/ADD_REPLACE                        & $
  nangsi[*,k] = temp0

san_str    = STRTRIM(STRING(FORMAT='(f15.1)',nsangs),2)
ean_str    = STRTRIM(STRING(FORMAT='(f15.1)',neangs),2)
ang_str    = san_str[*]+'!Uo!N'+'-'+ean_str[*]+'!Uo!N'
fang_str   = '+E!Dx!N Angle to Sun:  '+ang_str[*]
;-----------------------------------------------------------------------------------------
; => filter fields
;-----------------------------------------------------------------------------------------
lfc1  = [3d0,5d0,1d1, 5d1,1d2]   ; => For 1998-09-24/23:20:38.842 UT
hfc1  = [2d1,2d1,45d0,2d2,2d2]   ; => For 1998-09-24/23:20:38.842 UT
lfc2  = [3d0,6d0,15d0, 3d1]      ; => For 1998-09-24/23:22:26.632 UT
hfc2  = [2d1,3d1,15d1,15d1]      ; => For 1998-09-24/23:22:26.632 UT
lfc3  = [3d0,6d0,15d0, 3d1]      ; => For 1998-09-24/23:22:48.150 UT
hfc3  = [2d1,3d1,15d1,15d1]      ; => For 1998-09-24/23:22:48.150 UT
lfc4  = [3d0]                    ; => For 1998-09-24/23:30:00.465 UT
hfc4  = [3d1]                    ; => For 1998-09-24/23:30:00.465 UT
lfc5  = [3d0,1d1,4d1,2d2]        ; => For 1998-09-24/23:30:48.542 UT
hfc5  = [4d1,4d1,1d2,4d2]        ; => For 1998-09-24/23:30:48.542 UT
lfc6  = [3d0]                    ; => For 1998-09-24/23:43:18.951 UT
hfc6  = [3d1]                    ; => For 1998-09-24/23:43:18.951 UT
lfc7  = [3d0,1d1,3d1,1d2]        ; => For 1998-09-24/23:45:52.184 UT
hfc7  = [3d1,1d2,1d2,3d2]        ; => For 1998-09-24/23:45:52.184 UT
lfc8  = [3d0,1d1,15d0,30d0]      ; => For 1998-09-24/23:45:53.379 UT
hfc8  = [3d1,3d1,6d1 ,1d2 ]      ; => For 1998-09-24/23:45:53.379 UT
lfc9  = [3d0,4d0,1d1]            ; => For 1998-09-24/23:48:39.020 UT
hfc9  = [3d1,4d1,4d1]            ; => For 1998-09-24/23:48:39.020 UT
lfc10 = [3d0,5d0,7d0,65d0]       ; => For 1998-09-24/23:48:42.131 UT
hfc10 = [3d1,3d1,3d1,3d2]        ; => For 1998-09-24/23:48:42.131 UT
lfc11 = [3d0,6d0,1d1]            ; => For 1998-09-24/23:48:51.622 UT
hfc11 = [3d1,3d1,1d2]            ; => For 1998-09-24/23:48:51.622 UT
lfc12 = [3d0,5d0,7d0]            ; => For 1998-09-25/00:04:04.545 UT
hfc12 = [3d1,5d1,5d1]            ; => For 1998-09-25/00:04:04.545 UT
lfc13 = [3d0,5d0,4d1]            ; => For 1998-09-25/00:05:23.432 UT
hfc13 = [3d1,5d1,2d2]            ; => For 1998-09-25/00:05:23.432 UT
lfc14 = [3d0,7d0,1d1,2d1]        ; => For 1998-09-25/00:14:50.603 UT
hfc14 = [3d1,5d1,1d2,1d2]        ; => For 1998-09-25/00:14:50.603 UT
lfc15 = [3d0,1d1,3d1]            ; => For 1998-09-25/00:28:42.305 UT
hfc15 = [3d1,5d1,2d2]            ; => For 1998-09-25/00:28:42.305 UT

tags  = ['t1','t2','t3','t4','t5','t6','t7','t8','t9',$
         't10','t11','t12','t13','t14','t15']

lf_str = CREATE_STRUCT(tags,lfc1,lfc2,lfc3,lfc4,lfc5,lfc6,lfc7,lfc8,lfc9,$
                       lfc10,lfc11,lfc12,lfc13,lfc14,lfc15)
hf_str = CREATE_STRUCT(tags,hfc1,hfc2,hfc3,hfc4,hfc5,hfc6,hfc7,hfc8,hfc9,$
                       hfc10,hfc11,hfc12,hfc13,hfc14,hfc15)

DELVAR,filter_sf0,filter_ef0,filter_bf0,filter_sf,filter_ef,filter_bf
jj     = 0L
FOR j=0L, n_uq DO BEGIN                                                             $
  evln  = (MAX(ntimes[j,*],/NAN) - MIN(ntimes[j,*],/NAN))*1d-3                    & $
  tsam  = (nsams - 1L)/evln                                                       & $
  jstr  = 'T'+STRTRIM(j,2)                                                        & $
  lfc0  = lf_str.(j)                                                              & $
  hfc0  = hf_str.(j)                                                              & $
  n_fr  = N_ELEMENTS(lfc0) - 1L                                                   & $
  t_ef  = REFORM(waves_ef.(j))                                                    & $
  t_bf  = REFORM(waves_bf.(j))                                                    & $
  FOR k=0L, n_fr DO BEGIN                                                           $
    kstr  = 'T'+STRTRIM(k,2)                                                      & $
    flow  = lfc0[k]                                                               & $
    fhigh = hfc0[k]                                                               & $
    filte = vector_bandpass(t_ef,tsam[0],flow[0],fhigh[0],/MIDF)                  & $
    filtb = vector_bandpass(t_bf,tsam[0],flow[0],fhigh[0],/MIDF)                  & $
    str_element,filter_ef0,kstr,filte,/ADD_REPLACE                                & $
    str_element,filter_bf0,kstr,filtb,/ADD_REPLACE                                & $
    vec_ef = REFORM(filte)*1d-3                                                   & $
    vec_bf = REFORM(filtb)*1d-9                                                   & $
    poy_sf = my_crossp_2(vec_ef,vec_bf,/NOM)/muo*1d6                              & $
    str_element,filter_sf0,kstr,poy_sf,/ADD_REPLACE                               & $
  ENDFOR                                                                          & $
  str_element,filter_sf,jstr,filter_sf0,/ADD_REPLACE                              & $
  str_element,filter_ef,jstr,filter_ef0,/ADD_REPLACE                              & $
  str_element,filter_bf,jstr,filter_bf0,/ADD_REPLACE                              & $
  FOR k=0L, n_fr DO BEGIN                                                           $
    kstr  = 'T'+STRTRIM(k,2)                                                      & $
    str_element,filter_ef0,kstr,/DELETE                                           & $
    str_element,filter_bf0,kstr,/DELETE                                           & $
    str_element,filter_sf0,kstr,/DELETE                                           & $
  ENDFOR                                                                          & $
ENDFOR                                                                            & $
jj += 1L

DELVAR,filter_sf0,filter_ef0,filter_bf0,vec_ef,vec_bf,filte,filtb,poy_sf,t_ef,b_ef

; => [erg cm^(-2) s^(-1) = 10^(-3) W m^(-2)]
; => [milliergs cm^(-2) s^(-1) = 10^(-6) W m^(-2)]
;-----------------------------------------------------------------------------------------
; => rotate fields into GSE and FAC Coordinates [use Shock Norm. Vec. as second vector]
;-----------------------------------------------------------------------------------------
unx_t0     = ntimes*1d-3 + (nunix # REPLICATE(1d0,2048L))
t_mag0     = tds_bfield(unx_t0,nsangs,neangs,B3SMAG=magf_3s,HTRMAG=magf_htr,DATE=date,/NOCURR)
b3s_gse    = t_mag0.G3MAG                ; => [# of TDSF, # of points, 3L]
htr_gse    = t_mag0.GHTR
; => Change the following line when HTR MFI is available...
;mag_gse    = b3s_gse
mag_gse    = htr_gse
mag_waves  = t_mag0.ROT_HTR
sun_dir    = gnorm

jj     = 0L
FOR j=0L, n_uq DO BEGIN                                                     $
  jstr    = 'T'+STRTRIM(j,2)                                              & $
  unx0    = REFORM(unx_t0[j,*])                                           & $
  g_magf  = REFORM(mag_gse[j,*,*])                                        & $
  angles  = REFORM(nangsi[*,j])                                           & $
  filter_ef0 = filter_ef.(j)                                              & $
  filter_bf0 = filter_bf.(j)                                              & $
  filter_sf0 = filter_sf.(j)                                              & $
  n_fr       = N_ELEMENTS(lf_str.(j)) - 1L                                & $
  FOR k=0L, n_fr DO BEGIN                                                   $
    kstr    = 'T'+STRTRIM(k,2)                                            & $
    vec_ef  = REFORM(filter_ef0.(k))*1d0                                  & $
    vec_bf  = REFORM(filter_bf0.(k))*1d0                                  & $
    vec_sf  = REFORM(filter_sf0.(k))*1d0                                  & $
    rot_efg = DBLARR(nsams,3L)                                            & $
    rot_bfg = DBLARR(nsams,3L)                                            & $
    rot_sfg = DBLARR(nsams,3L)                                            & $
    rot_ef  = DBLARR(nsams,3L)                                            & $
    rot_bf  = DBLARR(nsams,3L)                                            & $
    rot_sf  = DBLARR(nsams,3L)                                            & $
    FOR i=0L, nsams - 1L DO BEGIN                                           $
      rotm0 = TRANSPOSE(eulermat(0d0,angles[i],180d0,/DEG))               & $
      t_eef = REFORM(rotm0 ## REFORM(vec_ef[i,*]))                        & $
      t_ebf = REFORM(rotm0 ## REFORM(vec_bf[i,*]))                        & $
      t_esf = REFORM(rotm0 ## REFORM(vec_sf[i,*]))                        & $
      rot_efg[i,*] = t_eef                                                & $
      rot_bfg[i,*] = t_ebf                                                & $
      rot_sfg[i,*] = t_esf                                                & $
      magf  = REFORM(g_magf[i,*])                                         & $
      rotm0 = rot_mat(magf,sun_dir)                                       & $
      t_eef = REFORM(rotm0 ## REFORM(vec_ef[i,*]))                        & $
      t_ebf = REFORM(rotm0 ## REFORM(vec_bf[i,*]))                        & $
      t_esf = REFORM(rotm0 ## REFORM(vec_sf[i,*]))                        & $
      rot_ef[i,*] = t_eef                                                 & $
      rot_bf[i,*] = t_ebf                                                 & $
      rot_sf[i,*] = t_esf                                                 & $
    ENDFOR                                                                & $
    str_element,rotated_gse_ef0,kstr,rot_efg,/ADD_REPLACE                 & $
    str_element,rotated_gse_bf0,kstr,rot_bfg,/ADD_REPLACE                 & $
    str_element,rotated_gse_sf0,kstr,rot_sfg,/ADD_REPLACE                 & $
    str_element,rotated_fac_ef0,kstr,rot_ef,/ADD_REPLACE                  & $
    str_element,rotated_fac_bf0,kstr,rot_bf,/ADD_REPLACE                  & $
    str_element,rotated_fac_sf0,kstr,rot_sf,/ADD_REPLACE                  & $
  ENDFOR                                                                  & $
  str_element,rotated_gse_ef,jstr,rotated_gse_ef0,/ADD_REPLACE            & $
  str_element,rotated_gse_bf,jstr,rotated_gse_bf0,/ADD_REPLACE            & $
  str_element,rotated_gse_sf,jstr,rotated_gse_sf0,/ADD_REPLACE            & $
  str_element,rotated_fac_ef,jstr,rotated_fac_ef0,/ADD_REPLACE            & $
  str_element,rotated_fac_bf,jstr,rotated_fac_bf0,/ADD_REPLACE            & $
  str_element,rotated_fac_sf,jstr,rotated_fac_sf0,/ADD_REPLACE            & $
  FOR k=0L, n_fr DO BEGIN                                                   $
    kstr    = 'T'+STRTRIM(k,2)                                            & $
    str_element,rotated_gse_ef0,kstr,/DELETE                              & $
    str_element,rotated_gse_bf0,kstr,/DELETE                              & $
    str_element,rotated_gse_sf0,kstr,/DELETE                              & $
    str_element,rotated_fac_ef0,kstr,/DELETE                              & $
    str_element,rotated_fac_bf0,kstr,/DELETE                              & $
    str_element,rotated_fac_sf0,kstr,/DELETE                              & $
  ENDFOR                                                                  & $
ENDFOR                                                                            & $
jj += 1L

;      rotm0 = eulermat(0d0,angles[i],180d0,/DEG)                          & $
DELVAR,filter_sf0,filter_ef0,filter_bf0
DELVAR,rotated_gse_ef0,rotated_gse_bf0,rotated_gse_sf0,rot_efg,rot_bfg,rot_sfg
DELVAR,rot_ef,rot_bf,rot_sf,vec_ef,vec_bf,vec_sf,t_eef,t_ebf,t_esf

; => *_gse_*  =  fields rotated into GSE Coordinates
; => *_fac_*  =  fields rotated into FACs

;-----------------------------------------------------------------------------------------
; => Plot waveforms in GSE Coordinates
;-----------------------------------------------------------------------------------------
wi,1
!P.MULTI = [0,1,3]

yttlsws   = ['S!Dx!N (!7l!3'+'W/m!U2!N'+')','S!Dy!N (!7l!3'+'W/m!U2!N'+')',$
             'S!Dz!N (!7l!3'+'W/m!U2!N'+')']
yttlbws   = ['B!Dx!N (nT)','B!Dy!N (nT)','B!Dz!N (nT)']
yttlews   = ['E!Dx!N (mV/m)','E!Dy!N (mV/m)','E!Dz!N (mV/m)']

xtntm     = ['0','200','400','600','800','1000']
xtvtm     = [0e0,2e2,4e2,6e2,8e2,1e3]
xtstm     = N_ELEMENTS(xtvtm) - 1L
xtt1      = 'Time (ms)'
exstr_s   = {XSTYLE:1,YSTYLE:1,NODATA:1,XTICKNAME:xtntm,XTICKV:xtvtm,$
             XTICKS:xtstm,XTITLE:xtt1,XMINOR:10,XTICKLEN:0.04}

ffw_prefx = 'FIXED_WAVES-Coords_filtered_'
colors    = [250,150,50]
!P.CHARSIZE = 1.5
!P.MULTI    = [0,1,3]



; => Plot Filtered fields 
jj = 0
FOR i=0L, n_uq DO BEGIN                                                         $
  lfc0       = lf_str.(i)                                                     & $
  hfc0       = hf_str.(i)                                                     & $
  fwl_str    = STRTRIM(STRING(FORMAT='(f15.1)',lfc0),2)                       & $
  fwh_str    = STRTRIM(STRING(FORMAT='(f15.1)',hfc0),2)                       & $
  fil_str    = fwl_str[*]+'-'+fwh_str[*]+'Hz_'                                & $
  fil_st2    = STRARR(N_ELEMENTS(fil_str))                                    & $
  n_fr       = N_ELEMENTS(lfc0) - 1L                                          & $
  FOR j=0L, n_fr DO fil_st2[j] = STRMID(fil_str[j],0L,STRLEN(fil_str[j])-1L)  & $
  FOR k=0L, n_fr DO BEGIN                                                       $
    ms_times = REFORM(ntimes[i,*])                                        & $
    sw_field = filter_sf.(i).(k)                                          & $
    ew_field = filter_ef.(i).(k)                                          & $
    bw_field = filter_bf.(i).(k)                                          & $
    yra_sw   = [-1e0*MAX(ABS(sw_field),/NAN),MAX(ABS(sw_field),/NAN)]     & $
    yra_bw   = [-1e0*MAX(ABS(bw_field),/NAN),MAX(ABS(bw_field),/NAN)]     & $
    yra_ew   = [-1e0*MAX(ABS(ew_field),/NAN),MAX(ABS(ew_field),/NAN)]     & $
    fname0   = ffw_prefx[0]+fil_str[k]+fn_scet[i]+'_Sxyz'                 & $
    popen,fname0,/LAND                                                    & $
      FOR j=0L, 2L DO BEGIN                                                 $
        IF (j EQ 0) THEN ttle = 'Poynting Flux [WAVES-Coords] at: '+nscets[i] & $
        IF (j EQ 1) THEN ttle = 'Filtered: '+fil_st2[k]+', '+fang_str[i]  & $
        IF (j EQ 2) THEN ttle = ''                                        & $
        PLOT,ms_times,sw_field[*,j],_EXTRA=exstr_s,YTITLE=yttlsws[j],YRANGE=yra_sw,TITLE=ttle  & $
          OPLOT,ms_times,sw_field[*,j],COLOR=colors[j]                    & $
      ENDFOR                                                              & $
    pclose                                                                & $
    fname0   = ffw_prefx[0]+fil_str[k]+fn_scet[i]+'_Bxyz'                 & $
    popen,fname0,/LAND                                                    & $
      FOR j=0L, 2L DO BEGIN                                                 $
        IF (j EQ 0) THEN ttle = 'Magnetic Field [WAVES-Coords] at: '+nscets[i] & $
        IF (j EQ 1) THEN ttle = 'Filtered: '+fil_st2[k]+', '+fang_str[i]  & $
        IF (j EQ 2) THEN ttle = ''                                        & $
        PLOT,ms_times,bw_field[*,j],_EXTRA=exstr_s,YTITLE=yttlbws[j],YRANGE=yra_bw,TITLE=ttle  & $
          OPLOT,ms_times,bw_field[*,j],COLOR=colors[j]                    & $
      ENDFOR                                                              & $
    pclose                                                                & $
    fname0   = ffw_prefx[0]+fil_str[k]+fn_scet[i]+'_Exyz'                 & $
    popen,fname0,/LAND                                                    & $
      FOR j=0L, 2L DO BEGIN                                                 $
        IF (j EQ 0) THEN ttle = 'Electric Field [WAVES-Coords] at: '+nscets[i] & $
        IF (j EQ 1) THEN ttle = 'Filtered: '+fil_st2[k]+', '+fang_str[i]  & $
        IF (j EQ 2) THEN ttle = ''                                        & $
        PLOT,ms_times,ew_field[*,j],_EXTRA=exstr_s,YTITLE=yttlews[j],YRANGE=yra_ew,TITLE=ttle  & $
          OPLOT,ms_times,ew_field[*,j],COLOR=colors[j]                    & $
      ENDFOR                                                              & $
    pclose                                                                & $
  ENDFOR                                                                  & $
  jj += 1L


ffr_prefx = 'FIXED_rotated_filtered_'
; => Plot rotated and filtered fields 
FOR i=0L, n_uq DO BEGIN                                                         $
  lfc0       = lf_str.(i)                                                     & $
  hfc0       = hf_str.(i)                                                     & $
  fwl_str    = STRTRIM(STRING(FORMAT='(f15.1)',lfc0),2)                       & $
  fwh_str    = STRTRIM(STRING(FORMAT='(f15.1)',hfc0),2)                       & $
  fil_str    = fwl_str[*]+'-'+fwh_str[*]+'Hz_'                                & $
  fil_st2    = STRARR(N_ELEMENTS(fil_str))                                    & $
  n_fr       = N_ELEMENTS(lfc0) - 1L                                          & $
  FOR j=0L, n_fr DO fil_st2[j] = STRMID(fil_str[j],0L,STRLEN(fil_str[j])-1L)  & $
  FOR k=0L, n_fr DO BEGIN                                                   $
    ms_times = REFORM(ntimes[i,*])                                        & $
    sw_field = rotated_gse_sf.(i).(k)                                     & $
    ew_field = rotated_gse_ef.(i).(k)                                     & $
    bw_field = rotated_gse_bf.(i).(k)                                     & $
    yra_sw   = [-1e0*MAX(ABS(sw_field),/NAN),MAX(ABS(sw_field),/NAN)]     & $
    yra_bw   = [-1e0*MAX(ABS(bw_field),/NAN),MAX(ABS(bw_field),/NAN)]     & $
    yra_ew   = [-1e0*MAX(ABS(ew_field),/NAN),MAX(ABS(ew_field),/NAN)]     & $
    fname0   = ffr_prefx[0]+fil_str[k]+fn_scet[i]+'_S-GSE'                & $
    popen,fname0,/LAND                                                    & $
      FOR j=0L, 2L DO BEGIN                                                 $
        IF (j EQ 0) THEN ttle = 'Poynting Flux [GSE-Coords] at: '+nscets[i] & $
        IF (j EQ 1) THEN ttle = 'Filtered: '+fil_st2[k]+', '+fang_str[i]  & $
        IF (j EQ 2) THEN ttle = ''                                        & $
        PLOT,ms_times,sw_field[*,j],_EXTRA=exstr_s,YTITLE=yttlsws[j],YRANGE=yra_sw,TITLE=ttle  & $
          OPLOT,ms_times,sw_field[*,j],COLOR=colors[j]                    & $
      ENDFOR                                                              & $
    pclose                                                                & $
    fname0   = ffr_prefx[0]+fil_str[k]+fn_scet[i]+'_B-GSE'                 & $
    popen,fname0,/LAND                                                    & $
      FOR j=0L, 2L DO BEGIN                                                 $
        IF (j EQ 0) THEN ttle = 'Magnetic Field [GSE-Coords] at: '+nscets[i] & $
        IF (j EQ 1) THEN ttle = 'Filtered: '+fil_st2[k]+', '+fang_str[i]  & $
        IF (j EQ 2) THEN ttle = ''                                        & $
        PLOT,ms_times,bw_field[*,j],_EXTRA=exstr_s,YTITLE=yttlbws[j],YRANGE=yra_bw,TITLE=ttle  & $
          OPLOT,ms_times,bw_field[*,j],COLOR=colors[j]                    & $
      ENDFOR                                                              & $
    pclose                                                                & $
    fname0   = ffr_prefx[0]+fil_str[k]+fn_scet[i]+'_E-GSE'                 & $
    popen,fname0,/LAND                                                    & $
      FOR j=0L, 2L DO BEGIN                                                 $
        IF (j EQ 0) THEN ttle = 'Electric Field [GSE-Coords] at: '+nscets[i] & $
        IF (j EQ 1) THEN ttle = 'Filtered: '+fil_st2[k]+', '+fang_str[i]  & $
        IF (j EQ 2) THEN ttle = ''                                        & $
        PLOT,ms_times,ew_field[*,j],_EXTRA=exstr_s,YTITLE=yttlews[j],YRANGE=yra_ew,TITLE=ttle  & $
          OPLOT,ms_times,ew_field[*,j],COLOR=colors[j]                    & $
      ENDFOR                                                              & $
    pclose                                                                & $
  ENDFOR                                                                  & $
  jj += 1L


yttlsrs   = ['S!D!9x!3'+',1!N (!7l!3'+'W/m!U2!N'+')',$
             'S!D!9x!3'+',2!N (!7l!3'+'W/m!U2!N'+')',$
             'S!D!9#!3'+'!N (!7l!3'+'W/m!U2!N'+')']
yttlbrs   = ['B!D!9x!3'+',1!N (nT)','B!D!9x!3'+',2!N (nT)',$
             'B!D!9#!3'+'!N (nT)']
yttlers   = ['E!D!9x!3'+',1!N (mV/m)','E!D!9x!3'+',2!N (mV/m)',$
             'E!D!9#!3'+'!N (mV/m)']
ffr_prefx = 'FIXED_rotated_filtered_'
FOR i=0L, n_uq DO BEGIN                                                         $
  lfc0       = lf_str.(i)                                                     & $
  hfc0       = hf_str.(i)                                                     & $
  fwl_str    = STRTRIM(STRING(FORMAT='(f15.1)',lfc0),2)                       & $
  fwh_str    = STRTRIM(STRING(FORMAT='(f15.1)',hfc0),2)                       & $
  fil_str    = fwl_str[*]+'-'+fwh_str[*]+'Hz_'                                & $
  fil_st2    = STRARR(N_ELEMENTS(fil_str))                                    & $
  n_fr       = N_ELEMENTS(lfc0) - 1L                                          & $
  FOR j=0L, n_fr DO fil_st2[j] = STRMID(fil_str[j],0L,STRLEN(fil_str[j])-1L)  & $
  FOR k=0L, n_fr DO BEGIN                                                   $
    ms_times = REFORM(ntimes[i,*])                                        & $
    sw_field = rotated_fac_sf.(i).(k)                                     & $
    ew_field = rotated_fac_ef.(i).(k)                                     & $
    bw_field = rotated_fac_bf.(i).(k)                                     & $
    yra_sw   = [-1e0*MAX(ABS(sw_field),/NAN),MAX(ABS(sw_field),/NAN)]     & $
    yra_bw   = [-1e0*MAX(ABS(bw_field),/NAN),MAX(ABS(bw_field),/NAN)]     & $
    yra_ew   = [-1e0*MAX(ABS(ew_field),/NAN),MAX(ABS(ew_field),/NAN)]     & $
    fname0   = ffr_prefx[0]+fil_str[k]+fn_scet[i]+'_S-FACs'                & $
    popen,fname0,/LAND                                                    & $
      FOR j=0L, 2L DO BEGIN                                                 $
        IF (j EQ 0) THEN ttle = 'Poynting Flux [FACs] at: '+nscets[i] & $
        IF (j EQ 1) THEN ttle = 'Filtered: '+fil_st2[k]+', '+fang_str[i]  & $
        IF (j EQ 2) THEN ttle = ''                                        & $
        PLOT,ms_times,sw_field[*,j],_EXTRA=exstr_s,YTITLE=yttlsrs[j],YRANGE=yra_sw,TITLE=ttle  & $
          OPLOT,ms_times,sw_field[*,j],COLOR=colors[j]                    & $
      ENDFOR                                                              & $
    pclose                                                                & $
    fname0   = ffr_prefx[0]+fil_str[k]+fn_scet[i]+'_B-FACs'                 & $
    popen,fname0,/LAND                                                    & $
      FOR j=0L, 2L DO BEGIN                                                 $
        IF (j EQ 0) THEN ttle = 'Magnetic Field [FACs] at: '+nscets[i] & $
        IF (j EQ 1) THEN ttle = 'Filtered: '+fil_st2[k]+', '+fang_str[i]  & $
        IF (j EQ 2) THEN ttle = ''                                        & $
        PLOT,ms_times,bw_field[*,j],_EXTRA=exstr_s,YTITLE=yttlbrs[j],YRANGE=yra_bw,TITLE=ttle  & $
          OPLOT,ms_times,bw_field[*,j],COLOR=colors[j]                    & $
      ENDFOR                                                              & $
    pclose                                                                & $
    fname0   = ffr_prefx[0]+fil_str[k]+fn_scet[i]+'_E-FACs'                 & $
    popen,fname0,/LAND                                                    & $
      FOR j=0L, 2L DO BEGIN                                                 $
        IF (j EQ 0) THEN ttle = 'Electric Field [FACs] at: '+nscets[i] & $
        IF (j EQ 1) THEN ttle = 'Filtered: '+fil_st2[k]+', '+fang_str[i]  & $
        IF (j EQ 2) THEN ttle = ''                                        & $
        PLOT,ms_times,ew_field[*,j],_EXTRA=exstr_s,YTITLE=yttlers[j],YRANGE=yra_ew,TITLE=ttle  & $
          OPLOT,ms_times,ew_field[*,j],COLOR=colors[j]                    & $
      ENDFOR                                                              & $
    pclose                                                                & $
  ENDFOR                                                                  & $
  jj += 1L

!P.MULTI = 0
;---------------------------------------------------------------------------------------------------
;      Date        Time                Ni          Ti            Vx              Vy             Vz
;===================================================================================================
;    1998/09/24 23:20:38.842 UT      16.586      33.823       -482.355         28.057         57.841
;    1998/09/24 23:22:26.632 UT      21.087      86.049       -680.323        -21.010       -101.289
;    1998/09/24 23:22:48.150 UT      21.499      83.873       -679.474        -28.766        -89.172
;    1998/09/24 23:30:00.465 UT      24.340      75.395       -645.565        -33.859        -57.344
;    1998/09/24 23:30:48.542 UT      24.016      75.068       -648.959        -28.025        -84.072
;    1998/09/24 23:43:18.951 UT      24.699      77.193       -659.650        -38.526        -32.522
;    1998/09/24 23:45:52.184 UT      20.004      86.598       -673.799        -38.333        -24.744
;    1998/09/24 23:45:53.379 UT      19.946      86.363       -673.363        -37.922        -24.995
;    1998/09/24 23:48:39.020 UT      24.534      79.111       -676.862         71.871        -53.301
;    1998/09/24 23:48:42.131 UT      24.764      78.886       -679.223         76.920        -53.406
;    1998/09/24 23:48:51.622 UT      25.467      78.199       -686.423         92.322        -53.727
;    1998/09/25 00:04:04.545 UT      22.313     107.649       -703.974        -39.131        -29.547
;    1998/09/25 00:05:23.432 UT      21.804     125.535       -720.792          7.078        -38.687
;    1998/09/25 00:14:50.603 UT      14.165     116.449       -715.282        -40.280        -30.922
;    1998/09/25 00:28:42.305 UT      15.225         NaN            NaN            NaN            NaN
;---------------------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
; => Perform MVA
;-----------------------------------------------------------------------------------------
dumbmag = magf_htr
jj      = 0L
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

spref = 'bvec'
ssuff = '   = ['
mfor0 = '(a11,f8.5,",",f8.5,",",f8.5,"]")'
mfor1 = '(a12,f8.5,",",f8.5,",",f8.5,"]")'
FOR j=0L, N_TAGS(tr_str) - 1L DO BEGIN                                $
  jstr   = STRTRIM(j,2L)                                            & $
  IF (j LT 10L) THEN mform = mfor0 ELSE mform = mfor1               & $
  strg   = spref[0]+jstr[0]+ssuff[0]                                & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  PRINT,FORMAT=mform,strg[0],avbvec

spref = 'bmag'
ssuff = '   = ['
mfor0 = '(a11,f8.5,"]")'
mfor1 = '(a12,f8.5,"]")'
FOR j=0L, N_TAGS(tr_str) - 1L DO BEGIN                                $
  jstr   = STRTRIM(j,2L)                                            & $
  IF (j LT 10L) THEN mform = mfor0 ELSE mform = mfor1               & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  strg   = spref[0]+jstr[0]+ssuff[0]                                & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  PRINT,FORMAT=mform,strg[0],avgbm

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}
dummy3  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(3)}
dummy4  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(4)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0       5.0      10.0      50.0     100.0
print, hfc0, format='(";",8f10.1)'
;      20.0      20.0      45.0     200.0     200.0

vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy1,FCUTOFF=[lfc0[1],hfc0[1]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy4,FCUTOFF=[lfc0[4],hfc0[4]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi


bvec0   = [-0.44668, 0.89364, 0.04340]
bmag0   = [26.94182]
;-----------------------------------------------------------------------------------------
; => For  3 Hz < f < 20 Hz  at  1998-09-24/23:20:38.842 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 0-522
;Plot Range: 23:20:38.8420-23:20:39.1204
;The angle between DC-Field and the k-vector is :
;       57.217 +/- 0.714 degrees
;The eigenvalues ratios are:
;       14.284897       1.4001452
;The Minimum Variance eigenvector is:
;<-0.99394, 0.10952,-0.00910> +/- <-0.00221,-0.02714,-0.08475>
;
;Plot Index Range: 228-522
;Plot Range: 23:20:38.9636-23:20:39.1204
;The angle between DC-Field and the k-vector is :
;       56.741 +/- 0.744 degrees
;The eigenvalues ratios are:
;       22.211779       1.4924634
;The Minimum Variance eigenvector is:
;< 0.98245,-0.06481,-0.17490> +/- <-0.00668, 0.05529,-0.05799>
;
;Plot Index Range: 957-1965
;Plot Range: 23:20:39.3524-23:20:39.8900
;The angle between DC-Field and the k-vector is :
;       76.302 +/- 0.551 degrees
;The eigenvalues ratios are:
;       12.653364       4.8196577
;The Minimum Variance eigenvector is:
;<-0.76938,-0.08886,-0.63258> +/- < 0.01831, 0.05753,-0.03036>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:20:38.9636',prefd[0]+'23:20:39.1204'])
kvec0   = [ 0.98245,-0.06481,-0.17490]
dkvec0  = ABS([-0.00668, 0.05529,-0.05799])
elam0   = [22.211779,1.4924634]
bvec0   = [-0.44466, 0.89448, 0.03813]
bmag0   = [32.45339]

tags    = ['t0']
tr_str  = CREATE_STRUCT(tags,tr0)
kv_str  = CREATE_STRUCT(tags,kvec0)
dkv_str = CREATE_STRUCT(tags,dkvec0)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  3 Hz < f < 20 Hz  at  1998-09-24/23:20:38.842 UT
;
;   23:20:38.9636-23:20:39.1204      0.982     -0.065     -0.175     -0.445      0.894      0.038     32.453

vswu   = [-482.355,28.057,57.841]         ; => My 3DP estimates (km/s) For 1998-09-24/23:20:38.842 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  3 Hz < f < 20 Hz  at  1998-09-24/23:20:38.842 UT
;
;   23:20:38.9636-23:20:39.1204    120.099     59.901    145.493     34.507    176.723      3.277

theta_kb0924_03_20   = DBLARR(nn)
theta_kn0924_03_20   = DBLARR(nn)
theta_kv0924_03_20   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_03_20[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_03_20[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_03_20[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_03_20[j]),  $
                     REFORM(theta_kn0924_03_20[j]),$
                     REFORM(theta_kv0924_03_20[j])
;
; => For  3 Hz < f < 20 Hz  at  1998-09-24/23:20:38.842 UT
;
;   23:20:38.9636-23:20:39.1204     59.901     34.507      3.277

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_03_20
PRINT,FORMAT=tkbf,theta_kn0924_03_20
PRINT,FORMAT=tkbf,theta_kv0924_03_20

theta_kb0924_03_20 = [59.91]
theta_kn0924_03_20 = [34.51]
theta_kv0924_03_20 = [ 3.28]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24

;-----------------------------------------------------------------------------------------
; => For  5 Hz < f < 20 Hz  at  1998-09-24/23:20:38.842 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 0-573
;Plot Range: 23:20:38.8420-23:20:39.1476
;The angle between DC-Field and the k-vector is :
;       52.059 +/- 0.745 degrees
;The eigenvalues ratios are:
;       12.262845       1.5780756
;The Minimum Variance eigenvector is:
;<-0.96179, 0.19809, 0.18897> +/- < 0.01244, 0.08687,-0.02776>
;
;Plot Index Range: 0-286
;Plot Range: 23:20:38.8420-23:20:38.9945
;The angle between DC-Field and the k-vector is :
;       48.544 +/- 0.510 degrees
;The eigenvalues ratios are:
;       46.245752       1.4360068
;The Minimum Variance eigenvector is:
;<-0.96622, 0.25768, 0.00417> +/- <-0.00731,-0.02663,-0.04868>
;
;Plot Index Range: 287-573
;Plot Range: 23:20:38.9951-23:20:39.1476
;The angle between DC-Field and the k-vector is :
;       52.265 +/- 0.689 degrees
;The eigenvalues ratios are:
;       26.226143       1.9333287
;The Minimum Variance eigenvector is:
;<-0.93003, 0.05771, 0.36291> +/- < 0.00210, 0.07048,-0.00582>
;
;Plot Index Range: 1600-1796
;Plot Range: 23:20:39.6953-23:20:39.7999
;The angle between DC-Field and the k-vector is :
;       58.557 +/- 1.116 degrees
;The eigenvalues ratios are:
;       15.446947       3.7815021
;The Minimum Variance eigenvector is:
;< 0.83241,-0.53206, 0.15495> +/- <-0.05173,-0.07679, 0.01422>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:20:38.8420',prefd[0]+'23:20:38.9945'])
tr1     = time_double([prefd[0]+'23:20:38.9951',prefd[0]+'23:20:39.1476'])
tr2     = time_double([prefd[0]+'23:20:39.6953',prefd[0]+'23:20:39.7999'])

kvec0   = [-0.96622, 0.25768, 0.00417]
kvec1   = [-0.93003, 0.05771, 0.36291]
kvec2   = [ 0.83241,-0.53206, 0.15495]

dkvec0  = ABS([-0.00731,-0.02663,-0.04868])
dkvec1  = ABS([ 0.00210, 0.07048,-0.00582])
dkvec2  = ABS([-0.05173,-0.07679, 0.01422])

elam0   = [46.245752,1.4360068]
elam1   = [26.226143,1.9333287]
elam2   = [15.446947,3.7815021]

bvec0   = [-0.40480, 0.91022, 0.08413]
bvec1   = [-0.45594, 0.88818, 0.04329]
bvec2   = [-0.33727, 0.93930, 0.02883]
bmag0   = [31.93903]
bmag1   = [32.56262]
bmag2   = [29.98178]

tags    = ['t0','t1','t2']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  5 Hz < f < 20 Hz  at  1998-09-24/23:20:38.842 UT
;
;   23:20:38.8420-23:20:38.9945     -0.966      0.258      0.004     -0.405      0.910      0.084     31.939
;   23:20:38.9951-23:20:39.1476     -0.930      0.058      0.363     -0.456      0.888      0.043     32.563
;   23:20:39.6953-23:20:39.7999      0.832     -0.532      0.155     -0.337      0.939      0.029     29.982

vswu   = [-482.355,28.057,57.841]         ; => My 3DP estimates (km/s) For 1998-09-24/23:20:38.842 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  5 Hz < f < 20 Hz  at  1998-09-24/23:20:38.842 UT
;
;   23:20:38.8420-23:20:38.9945     51.243    128.757     34.410    145.590     13.319    166.681
;   23:20:38.9951-23:20:39.1476     60.593    119.407     44.472    135.528     14.455    165.545
;   23:20:39.6953-23:20:39.7999    140.900     39.100    134.155     45.845    146.864     33.136

theta_kb0924_05_20   = DBLARR(nn)
theta_kn0924_05_20   = DBLARR(nn)
theta_kv0924_05_20   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_05_20[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_05_20[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_05_20[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_05_20[j]),  $
                     REFORM(theta_kn0924_05_20[j]),$
                     REFORM(theta_kv0924_05_20[j])
;
; => For  5 Hz < f < 20 Hz  at  1998-09-24/23:20:38.842 UT
;
;   23:20:38.8420-23:20:38.9945     51.243     34.410     13.319
;   23:20:38.9951-23:20:39.1476     60.593     44.472     14.455
;   23:20:39.6953-23:20:39.7999     39.100     45.845     33.136

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_05_20
PRINT,FORMAT=tkbf,theta_kn0924_05_20
PRINT,FORMAT=tkbf,theta_kv0924_05_20

theta_kb0924_05_20 = [51.24,60.59,39.10]
theta_kn0924_05_20 = [34.41,44.47,45.84]
theta_kv0924_05_20 = [13.32,14.46,33.14]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
; => For  100 Hz < f < 200 Hz  at  1998-09-24/23:20:38.842 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 397-481
;Plot Range: 23:20:39.0537-23:20:39.0985
;The angle between DC-Field and the k-vector is :
;       89.418 +/- 1.246 degrees
;The eigenvalues ratios are:
;       27.459350       3.2232597
;The Minimum Variance eigenvector is:
;<-0.95686,-0.07689, 0.28019> +/- <-0.01430, 0.08213,-0.02630>
;
;Plot Index Range: 439-481
;Plot Range: 23:20:39.0761-23:20:39.0985
;The angle between DC-Field and the k-vector is :
;       86.962 +/- 1.561 degrees
;The eigenvalues ratios are:
;       34.847261       6.8065886
;The Minimum Variance eigenvector is:
;<-0.93772,-0.09010, 0.33551> +/- <-0.02105, 0.07418,-0.03891>
;
;Plot Index Range: 1103-1170
;Plot Range: 23:20:39.4303-23:20:39.4660
;The angle between DC-Field and the k-vector is :
;       89.451 +/- 1.916 degrees
;The eigenvalues ratios are:
;       15.485488       3.2435678
;The Minimum Variance eigenvector is:
;<-0.43868, 0.86111,-0.25701> +/- < 0.11086, 0.04662,-0.03301>
;
;Plot Index Range: 1103-1151
;Plot Range: 23:20:39.4303-23:20:39.4559
;The angle between DC-Field and the k-vector is :
;       33.562 +/- 1.406 degrees
;The eigenvalues ratios are:
;       37.324974       3.3453533
;The Minimum Variance eigenvector is:
;<-0.40512, 0.88622,-0.22471> +/- < 0.07689, 0.02898,-0.02434>
;
;Plot Index Range: 1197-1247
;Plot Range: 23:20:39.4804-23:20:39.5071
;The angle between DC-Field and the k-vector is :
;       75.141 +/- 1.155 degrees
;The eigenvalues ratios are:
;       52.233217       2.8496824
;The Minimum Variance eigenvector is:
;<-0.07652, 0.86164,-0.50172> +/- < 0.07137,-0.00212,-0.01453>
;
;Plot Index Range: 1653-1707
;Plot Range: 23:20:39.7236-23:20:39.7524
;The angle between DC-Field and the k-vector is :
;       85.702 +/- 2.073 degrees
;The eigenvalues ratios are:
;       16.348417       2.2699986
;The Minimum Variance eigenvector is:
;<-0.38297, 0.90500,-0.18520> +/- < 0.12154, 0.04397,-0.03649>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:20:39.0761',prefd[0]+'23:20:39.0985'])
tr1     = time_double([prefd[0]+'23:20:39.4303',prefd[0]+'23:20:39.4559'])
tr2     = time_double([prefd[0]+'23:20:39.4804',prefd[0]+'23:20:39.5071'])
tr3     = time_double([prefd[0]+'23:20:39.7236',prefd[0]+'23:20:39.7524'])

kvec0   = [-0.93772,-0.09010, 0.33551]
kvec1   = [-0.40512, 0.88622,-0.22471]
kvec2   = [-0.07652, 0.86164,-0.50172]
kvec3   = [-0.38297, 0.90500,-0.18520]

dkvec0  = ABS([-0.02105, 0.07418,-0.03891])
dkvec1  = ABS([ 0.07689, 0.02898,-0.02434])
dkvec2  = ABS([ 0.07137,-0.00212,-0.01453])
dkvec3  = ABS([ 0.12154, 0.04397,-0.03649])

elam0   = [34.847261,6.8065886]
elam1   = [37.324974,3.3453533]
elam2   = [52.233217,2.8496824]
elam3   = [16.348417,2.2699986]

bvec0   = [-0.46003, 0.88709, 0.03686]
bvec1   = [-0.35493, 0.93484, 0.00657]
bvec2   = [-0.31217, 0.94961,-0.02675]
bvec3   = [-0.33825, 0.93971, 0.04764]
bmag0   = [32.66495]
bmag1   = [31.36147]
bmag2   = [30.05675]
bmag3   = [29.83430]

tags    = ['t0','t1','t2','t3']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  100 Hz < f < 200 Hz  at  1998-09-24/23:20:38.842 UT
;
;   23:20:39.0761-23:20:39.0985     -0.938     -0.090      0.336     -0.460      0.887      0.037     32.665
;   23:20:39.4303-23:20:39.4559     -0.405      0.886     -0.225     -0.355      0.935      0.007     31.361
;   23:20:39.4804-23:20:39.5071     -0.077      0.862     -0.502     -0.312      0.950     -0.027     30.057
;   23:20:39.7236-23:20:39.7524     -0.383      0.905     -0.185     -0.338      0.940      0.048     29.834

vswu   = [-482.355,28.057,57.841]         ; => My 3DP estimates (km/s) For 1998-09-24/23:20:38.842 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  100 Hz < f < 200 Hz  at  1998-09-24/23:20:38.842 UT
;
;   23:20:39.0761-23:20:39.0985     68.665    111.335     40.316    139.684     15.380    164.620
;   23:20:39.4303-23:20:39.4559     13.884    166.116     75.408    104.592     64.789    115.211
;   23:20:39.4804-23:20:39.5071     31.182    148.818     87.050     92.950     86.222     93.778
;   23:20:39.7236-23:20:39.7524     13.795    166.205     77.638    102.362     65.809    114.191

theta_kb0924_100_200   = DBLARR(nn)
theta_kn0924_100_200   = DBLARR(nn)
theta_kv0924_100_200   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_100_200[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_100_200[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_100_200[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_100_200[j]),  $
                     REFORM(theta_kn0924_100_200[j]),$
                     REFORM(theta_kv0924_100_200[j])
;
; => For  100 Hz < f < 200 Hz  at  1998-09-24/23:20:38.842 UT
;
;   23:20:39.0761-23:20:39.0985     68.665     40.316     15.380
;   23:20:39.4303-23:20:39.4559     13.884     75.408     64.789
;   23:20:39.4804-23:20:39.5071     31.182     87.050     86.222
;   23:20:39.7236-23:20:39.7524     13.795     77.638     65.809

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_100_200
PRINT,FORMAT=tkbf,theta_kn0924_100_200
PRINT,FORMAT=tkbf,theta_kv0924_100_200

theta_kb0924_100_200 = [68.66,13.88,31.18,13.80]
theta_kn0924_100_200 = [40.32,75.41,87.05,77.64]
theta_kv0924_100_200 = [15.38,64.79,86.22,65.81]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24

;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 1L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}
dummy3  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(3)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0       6.0      15.0      30.0
print, hfc0, format='(";",8f10.1)'
;      20.0      30.0     150.0     150.0

vector_mv_plot,DATE=date,MYMAG=dummy1,FCUTOFF=[lfc0[1],hfc0[1]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy3,FCUTOFF=[lfc0[3],hfc0[3]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

bvec0   = [-0.32568, 0.87399, 0.36066]
bmag0   = [41.91208]
;-----------------------------------------------------------------------------------------
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:22:26.632 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 1066-1229
;Plot Range: 23:22:27.2005-23:22:27.2875
;The angle between DC-Field and the k-vector is :
;       64.977 +/- 0.991 degrees
;The eigenvalues ratios are:
;       22.594221       1.1930579
;The Minimum Variance eigenvector is:
;<-0.21261, 0.93610, 0.28021> +/- < 0.09467, 0.02153,-0.00008>
;
;Plot Index Range: 1822-1897
;Plot Range: 23:22:27.6037-23:22:27.6437
;The angle between DC-Field and the k-vector is :
;       45.576 +/- 1.762 degrees
;The eigenvalues ratios are:
;       16.226427       1.5508503
;The Minimum Variance eigenvector is:
;< 0.12887, 0.49341, 0.86020> +/- < 0.01682,-0.11522, 0.06357>
;

bvec0   = [-0.32568, 0.87399, 0.36066]
bmag0   = [41.91208]

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:22:27.2005',prefd[0]+'23:22:27.2875'])
tr1     = time_double([prefd[0]+'23:22:27.6037',prefd[0]+'23:22:27.6437'])

kvec0   = [-0.21261, 0.93610, 0.28021]
kvec1   = [ 0.12887, 0.49341, 0.86020]

dkvec0  = ABS([ 0.09467, 0.02153,-0.00008])
dkvec1  = ABS([ 0.01682,-0.11522, 0.06357])

elam0   = [22.594221,1.1930579]
elam1   = [16.226427,1.5508503]

bvec0   = [-0.30468, 0.84697, 0.43565]
bvec1   = [-0.36636, 0.85765, 0.36085]
bmag0   = [42.37826]
bmag1   = [42.11877]

tags    = ['t0','t1']
tr_str  = CREATE_STRUCT(tags,tr0,tr1)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:22:26.632 UT
;
;   23:22:27.2005-23:22:27.2875     -0.213      0.936      0.280     -0.305      0.847      0.436     42.378
;   23:22:27.6037-23:22:27.6437      0.129      0.493      0.860     -0.366      0.858      0.361     42.119

vswu   = [-680.323,-21.010,-101.289]         ; => My 3DP estimates (km/s) For 1998-09-24/23:22:26.632 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:22:26.632 UT
;
;   23:22:27.2005-23:22:27.2875     11.563    168.437     96.152     83.848     81.931     98.069
;   23:22:27.6037-23:22:27.6437     46.657    133.343    121.310     58.690    105.610     74.390

theta_kb0924_06_30   = DBLARR(nn)
theta_kn0924_06_30   = DBLARR(nn)
theta_kv0924_06_30   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_06_30[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_06_30[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_06_30[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_06_30[j]),  $
                     REFORM(theta_kn0924_06_30[j]),$
                     REFORM(theta_kv0924_06_30[j])
;
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:22:26.632 UT
;
;   23:22:27.2005-23:22:27.2875     11.563     83.848     81.931
;   23:22:27.6037-23:22:27.6437     46.657     58.690     74.390

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_06_30
PRINT,FORMAT=tkbf,theta_kn0924_06_30
PRINT,FORMAT=tkbf,theta_kv0924_06_30

theta_kb0924_06_30 = [11.56,46.66]
theta_kn0924_06_30 = [83.85,58.69]
theta_kv0924_06_30 = [81.93,74.39]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24

;-----------------------------------------------------------------------------------------
; => For  30 Hz < f < 150 Hz  at  1998-09-24/23:22:26.632 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 74-122
;Plot Range: 23:22:26.6715-23:22:26.6971
;The angle between DC-Field and the k-vector is :
;       66.798 +/- 3.055 degrees
;The eigenvalues ratios are:
;       9.3760658       1.3031405
;The Minimum Variance eigenvector is:
;<-0.64150, 0.52412, 0.56015> +/- < 0.14226, 0.01347, 0.15032>
;
;Plot Index Range: 160-228
;Plot Range: 23:22:26.7173-23:22:26.7536
;The angle between DC-Field and the k-vector is :
;       86.270 +/- 2.387 degrees
;The eigenvalues ratios are:
;       10.506212       1.8029687
;The Minimum Variance eigenvector is:
;< 0.71280,-0.69465,-0.09679> +/- <-0.11640,-0.11493,-0.03234>
;
;Plot Index Range: 951-1143
;Plot Range: 23:22:27.1392-23:22:27.2416
;The angle between DC-Field and the k-vector is :
;       12.576 +/- 1.082 degrees
;The eigenvalues ratios are:
;       16.632537       1.1590005
;The Minimum Variance eigenvector is:
;< 0.52367,-0.78543,-0.32994> +/- < 0.08118, 0.06745,-0.03171>
;
;Plot Index Range: 951-1095
;Plot Range: 23:22:27.1392-23:22:27.2160
;The angle between DC-Field and the k-vector is :
;       14.302 +/- 1.003 degrees
;The eigenvalues ratios are:
;       24.784392       1.1728461
;The Minimum Variance eigenvector is:
;< 0.54597,-0.78904,-0.28165> +/- < 0.06645, 0.05887,-0.03611>
;
;Plot Index Range: 987-1095
;Plot Range: 23:22:27.1584-23:22:27.2160
;The angle between DC-Field and the k-vector is :
;       12.665 +/- 1.024 degrees
;The eigenvalues ratios are:
;       31.226731       1.1158382
;The Minimum Variance eigenvector is:
;<-0.52456, 0.79264, 0.31075> +/- < 0.04517,-0.00176, 0.08074>
;
;Plot Index Range: 1122-1164
;Plot Range: 23:22:27.2304-23:22:27.2528
;The angle between DC-Field and the k-vector is :
;       56.952 +/- 2.796 degrees
;The eigenvalues ratios are:
;       12.160326       1.2067213
;The Minimum Variance eigenvector is:
;< 0.34924,-0.85848,-0.37556> +/- < 0.15553, 0.08982,-0.06069>
;
;Plot Index Range: 1182-1244
;Plot Range: 23:22:27.2624-23:22:27.2955
;The angle between DC-Field and the k-vector is :
;       79.518 +/- 1.920 degrees
;The eigenvalues ratios are:
;       16.545702       1.2760096
;The Minimum Variance eigenvector is:
;<-0.44432, 0.89542,-0.02824> +/- < 0.11856, 0.05701,-0.05782>
;
;Plot Index Range: 1245-1308
;Plot Range: 23:22:27.2960-23:22:27.3296
;The angle between DC-Field and the k-vector is :
;       83.059 +/- 1.523 degrees
;The eigenvalues ratios are:
;       24.801793       1.4979471
;The Minimum Variance eigenvector is:
;<-0.32069, 0.88028, 0.34966> +/- < 0.07876,-0.00284, 0.07939>
;
;Plot Index Range: 1386-1552
;Plot Range: 23:22:27.3712-23:22:27.4597
;The angle between DC-Field and the k-vector is :
;       68.122 +/- 0.769 degrees
;The eigenvalues ratios are:
;       35.607369       1.0883827
;The Minimum Variance eigenvector is:
;< 0.67797,-0.71937,-0.15119> +/- < 0.00032, 0.01635,-0.07635>
;
;Plot Index Range: 1386-1462
;Plot Range: 23:22:27.3712-23:22:27.4117
;The angle between DC-Field and the k-vector is :
;       85.094 +/- 0.906 degrees
;The eigenvalues ratios are:
;       55.258621       1.3851709
;The Minimum Variance eigenvector is:
;< 0.79207,-0.59819,-0.12160> +/- <-0.04390,-0.05571,-0.01187>
;
;Plot Index Range: 1405-1462
;Plot Range: 23:22:27.3813-23:22:27.4117
;The angle between DC-Field and the k-vector is :
;       81.873 +/- 0.739 degrees
;The eigenvalues ratios are:
;       109.30998       1.6059219
;The Minimum Variance eigenvector is:
;< 0.76191,-0.63565,-0.12426> +/- <-0.03380,-0.04098, 0.00242>
;
;Plot Index Range: 1463-1527
;Plot Range: 23:22:27.4123-23:22:27.4464
;The angle between DC-Field and the k-vector is :
;       82.436 +/- 0.734 degrees
;The eigenvalues ratios are:
;       98.827240       1.0302008
;The Minimum Variance eigenvector is:
;<-0.66600, 0.73099, 0.14869> +/- < 0.03129, 0.01885, 0.04748>
;

bvec0   = [-0.32568, 0.87399, 0.36066]
bmag0   = [41.91208]

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:22:26.7173',prefd[0]+'23:22:26.7536'])
tr1     = time_double([prefd[0]+'23:22:27.1584',prefd[0]+'23:22:27.2160'])
tr2     = time_double([prefd[0]+'23:22:27.2304',prefd[0]+'23:22:27.2528'])
tr3     = time_double([prefd[0]+'23:22:27.2624',prefd[0]+'23:22:27.2955'])
tr4     = time_double([prefd[0]+'23:22:27.2960',prefd[0]+'23:22:27.3296'])
tr5     = time_double([prefd[0]+'23:22:27.3813',prefd[0]+'23:22:27.4117'])
tr6     = time_double([prefd[0]+'23:22:27.4123',prefd[0]+'23:22:27.4464'])

kvec0   = [ 0.71280,-0.69465,-0.09679]
kvec1   = [-0.52456, 0.79264, 0.31075]
kvec2   = [ 0.34924,-0.85848,-0.37556]
kvec3   = [-0.44432, 0.89542,-0.02824]
kvec4   = [-0.32069, 0.88028, 0.34966]
kvec5   = [ 0.76191,-0.63565,-0.12426]
kvec6   = [-0.66600, 0.73099, 0.14869]

dkvec0  = ABS([-0.11640,-0.11493,-0.03234])
dkvec1  = ABS([ 0.04517,-0.00176, 0.08074])
dkvec2  = ABS([ 0.15553, 0.08982,-0.06069])
dkvec3  = ABS([ 0.11856, 0.05701,-0.05782])
dkvec4  = ABS([ 0.07876,-0.00284, 0.07939])
dkvec5  = ABS([-0.03380,-0.04098, 0.00242])
dkvec6  = ABS([ 0.03129, 0.01885, 0.04748])

elam0   = [10.506212,1.8029687]
elam1   = [31.226731,1.1158382]
elam2   = [12.160326,1.2067213]
elam3   = [16.545702,1.2760096]
elam4   = [24.801793,1.4979471]
elam5   = [109.30998,1.6059219]
elam6   = [98.827240,1.0302008]

bvec0   = [-0.28970, 0.88420, 0.36642]
bvec1   = [-0.30146, 0.85067, 0.43067]
bvec2   = [-0.30327, 0.84642, 0.43773]
bvec3   = [-0.30940, 0.84618, 0.43387]
bvec4   = [-0.31625, 0.84668, 0.42791]
bvec5   = [-0.33350, 0.85107, 0.40551]
bvec6   = [-0.34033, 0.85328, 0.39506]
bmag0   = [42.41395]
bmag1   = [42.23297]
bmag2   = [42.39689]
bmag3   = [42.41665]
bmag4   = [42.41032]
bmag5   = [42.49598]
bmag6   = [42.54431]

tags    = ['t0','t1','t2','t3','t4','t5','t6']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5,tr6)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  30 Hz < f < 150 Hz  at  1998-09-24/23:22:26.632 UT
;
;   23:22:26.7173-23:22:26.7536      0.713     -0.695     -0.097     -0.290      0.884      0.366     42.414
;   23:22:27.1584-23:22:27.2160     -0.525      0.793      0.311     -0.301      0.851      0.431     42.233
;   23:22:27.2304-23:22:27.2528      0.349     -0.858     -0.376     -0.303      0.846      0.438     42.397
;   23:22:27.2624-23:22:27.2955     -0.444      0.895     -0.028     -0.309      0.846      0.434     42.417
;   23:22:27.2960-23:22:27.3296     -0.321      0.880      0.350     -0.316      0.847      0.428     42.410
;   23:22:27.3813-23:22:27.4117      0.762     -0.636     -0.124     -0.334      0.851      0.406     42.496
;   23:22:27.4123-23:22:27.4464     -0.666      0.731      0.149     -0.340      0.853      0.395     42.544

vswu   = [-680.323,-21.010,-101.289]         ; => My 3DP estimates (km/s) For 1998-09-24/23:22:26.632 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  30 Hz < f < 150 Hz  at  1998-09-24/23:22:26.632 UT
;
;   23:22:26.7173-23:22:26.7536    148.890     31.110    117.754     62.246    132.009     47.991
;   23:22:27.1584-23:22:27.2160     14.930    165.070     78.516    101.484     63.342    116.658
;   23:22:27.2304-23:22:27.2528    175.515      4.485     90.130     89.870    105.295     74.705
;   23:22:27.2624-23:22:27.2955     28.005    151.995     77.365    102.635     65.412    114.588
;   23:22:27.2960-23:22:27.3296      4.891    175.109     91.134     88.866     76.190    103.810
;   23:22:27.3813-23:22:27.4117    147.722     32.278    120.942     59.058    135.689     44.311
;   23:22:27.4123-23:22:27.4464     24.613    155.387     66.597    113.403     52.104    127.896

theta_kb0924_30_150   = DBLARR(nn)
theta_kn0924_30_150   = DBLARR(nn)
theta_kv0924_30_150   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_30_150[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_30_150[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_30_150[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_30_150[j]),  $
                     REFORM(theta_kn0924_30_150[j]),$
                     REFORM(theta_kv0924_30_150[j])
;
; => For  30 Hz < f < 150 Hz  at  1998-09-24/23:22:26.632 UT
;
;   23:22:26.7173-23:22:26.7536     31.110     62.246     47.991
;   23:22:27.1584-23:22:27.2160     14.930     78.516     63.342
;   23:22:27.2304-23:22:27.2528      4.485     89.870     74.705
;   23:22:27.2624-23:22:27.2955     28.005     77.365     65.412
;   23:22:27.2960-23:22:27.3296      4.891     88.866     76.190
;   23:22:27.3813-23:22:27.4117     32.278     59.058     44.311
;   23:22:27.4123-23:22:27.4464     24.613     66.597     52.104

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_30_150
PRINT,FORMAT=tkbf,theta_kn0924_30_150
PRINT,FORMAT=tkbf,theta_kv0924_30_150

theta_kb0924_30_150 = [31.11,14.93, 4.48,28.00, 4.89,32.28,24.61]
theta_kn0924_30_150 = [62.25,78.52,89.87,77.36,88.87,59.06,66.60]
theta_kv0924_30_150 = [47.99,63.34,74.71,65.41,76.19,44.31,52.10]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 2L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}
dummy3  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(3)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0       6.0      15.0      30.0
print, hfc0, format='(";",8f10.1)'
;      20.0      30.0     150.0     150.0

vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy1,FCUTOFF=[lfc0[1],hfc0[1]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy3,FCUTOFF=[lfc0[3],hfc0[3]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

bvec0   = [-0.27292, 0.90549, 0.32495]
bmag0   = [42.01608]
;-----------------------------------------------------------------------------------------
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:22:48.150 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 0-168
;Plot Range: 23:22:48.1500-23:22:48.2396
;The angle between DC-Field and the k-vector is :
;       26.480 +/- 0.423 degrees
;The eigenvalues ratios are:
;       111.82964       2.1455052
;The Minimum Variance eigenvector is:
;<-0.01574,-0.76014,-0.64956> +/- < 0.03550,-0.00927, 0.00998>
;
;Plot Index Range: 169-254
;Plot Range: 23:22:48.2401-23:22:48.2855
;The angle between DC-Field and the k-vector is :
;       58.748 +/- 0.986 degrees
;The eigenvalues ratios are:
;       42.189306       1.8269140
;The Minimum Variance eigenvector is:
;<-0.07880,-0.70006,-0.70972> +/- <-0.07008,-0.01666, 0.02421>
;
;Plot Index Range: 347-437
;Plot Range: 23:22:48.3351-23:22:48.3831
;The angle between DC-Field and the k-vector is :
;       75.559 +/- 0.218 degrees
;The eigenvalues ratios are:
;       778.13114       1.3627853
;The Minimum Variance eigenvector is:
;<-0.19814,-0.74365,-0.63853> +/- < 0.00449, 0.01084,-0.01402>
;
;Plot Index Range: 702-915
;Plot Range: 23:22:48.5244-23:22:48.6380
;The angle between DC-Field and the k-vector is :
;       41.199 +/- 1.196 degrees
;The eigenvalues ratios are:
;       12.742375       1.2129027
;The Minimum Variance eigenvector is:
;<-0.20663, 0.82608, 0.52431> +/- <-0.10755, 0.00972,-0.05770>
;
;Plot Index Range: 1179-1296
;Plot Range: 23:22:48.7788-23:22:48.8412
;The angle between DC-Field and the k-vector is :
;       68.583 +/- 0.776 degrees
;The eigenvalues ratios are:
;       48.934482       1.9241530
;The Minimum Variance eigenvector is:
;< 0.19920, 0.95497, 0.21990> +/- <-0.05693, 0.00503, 0.02971>
;
;Plot Index Range: 1617-1734
;Plot Range: 23:22:49.0124-23:22:49.0748
;The angle between DC-Field and the k-vector is :
;       35.812 +/- 1.110 degrees
;The eigenvalues ratios are:
;       24.942817       2.2288402
;The Minimum Variance eigenvector is:
;< 0.58830,-0.17706,-0.78902> +/- <-0.01087, 0.08394,-0.02694>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:22:48.1500',prefd[0]+'23:22:48.2396'])
tr1     = time_double([prefd[0]+'23:22:48.2401',prefd[0]+'23:22:48.2855'])
tr2     = time_double([prefd[0]+'23:22:48.3351',prefd[0]+'23:22:48.3831'])
tr3     = time_double([prefd[0]+'23:22:48.5244',prefd[0]+'23:22:48.6380'])
tr4     = time_double([prefd[0]+'23:22:48.7788',prefd[0]+'23:22:48.8412'])
tr5     = time_double([prefd[0]+'23:22:49.0124',prefd[0]+'23:22:49.0748'])

kvec0   = [-0.01574,-0.76014,-0.64956]
kvec1   = [-0.07880,-0.70006,-0.70972]
kvec2   = [-0.19814,-0.74365,-0.63853]
kvec3   = [-0.20663, 0.82608, 0.52431]
kvec4   = [ 0.19920, 0.95497, 0.21990]
kvec5   = [ 0.58830,-0.17706,-0.78902]

dkvec0  = ABS([ 0.03550,-0.00927, 0.00998])
dkvec1  = ABS([-0.07008,-0.01666, 0.02421])
dkvec2  = ABS([ 0.00449, 0.01084,-0.01402])
dkvec3  = ABS([-0.10755, 0.00972,-0.05770])
dkvec4  = ABS([-0.05693, 0.00503, 0.02971])
dkvec5  = ABS([-0.01087, 0.08394,-0.02694])

elam0   = [111.82964,2.1455052]
elam1   = [42.189306,1.8269140]
elam2   = [778.13114,1.3627853]
elam3   = [12.742375,1.2129027]
elam4   = [48.934482,1.9241530]
elam5   = [24.942817,2.2288402]

bvec0   = [-0.33802, 0.88378, 0.32349]
bvec1   = [-0.33598, 0.88827, 0.31320]
bvec2   = [-0.33019, 0.89351, 0.30432]
bvec3   = [-0.32260, 0.90142, 0.28872]
bvec4   = [-0.30031, 0.91380, 0.27344]
bvec5   = [-0.27801, 0.91480, 0.29299]
bmag0   = [42.32958]
bmag1   = [42.30051]
bmag2   = [42.25578]
bmag3   = [42.54726]
bmag4   = [42.32404]
bmag5   = [42.44916]

tags    = ['t0','t1','t2','t3','t4','t5']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:22:48.150 UT
;
;   23:22:48.1500-23:22:48.2396     -0.016     -0.760     -0.650     -0.338      0.884      0.323     42.330
;   23:22:48.2401-23:22:48.2855     -0.079     -0.700     -0.710     -0.336      0.888      0.313     42.301
;   23:22:48.3351-23:22:48.3831     -0.198     -0.744     -0.639     -0.330      0.894      0.304     42.256
;   23:22:48.5244-23:22:48.6380     -0.207      0.826      0.524     -0.323      0.901      0.289     42.547
;   23:22:48.7788-23:22:48.8412      0.199      0.955      0.220     -0.300      0.914      0.273     42.324
;   23:22:49.0124-23:22:49.0748      0.588     -0.177     -0.789     -0.278      0.915      0.293     42.449

vswu   = [-679.474,-28.766,-89.172]         ; => My 3DP estimates (km/s) For 1998-09-24/23:22:48.150 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:22:48.150 UT
;
;   23:22:48.1500-23:22:48.2396    151.236     28.764     66.227    113.773     82.420     97.580
;   23:22:48.2401-23:22:48.2855    144.850     35.150     62.092    117.908     78.481    101.519
;   23:22:48.3351-23:22:48.3831    142.500     37.500     55.775    124.225     71.912    108.088
;   23:22:48.5244-23:22:48.6380     15.701    164.299     99.885     80.115     84.152     95.848
;   23:22:48.7788-23:22:48.8412     29.195    150.805    117.849     62.151    105.425     74.575
;   23:22:49.0124-23:22:49.0748    123.828     56.172    103.279     76.721    118.215     61.785

theta_kb0924_06_30_2 = DBLARR(nn)
theta_kn0924_06_30_2 = DBLARR(nn)
theta_kv0924_06_30_2 = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_06_30_2[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_06_30_2[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_06_30_2[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_06_30_2[j]),  $
                     REFORM(theta_kn0924_06_30_2[j]),$
                     REFORM(theta_kv0924_06_30_2[j])
;
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:22:48.150 UT
;
;   23:22:48.1500-23:22:48.2396     28.764     66.227     82.420
;   23:22:48.2401-23:22:48.2855     35.150     62.092     78.481
;   23:22:48.3351-23:22:48.3831     37.500     55.775     71.912
;   23:22:48.5244-23:22:48.6380     15.701     80.115     84.152
;   23:22:48.7788-23:22:48.8412     29.195     62.151     74.575
;   23:22:49.0124-23:22:49.0748     56.172     76.721     61.785

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_06_30_2
PRINT,FORMAT=tkbf,theta_kn0924_06_30_2
PRINT,FORMAT=tkbf,theta_kv0924_06_30_2

theta_kb0924_06_30_2 = [28.76,35.15,37.50,15.70,29.20,56.17]
theta_kn0924_06_30_2 = [66.23,62.09,55.78,80.12,62.15,76.72]
theta_kv0924_06_30_2 = [82.42,78.48,71.91,84.15,74.58,61.78]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
; => For  30 Hz < f < 150 Hz  at  1998-09-24/23:22:48.150 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 63-189
;Plot Range: 23:22:48.1836-23:22:48.2508
;The angle between DC-Field and the k-vector is :
;       86.535 +/- 1.021 degrees
;The eigenvalues ratios are:
;       27.160724       1.5877689
;The Minimum Variance eigenvector is:
;< 0.30632,-0.81107,-0.49834> +/- < 0.07738, 0.03957,-0.01684>
;
;Plot Index Range: 370-415
;Plot Range: 23:22:48.3473-23:22:48.3713
;The angle between DC-Field and the k-vector is :
;       17.304 +/- 1.466 degrees
;The eigenvalues ratios are:
;       36.690574       1.1342159
;The Minimum Variance eigenvector is:
;< 0.39593,-0.79206,-0.46462> +/- < 0.09198, 0.05166,-0.00969>
;
;Plot Index Range: 468-510
;Plot Range: 23:22:48.3996-23:22:48.4220
;The angle between DC-Field and the k-vector is :
;       80.589 +/- 2.109 degrees
;The eigenvalues ratios are:
;       19.944872       1.2697517
;The Minimum Variance eigenvector is:
;<-0.06917, 0.92173, 0.38161> +/- < 0.11702,-0.02446, 0.08028>
;
;Plot Index Range: 669-740
;Plot Range: 23:22:48.5068-23:22:48.5447
;The angle between DC-Field and the k-vector is :
;       89.998 +/- 1.251 degrees
;The eigenvalues ratios are:
;       31.924088       1.6022743
;The Minimum Variance eigenvector is:
;< 0.66870,-0.70251,-0.24357> +/- < 0.02720, 0.05148,-0.07380>
;
;Plot Index Range: 886-952
;Plot Range: 23:22:48.6225-23:22:48.6577
;The angle between DC-Field and the k-vector is :
;       88.392 +/- 2.173 degrees
;The eigenvalues ratios are:
;       12.620580       1.5001507
;The Minimum Variance eigenvector is:
;< 0.59137,-0.56090,-0.57938> +/- <-0.03562, 0.09061,-0.12408>
;
;Plot Index Range: 953-1055
;Plot Range: 23:22:48.6583-23:22:48.7127
;The angle between DC-Field and the k-vector is :
;       36.824 +/- 1.305 degrees
;The eigenvalues ratios are:
;       21.035347       1.0558565
;The Minimum Variance eigenvector is:
;< 0.40501,-0.48346,-0.77603> +/- <-0.05083, 0.07534,-0.07347>
;
;Plot Index Range: 1498-1543
;Plot Range: 23:22:48.9489-23:22:48.9729
;The angle between DC-Field and the k-vector is :
;       29.139 +/- 1.070 degrees
;The eigenvalues ratios are:
;       67.094544       1.0558747
;The Minimum Variance eigenvector is:
;<-0.04915,-0.94556,-0.32172> +/- < 0.02063, 0.02368,-0.07275>
;
;Plot Index Range: 1747-1792
;Plot Range: 23:22:49.0817-23:22:49.1057
;The angle between DC-Field and the k-vector is :
;       14.636 +/- 1.977 degrees
;The eigenvalues ratios are:
;       21.044902       1.5351499
;The Minimum Variance eigenvector is:
;<-0.72440, 0.61616, 0.30918> +/- <-0.04990, 0.00268,-0.12227>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:22:48.1836',prefd[0]+'23:22:48.2508'])
tr1     = time_double([prefd[0]+'23:22:48.3473',prefd[0]+'23:22:48.3713'])
tr2     = time_double([prefd[0]+'23:22:48.3996',prefd[0]+'23:22:48.4220'])
tr3     = time_double([prefd[0]+'23:22:48.5068',prefd[0]+'23:22:48.5447'])
tr4     = time_double([prefd[0]+'23:22:48.6225',prefd[0]+'23:22:48.6577'])
tr5     = time_double([prefd[0]+'23:22:48.6583',prefd[0]+'23:22:48.7127'])
tr6     = time_double([prefd[0]+'23:22:48.9489',prefd[0]+'23:22:48.9729'])
tr7     = time_double([prefd[0]+'23:22:49.0817',prefd[0]+'23:22:49.1057'])

kvec0   = [ 0.30632,-0.81107,-0.49834]
kvec1   = [ 0.39593,-0.79206,-0.46462]
kvec2   = [-0.06917, 0.92173, 0.38161]
kvec3   = [ 0.66870,-0.70251,-0.24357]
kvec4   = [ 0.59137,-0.56090,-0.57938]
kvec5   = [ 0.40501,-0.48346,-0.77603]
kvec6   = [-0.04915,-0.94556,-0.32172]
kvec7   = [-0.72440, 0.61616, 0.30918]

dkvec0  = ABS([ 0.07738, 0.03957,-0.01684])
dkvec1  = ABS([ 0.09198, 0.05166,-0.00969])
dkvec2  = ABS([ 0.11702,-0.02446, 0.08028])
dkvec3  = ABS([ 0.02720, 0.05148,-0.07380])
dkvec4  = ABS([-0.03562, 0.09061,-0.12408])
dkvec5  = ABS([-0.05083, 0.07534,-0.07347])
dkvec6  = ABS([ 0.02063, 0.02368,-0.07275])
dkvec7  = ABS([-0.04990, 0.00268,-0.12227])

elam0   = [27.160724,1.5877689]
elam1   = [36.690574,1.1342159]
elam2   = [19.944872,1.2697517]
elam3   = [31.924088,1.6022743]
elam4   = [12.620580,1.5001507]
elam5   = [21.035347,1.0558565]
elam6   = [67.094544,1.0558747]
elam7   = [21.044902,1.5351499]

bvec0   = [-0.33760, 0.88533, 0.31971]
bvec1   = [-0.33021, 0.89350, 0.30433]
bvec2   = [-0.32621, 0.89574, 0.30205]
bvec3   = [-0.32344, 0.89947, 0.29383]
bvec4   = [-0.32080, 0.90274, 0.28662]
bvec5   = [-0.31811, 0.90388, 0.28603]
bvec6   = [-0.28310, 0.91451, 0.28900]
bvec7   = [-0.27319, 0.91639, 0.29258]
bmag0   = [42.31942]
bmag1   = [42.25590]
bmag2   = [42.23702]
bmag3   = [42.52070]
bmag4   = [42.50772]
bmag5   = [42.44091]
bmag6   = [42.14798]
bmag7   = [42.49588]

tags    = ['t0','t1','t2','t3','t4','t5','t6','t7']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  30 Hz < f < 150 Hz  at  1998-09-24/23:22:48.150 UT
;
;   23:22:48.1836-23:22:48.2508      0.306     -0.811     -0.498     -0.338      0.885      0.320     42.319
;   23:22:48.3473-23:22:48.3713      0.396     -0.792     -0.465     -0.330      0.893      0.304     42.256
;   23:22:48.3996-23:22:48.4220     -0.069      0.922      0.382     -0.326      0.896      0.302     42.237
;   23:22:48.5068-23:22:48.5447      0.669     -0.703     -0.244     -0.323      0.899      0.294     42.521
;   23:22:48.6225-23:22:48.6577      0.591     -0.561     -0.579     -0.321      0.903      0.287     42.508
;   23:22:48.6583-23:22:48.7127      0.405     -0.483     -0.776     -0.318      0.904      0.286     42.441
;   23:22:48.9489-23:22:48.9729     -0.049     -0.946     -0.322     -0.283      0.915      0.289     42.148
;   23:22:49.0817-23:22:49.1057     -0.724      0.616      0.309     -0.273      0.916      0.293     42.496

vswu   = [-679.474,-28.766,-89.172]         ; => My 3DP estimates (km/s) For 1998-09-24/23:22:48.150 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  30 Hz < f < 150 Hz  at  1998-09-24/23:22:48.150 UT
;
;   23:22:48.1836-23:22:48.2508    168.754     11.246     86.078     93.922    101.809     78.191
;   23:22:48.3473-23:22:48.3713    168.477     11.523     91.673     88.327    107.373     72.627
;   23:22:48.3996-23:22:48.4220     15.536    164.464    105.646     74.354     91.131     88.869
;   23:22:48.5068-23:22:48.5447    156.888     23.112    111.937     68.063    126.963     53.037
;   23:22:48.6225-23:22:48.6577    149.555     30.445    102.682     77.318    119.142     60.858
;   23:22:48.6583-23:22:48.7127    141.979     38.021     89.954     90.046    106.263     73.737
;   23:22:48.9489-23:22:48.9729    160.698     19.302     68.737    111.263     82.521     97.479
;   23:22:49.0817-23:22:49.1057     31.461    148.539     65.095    114.905     49.340    130.660

theta_kb0924_30_150_2 = DBLARR(nn)
theta_kn0924_30_150_2 = DBLARR(nn)
theta_kv0924_30_150_2 = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_30_150_2[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_30_150_2[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_30_150_2[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_30_150_2[j]),  $
                     REFORM(theta_kn0924_30_150_2[j]),$
                     REFORM(theta_kv0924_30_150_2[j])
;
; => For  30 Hz < f < 150 Hz  at  1998-09-24/23:22:48.150 UT
;
;   23:22:48.1836-23:22:48.2508     11.246     86.078     78.191
;   23:22:48.3473-23:22:48.3713     11.523     88.327     72.627
;   23:22:48.3996-23:22:48.4220     15.536     74.354     88.869
;   23:22:48.5068-23:22:48.5447     23.112     68.063     53.037
;   23:22:48.6225-23:22:48.6577     30.445     77.318     60.858
;   23:22:48.6583-23:22:48.7127     38.021     89.954     73.737
;   23:22:48.9489-23:22:48.9729     19.302     68.737     82.521
;   23:22:49.0817-23:22:49.1057     31.461     65.095     49.340

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_30_150_2
PRINT,FORMAT=tkbf,theta_kn0924_30_150_2
PRINT,FORMAT=tkbf,theta_kv0924_30_150_2

theta_kb0924_30_150_2 = [11.25,11.52,15.54,23.11,30.44,38.02,19.30,31.46]
theta_kn0924_30_150_2 = [86.08,88.33,74.35,68.06,77.32,89.95,68.74,65.09]
theta_kv0924_30_150_2 = [78.19,72.63,88.87,53.04,60.86,73.74,82.52,49.34]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24

;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 4L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}
dummy3  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(3)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0      10.0      40.0     200.0
print, hfc0, format='(";",8f10.1)'
;      40.0      40.0     100.0     400.0

vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy1,FCUTOFF=[lfc0[1],hfc0[1]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy2,FCUTOFF=[lfc0[2],hfc0[2]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy3,FCUTOFF=[lfc0[3],hfc0[3]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

bvec0   = [-0.42021, 0.76672, 0.48535]
bmag0   = [40.79511]
;-----------------------------------------------------------------------------------------
; => For  3 Hz < f < 40 Hz  at  1998-09-24/23:30:48.542 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 622-892
;Plot Range: 23:30:48.8737-23:30:49.0177
;The angle between DC-Field and the k-vector is :
;       31.768 +/- 0.576 degrees
;The eigenvalues ratios are:
;       38.810429       3.2816307
;The Minimum Variance eigenvector is:
;< 0.78336, 0.62028, 0.03993> +/- < 0.03110,-0.04049, 0.01886>
;
;Plot Index Range: 1470-1794
;Plot Range: 23:30:49.3260-23:30:49.4988
;The angle between DC-Field and the k-vector is :
;       88.920 +/- 0.414 degrees
;The eigenvalues ratios are:
;       61.373437       1.6935611
;The Minimum Variance eigenvector is:
;< 0.69672,-0.60070,-0.39209> +/- <-0.00871,-0.03104, 0.03207>
;
;Plot Index Range: 1551-1794
;Plot Range: 23:30:49.3692-23:30:49.4988
;The angle between DC-Field and the k-vector is :
;       86.775 +/- 0.551 degrees
;The eigenvalues ratios are:
;       46.618949       2.6676104
;The Minimum Variance eigenvector is:
;< 0.71066,-0.58173,-0.39567> +/- < 0.03653, 0.03377, 0.01596>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:30:48.8737',prefd[0]+'23:30:49.0177'])
tr1     = time_double([prefd[0]+'23:30:49.3260',prefd[0]+'23:30:49.4988'])
tr2     = time_double([prefd[0]+'23:30:49.3692',prefd[0]+'23:30:49.4988'])

kvec0   = [ 0.78336, 0.62028, 0.03993]
kvec1   = [ 0.69672,-0.60070,-0.39209]
kvec2   = [ 0.71066,-0.58173,-0.39567]

dkvec0  = ABS([ 0.03110,-0.04049, 0.01886])
dkvec1  = ABS([-0.00871,-0.03104, 0.03207])
dkvec2  = ABS([ 0.03653, 0.03377, 0.01596])

elam0   = [38.810429,3.2816307]
elam1   = [61.373437,1.6935611]
elam2   = [46.618949,2.6676104]

bvec0   = [-0.44455, 0.73332, 0.51438]
bvec1   = [-0.46540, 0.75193, 0.46689]
bvec2   = [-0.46517, 0.75298, 0.46544]
bmag0   = [40.47744]
bmag1   = [41.20196]
bmag2   = [41.21673]

tags    = ['t0','t1','t2']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  3 Hz < f < 40 Hz  at  1998-09-24/23:30:48.542 UT
;
;   23:30:48.8737-23:30:49.0177      0.783      0.620      0.040     -0.445      0.733      0.514     40.477
;   23:30:49.3260-23:30:49.4988      0.697     -0.601     -0.392     -0.465      0.752      0.467     41.202
;   23:30:49.3692-23:30:49.4988      0.711     -0.582     -0.396     -0.465      0.753      0.465     41.217

vswu   = [-648.959,-28.025,-84.072]         ; => My 3DP estimates (km/s) For 1998-09-24/23:30:48.542 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  3 Hz < f < 40 Hz  at  1998-09-24/23:30:48.542 UT
;
;   23:30:48.8737-23:30:49.0177     82.694     97.306    150.005     29.995    143.884     36.116
;   23:30:49.3260-23:30:49.4988    163.537     16.463    111.774     68.226    127.900     52.100
;   23:30:49.3692-23:30:49.4988    162.320     17.680    112.746     67.254    128.936     51.064

theta_kb0924_03_40   = DBLARR(nn)
theta_kn0924_03_40   = DBLARR(nn)
theta_kv0924_03_40   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_03_40[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_03_40[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_03_40[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_03_40[j]),  $
                     REFORM(theta_kn0924_03_40[j]),$
                     REFORM(theta_kv0924_03_40[j])
;
; => For  3 Hz < f < 40 Hz  at  1998-09-24/23:30:48.542 UT
;
;   23:30:48.8737-23:30:49.0177     82.694     29.995     36.116
;   23:30:49.3260-23:30:49.4988     16.463     68.226     52.100
;   23:30:49.3692-23:30:49.4988     17.680     67.254     51.064

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_03_40
PRINT,FORMAT=tkbf,theta_kn0924_03_40
PRINT,FORMAT=tkbf,theta_kv0924_03_40

theta_kb0924_03_40 = [82.69,16.46,17.68]
theta_kn0924_03_40 = [30.00,68.23,67.25]
theta_kv0924_03_40 = [36.12,52.10,51.06]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24

;-----------------------------------------------------------------------------------------
; => For  40 Hz < f < 100 Hz  at  1998-09-24/23:30:48.542 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 746-805
;Plot Range: 23:30:48.9399-23:30:48.9713
;The angle between DC-Field and the k-vector is :
;       83.035 +/- 2.091 degrees
;The eigenvalues ratios are:
;       14.873432       2.0486695
;The Minimum Variance eigenvector is:
;<-0.90673,-0.21579, 0.36232> +/- < 0.03613, 0.05570, 0.12360>
;
;Plot Index Range: 1210-1280
;Plot Range: 23:30:49.1873-23:30:49.2247
;The angle between DC-Field and the k-vector is :
;       89.443 +/- 1.747 degrees
;The eigenvalues ratios are:
;       17.534031       4.1343476
;The Minimum Variance eigenvector is:
;< 0.70070, 0.61248, 0.36590> +/- <-0.07845, 0.05370, 0.06034>
;


;-----------------------------------------------------------------------------------------
; => For  200 Hz < f < 400 Hz  at  1998-09-24/23:30:48.542 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 0-255
;Plot Range: 23:30:48.5420-23:30:48.6780
;The angle between DC-Field and the k-vector is :
;       34.397 +/- 0.790 degrees
;The eigenvalues ratios are:
;       22.672985       4.7698312
;The Minimum Variance eigenvector is:
;< 0.72057,-0.27962,-0.63450> +/- < 0.01936, 0.06701,-0.00755>
;
;Plot Index Range: 15-52
;Plot Range: 23:30:48.5500-23:30:48.5697
;The angle between DC-Field and the k-vector is :
;       45.879 +/- 1.721 degrees
;The eigenvalues ratios are:
;       32.757588       5.1725034
;The Minimum Variance eigenvector is:
;< 0.73044,-0.33271,-0.59646> +/- < 0.02900, 0.08827,-0.01372>
;
;Plot Index Range: 71-107
;Plot Range: 23:30:48.5799-23:30:48.5991
;The angle between DC-Field and the k-vector is :
;       83.013 +/- 1.248 degrees
;The eigenvalues ratios are:
;       62.194347       4.7739488
;The Minimum Variance eigenvector is:
;< 0.67852,-0.37579,-0.63119> +/- < 0.02831, 0.06220,-0.00660>
;
;Plot Index Range: 144-204
;Plot Range: 23:30:48.6188-23:30:48.6508
;The angle between DC-Field and the k-vector is :
;       85.854 +/- 1.089 degrees
;The eigenvalues ratios are:
;       48.937657       5.1513222
;The Minimum Variance eigenvector is:
;< 0.72408,-0.29306,-0.62436> +/- < 0.01857, 0.06445,-0.00871>
;
;Plot Index Range: 207-234
;Plot Range: 23:30:48.6524-23:30:48.6668
;The angle between DC-Field and the k-vector is :
;       77.773 +/- 2.418 degrees
;The eigenvalues ratios are:
;       23.549643       3.7793534
;The Minimum Variance eigenvector is:
;< 0.67540,-0.17251,-0.71699> +/- < 0.03167, 0.12020, 0.00091>
;
;Plot Index Range: 236-358
;Plot Range: 23:30:48.6679-23:30:48.7329
;The angle between DC-Field and the k-vector is :
;       57.603 +/- 0.764 degrees
;The eigenvalues ratios are:
;       48.400650       4.9905576
;The Minimum Variance eigenvector is:
;< 0.73852,-0.18744,-0.64766> +/- < 0.00964, 0.05592,-0.00520>
;
;Plot Index Range: 236-296
;Plot Range: 23:30:48.6679-23:30:48.6999
;The angle between DC-Field and the k-vector is :
;       89.885 +/- 0.860 degrees
;The eigenvalues ratios are:
;       77.206839       4.1681879
;The Minimum Variance eigenvector is:
;< 0.72033,-0.15381,-0.67637> +/- < 0.00913, 0.05385,-0.00252>
;
;Plot Index Range: 297-342
;Plot Range: 23:30:48.7004-23:30:48.7244
;The angle between DC-Field and the k-vector is :
;       82.948 +/- 0.867 degrees
;The eigenvalues ratios are:
;       101.18191       6.5764968
;The Minimum Variance eigenvector is:
;< 0.75824,-0.25189,-0.60135> +/- < 0.00944, 0.04789,-0.00815>
;
;Plot Index Range: 343-727
;Plot Range: 23:30:48.7249-23:30:48.9297
;The angle between DC-Field and the k-vector is :
;       82.628 +/- 0.555 degrees
;The eigenvalues ratios are:
;       29.786430       4.6934374
;The Minimum Variance eigenvector is:
;< 0.72909,-0.16266,-0.66480> +/- < 0.00928, 0.05418,-0.00308>
;
;Plot Index Range: 494-577
;Plot Range: 23:30:48.8055-23:30:48.8497
;The angle between DC-Field and the k-vector is :
;       66.623 +/- 1.211 degrees
;The eigenvalues ratios are:
;       29.282799       3.9740805
;The Minimum Variance eigenvector is:
;< 0.69150,-0.19666,-0.69509> +/- < 0.02120, 0.08015,-0.00158>
;
;Plot Index Range: 578-721
;Plot Range: 23:30:48.8503-23:30:48.9265
;The angle between DC-Field and the k-vector is :
;       89.231 +/- 0.700 degrees
;The eigenvalues ratios are:
;       49.101080       5.0518233
;The Minimum Variance eigenvector is:
;< 0.73929,-0.14663,-0.65723> +/- < 0.00753, 0.05365,-0.00350>
;
;Plot Index Range: 721-858
;Plot Range: 23:30:48.9265-23:30:48.9996
;The angle between DC-Field and the k-vector is :
;       64.290 +/- 0.962 degrees
;The eigenvalues ratios are:
;       28.073362       4.1683115
;The Minimum Variance eigenvector is:
;< 0.70436,-0.13724,-0.69645> +/- < 0.01481, 0.07283, 0.00063>
;
;Plot Index Range: 859-933
;Plot Range: 23:30:49.0001-23:30:49.0396
;The angle between DC-Field and the k-vector is :
;       69.589 +/- 0.685 degrees
;The eigenvalues ratios are:
;       97.902561       4.9495011
;The Minimum Variance eigenvector is:
;< 0.69449,-0.25131,-0.67419> +/- < 0.01378, 0.04309,-0.00187>
;
;Plot Index Range: 943-973
;Plot Range: 23:30:49.0449-23:30:49.0609
;The angle between DC-Field and the k-vector is :
;       89.475 +/- 0.488 degrees
;The eigenvalues ratios are:
;       476.73567       3.2062222
;The Minimum Variance eigenvector is:
;<-0.00132,-0.00100,-1.00000> +/- < 0.02401,-0.01215,-0.00002>
;
;Plot Index Range: 974-1040
;Plot Range: 23:30:49.0615-23:30:49.0967
;The angle between DC-Field and the k-vector is :
;       60.811 +/- 0.242 degrees
;The eigenvalues ratios are:
;       866.20227       4.7873677
;The Minimum Variance eigenvector is:
;< 0.00049,-0.00278,-1.00000> +/- < 0.01195,-0.01011, 0.00003>
;
;Plot Index Range: 1065-1083
;Plot Range: 23:30:49.1100-23:30:49.1196
;The angle between DC-Field and the k-vector is :
;       89.502 +/- 1.593 degrees
;The eigenvalues ratios are:
;       78.061251       8.0932010
;The Minimum Variance eigenvector is:
;< 0.76387,-0.10524,-0.63674> +/- < 0.00898, 0.07010,-0.00082>
;
;Plot Index Range: 1084-1132
;Plot Range: 23:30:49.1201-23:30:49.1457
;The angle between DC-Field and the k-vector is :
;       81.263 +/- 0.851 degrees
;The eigenvalues ratios are:
;       98.450390       6.2249150
;The Minimum Variance eigenvector is:
;< 0.74922,-0.13205,-0.64902> +/- < 0.00498, 0.04910,-0.00424>
;
;Plot Index Range: 1133-1238
;Plot Range: 23:30:49.1463-23:30:49.2023
;The angle between DC-Field and the k-vector is :
;       88.736 +/- 1.156 degrees
;The eigenvalues ratios are:
;       25.594481       3.7443254
;The Minimum Variance eigenvector is:
;< 0.70280,-0.01649,-0.71120> +/- < 0.00560, 0.08400, 0.00358>
;
;Plot Index Range: 1239-1284
;Plot Range: 23:30:49.2028-23:30:49.2268
;The angle between DC-Field and the k-vector is :
;       87.518 +/- 1.207 degrees
;The eigenvalues ratios are:
;       53.183527       4.6590059
;The Minimum Variance eigenvector is:
;< 0.72118,-0.18955,-0.66631> +/- < 0.01607, 0.06846,-0.00208>
;
;Plot Index Range: 1300-1360
;Plot Range: 23:30:49.2353-23:30:49.2673
;The angle between DC-Field and the k-vector is :
;       89.317 +/- 1.664 degrees
;The eigenvalues ratios are:
;       22.054444       5.0732422
;The Minimum Variance eigenvector is:
;< 0.70746,-0.29336,-0.64299> +/- < 0.03289, 0.09625,-0.00772>
;
;Plot Index Range: 1361-1448
;Plot Range: 23:30:49.2679-23:30:49.3143
;The angle between DC-Field and the k-vector is :
;       79.096 +/- 0.674 degrees
;The eigenvalues ratios are:
;       86.002268       4.4865663
;The Minimum Variance eigenvector is:
;< 0.70623,-0.21445,-0.67473> +/- < 0.01252, 0.04508,-0.00122>
;
;Plot Index Range: 1449-1469
;Plot Range: 23:30:49.3148-23:30:49.3255
;The angle between DC-Field and the k-vector is :
;       85.937 +/- 3.085 degrees
;The eigenvalues ratios are:
;       20.103518       5.6225363
;The Minimum Variance eigenvector is:
;< 0.72313, 0.05159,-0.68878> +/- <-0.01645, 0.13987,-0.00679>
;
;Plot Index Range: 1480-1571
;Plot Range: 23:30:49.3313-23:30:49.3799
;The angle between DC-Field and the k-vector is :
;       77.196 +/- 0.716 degrees
;The eigenvalues ratios are:
;       73.235820       4.7609461
;The Minimum Variance eigenvector is:
;< 0.71911,-0.21629,-0.66038> +/- < 0.01219, 0.04835,-0.00257>
;
;Plot Index Range: 1572-1670
;Plot Range: 23:30:49.3804-23:30:49.4327
;The angle between DC-Field and the k-vector is :
;       86.947 +/- 1.006 degrees
;The eigenvalues ratios are:
;       35.416067       5.1683691
;The Minimum Variance eigenvector is:
;< 0.73942,-0.17522,-0.65004> +/- < 0.01360, 0.06904,-0.00313>
;
;Plot Index Range: 1703-1791
;Plot Range: 23:30:49.4503-23:30:49.4972
;The angle between DC-Field and the k-vector is :
;       74.509 +/- 1.220 degrees
;The eigenvalues ratios are:
;       27.318875       5.5871040
;The Minimum Variance eigenvector is:
;< 0.69126,-0.37399,-0.61829> +/- < 0.03155, 0.07524,-0.01024>
;
;Plot Index Range: 1792-1839
;Plot Range: 23:30:49.4977-23:30:49.5228
;The angle between DC-Field and the k-vector is :
;       73.129 +/- 1.444 degrees
;The eigenvalues ratios are:
;       36.201868       3.3711832
;The Minimum Variance eigenvector is:
;< 0.66885,-0.14658,-0.72880> +/- < 0.02183, 0.08462, 0.00301>
;
;Plot Index Range: 1847-1906
;Plot Range: 23:30:49.5271-23:30:49.5585
;The angle between DC-Field and the k-vector is :
;       82.949 +/- 0.956 degrees
;The eigenvalues ratios are:
;       63.946748       4.8253759
;The Minimum Variance eigenvector is:
;< 0.71783,-0.13677,-0.68265> +/- < 0.00956, 0.05882,-0.00173>
;
;Plot Index Range: 1907-1949
;Plot Range: 23:30:49.5591-23:30:49.5815
;The angle between DC-Field and the k-vector is :
;       88.444 +/- 0.442 degrees
;The eigenvalues ratios are:
;       412.23440       5.3330883
;The Minimum Variance eigenvector is:
;< 0.73450,-0.05978,-0.67597> +/- < 0.00104, 0.02521,-0.00109>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:30:48.5500',prefd[0]+'23:30:48.5697'])
tr1     = time_double([prefd[0]+'23:30:48.5799',prefd[0]+'23:30:48.5991'])
tr2     = time_double([prefd[0]+'23:30:48.6188',prefd[0]+'23:30:48.6508'])
tr3     = time_double([prefd[0]+'23:30:48.6524',prefd[0]+'23:30:48.6668'])
tr4     = time_double([prefd[0]+'23:30:48.6679',prefd[0]+'23:30:48.6999'])
tr5     = time_double([prefd[0]+'23:30:48.7004',prefd[0]+'23:30:48.7244'])
tr6     = time_double([prefd[0]+'23:30:48.8055',prefd[0]+'23:30:48.8497'])
tr7     = time_double([prefd[0]+'23:30:48.8503',prefd[0]+'23:30:48.9265'])
tr8     = time_double([prefd[0]+'23:30:48.9265',prefd[0]+'23:30:48.9996'])
tr9     = time_double([prefd[0]+'23:30:49.0001',prefd[0]+'23:30:49.0396'])
tr10    = time_double([prefd[0]+'23:30:49.0449',prefd[0]+'23:30:49.0609'])
tr11    = time_double([prefd[0]+'23:30:49.0615',prefd[0]+'23:30:49.0967'])
tr12    = time_double([prefd[0]+'23:30:49.1100',prefd[0]+'23:30:49.1196'])
tr13    = time_double([prefd[0]+'23:30:49.1201',prefd[0]+'23:30:49.1457'])
tr14    = time_double([prefd[0]+'23:30:49.1463',prefd[0]+'23:30:49.2023'])
tr15    = time_double([prefd[0]+'23:30:49.2028',prefd[0]+'23:30:49.2268'])
tr16    = time_double([prefd[0]+'23:30:49.2353',prefd[0]+'23:30:49.2673'])
tr17    = time_double([prefd[0]+'23:30:49.2679',prefd[0]+'23:30:49.3143'])
tr18    = time_double([prefd[0]+'23:30:49.3148',prefd[0]+'23:30:49.3255'])
tr19    = time_double([prefd[0]+'23:30:49.3313',prefd[0]+'23:30:49.3799'])
tr20    = time_double([prefd[0]+'23:30:49.3804',prefd[0]+'23:30:49.4327'])
tr21    = time_double([prefd[0]+'23:30:49.4503',prefd[0]+'23:30:49.4972'])
tr22    = time_double([prefd[0]+'23:30:49.4977',prefd[0]+'23:30:49.5228'])
tr23    = time_double([prefd[0]+'23:30:49.5271',prefd[0]+'23:30:49.5585'])
tr24    = time_double([prefd[0]+'23:30:49.5591',prefd[0]+'23:30:49.5815'])

kvec0   = [ 0.73044,-0.33271,-0.59646]
kvec1   = [ 0.67852,-0.37579,-0.63119]
kvec2   = [ 0.72408,-0.29306,-0.62436]
kvec3   = [ 0.67540,-0.17251,-0.71699]
kvec4   = [ 0.72033,-0.15381,-0.67637]
kvec5   = [ 0.75824,-0.25189,-0.60135]
kvec6   = [ 0.69150,-0.19666,-0.69509]
kvec7   = [ 0.73929,-0.14663,-0.65723]
kvec8   = [ 0.70436,-0.13724,-0.69645]
kvec9   = [ 0.69449,-0.25131,-0.67419]
kvec10  = [-0.00132,-0.00100,-1.00000]
kvec11  = [ 0.00049,-0.00278,-1.00000]
kvec12  = [ 0.76387,-0.10524,-0.63674]
kvec13  = [ 0.74922,-0.13205,-0.64902]
kvec14  = [ 0.70280,-0.01649,-0.71120]
kvec15  = [ 0.72118,-0.18955,-0.66631]
kvec16  = [ 0.70746,-0.29336,-0.64299]
kvec17  = [ 0.70623,-0.21445,-0.67473]
kvec18  = [ 0.72313, 0.05159,-0.68878]
kvec19  = [ 0.71911,-0.21629,-0.66038]
kvec20  = [ 0.73942,-0.17522,-0.65004]
kvec21  = [ 0.69126,-0.37399,-0.61829]
kvec22  = [ 0.66885,-0.14658,-0.72880]
kvec23  = [ 0.71783,-0.13677,-0.68265]
kvec24  = [ 0.73450,-0.05978,-0.67597]

dkvec0  = ABS([ 0.02900, 0.08827,-0.01372])
dkvec1  = ABS([ 0.02831, 0.06220,-0.00660])
dkvec2  = ABS([ 0.01857, 0.06445,-0.00871])
dkvec3  = ABS([ 0.03167, 0.12020, 0.00091])
dkvec4  = ABS([ 0.00913, 0.05385,-0.00252])
dkvec5  = ABS([ 0.00944, 0.04789,-0.00815])
dkvec6  = ABS([ 0.02120, 0.08015,-0.00158])
dkvec7  = ABS([ 0.00753, 0.05365,-0.00350])
dkvec8  = ABS([ 0.01481, 0.07283, 0.00063])
dkvec9  = ABS([ 0.01378, 0.04309,-0.00187])
dkvec10 = ABS([ 0.02401,-0.01215,-0.00002])
dkvec11 = ABS([ 0.01195,-0.01011, 0.00003])
dkvec12 = ABS([ 0.00898, 0.07010,-0.00082])
dkvec13 = ABS([ 0.00498, 0.04910,-0.00424])
dkvec14 = ABS([ 0.00560, 0.08400, 0.00358])
dkvec15 = ABS([ 0.01607, 0.06846,-0.00208])
dkvec16 = ABS([ 0.03289, 0.09625,-0.00772])
dkvec17 = ABS([ 0.01252, 0.04508,-0.00122])
dkvec18 = ABS([-0.01645, 0.13987,-0.00679])
dkvec19 = ABS([ 0.01219, 0.04835,-0.00257])
dkvec20 = ABS([ 0.01360, 0.06904,-0.00313])
dkvec21 = ABS([ 0.03155, 0.07524,-0.01024])
dkvec22 = ABS([ 0.02183, 0.08462, 0.00301])
dkvec23 = ABS([ 0.00956, 0.05882,-0.00173])
dkvec24 = ABS([ 0.00104, 0.02521,-0.00109])

elam0   = [32.757588,5.1725034]
elam1   = [62.194347,4.7739488]
elam2   = [48.937657,5.1513222]
elam3   = [23.549643,3.7793534]
elam4   = [77.206839,4.1681879]
elam5   = [101.18191,6.5764968]
elam6   = [29.282799,3.9740805]
elam7   = [49.101080,5.0518233]
elam8   = [28.073362,4.1683115]
elam9   = [97.902561,4.9495011]
elam10  = [476.73567,3.2062222]
elam11  = [866.20227,4.7873677]
elam12  = [78.061251,8.0932010]
elam13  = [98.450390,6.2249150]
elam14  = [25.594481,3.7443254]
elam15  = [53.183527,4.6590059]
elam16  = [22.054444,5.0732422]
elam17  = [86.002268,4.4865663]
elam18  = [20.103518,5.6225363]
elam19  = [73.235820,4.7609461]
elam20  = [35.416067,5.1683691]
elam21  = [27.318875,5.5871040]
elam22  = [36.201868,3.3711832]
elam23  = [63.946748,4.8253759]
elam24  = [412.23440,5.3330883]

bvec0   = [-0.40252, 0.73549, 0.54501]
bvec1   = [-0.40679, 0.73415, 0.54364]
bvec2   = [-0.41308, 0.73212, 0.54163]
bvec3   = [-0.41614, 0.73127, 0.54043]
bvec4   = [-0.41834, 0.73097, 0.53914]
bvec5   = [-0.42087, 0.73061, 0.53765]
bvec6   = [-0.43090, 0.73223, 0.52741]
bvec7   = [-0.43826, 0.73367, 0.51927]
bvec8   = [-0.44652, 0.73327, 0.51276]
bvec9   = [-0.45160, 0.73168, 0.51058]
bvec10  = [-0.45369, 0.73247, 0.50760]
bvec11  = [-0.45526, 0.73333, 0.50493]
bvec12  = [-0.45731, 0.73458, 0.50127]
bvec13  = [-0.45822, 0.73559, 0.49894]
bvec14  = [-0.46034, 0.73794, 0.49348]
bvec15  = [-0.46241, 0.74032, 0.48796]
bvec16  = [-0.46440, 0.74281, 0.48224]
bvec17  = [-0.46628, 0.74547, 0.47628]
bvec18  = [-0.46644, 0.74719, 0.47343]
bvec19  = [-0.46603, 0.74922, 0.47063]
bvec20  = [-0.46549, 0.75183, 0.46697]
bvec21  = [-0.46470, 0.75468, 0.46315]
bvec22  = [-0.46295, 0.75587, 0.46296]
bvec23  = [-0.46096, 0.75686, 0.46333]
bvec24  = [-0.45911, 0.75781, 0.46362]
bmag0   = [40.62561]
bmag1   = [40.62074]
bmag2   = [40.61554]
bmag3   = [40.61911]
bmag4   = [40.63281]
bmag5   = [40.64889]
bmag6   = [40.47960]
bmag7   = [40.43920]
bmag8   = [40.48725]
bmag9   = [40.58921]
bmag10  = [40.67957]
bmag11  = [40.75786]
bmag12  = [40.85480]
bmag13  = [40.87585]
bmag14  = [40.92627]
bmag15  = [40.98466]
bmag16  = [41.05859]
bmag17  = [41.13369]
bmag18  = [41.15280]
bmag19  = [41.15898]
bmag20  = [41.18728]
bmag21  = [41.25762]
bmag22  = [41.26371]
bmag23  = [41.26001]
bmag24  = [41.26249]

tags    = ['t0','t1','t2','t3','t4','t5','t6','t7','t8','t9','t10','t11','t12','t13',$
           't14','t15','t16','t17','t18','t19','t20','t21','t22','t23','t24']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,$
                        tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,$
                        kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,$
                        kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,$
                        dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,$
                        dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,$
                        dkvec23,dkvec24)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  200 Hz < f < 400 Hz  at  1998-09-24/23:30:48.542 UT
;
;   23:30:48.5500-23:30:48.5697      0.730     -0.333     -0.596     -0.403      0.735      0.545     40.626
;   23:30:48.5799-23:30:48.5991      0.679     -0.376     -0.631     -0.407      0.734      0.544     40.621
;   23:30:48.6188-23:30:48.6508      0.724     -0.293     -0.624     -0.413      0.732      0.542     40.616
;   23:30:48.6524-23:30:48.6668      0.675     -0.173     -0.717     -0.416      0.731      0.540     40.619
;   23:30:48.6679-23:30:48.6999      0.720     -0.154     -0.676     -0.418      0.731      0.539     40.633
;   23:30:48.7004-23:30:48.7244      0.758     -0.252     -0.601     -0.421      0.731      0.538     40.649
;   23:30:48.8055-23:30:48.8497      0.692     -0.197     -0.695     -0.431      0.732      0.527     40.480
;   23:30:48.8503-23:30:48.9265      0.739     -0.147     -0.657     -0.438      0.734      0.519     40.439
;   23:30:48.9265-23:30:48.9996      0.704     -0.137     -0.696     -0.447      0.733      0.513     40.487
;   23:30:49.0001-23:30:49.0396      0.694     -0.251     -0.674     -0.452      0.732      0.511     40.589
;   23:30:49.0449-23:30:49.0609     -0.001     -0.001     -1.000     -0.454      0.732      0.508     40.680
;   23:30:49.0615-23:30:49.0967      0.000     -0.003     -1.000     -0.455      0.733      0.505     40.758
;   23:30:49.1100-23:30:49.1196      0.764     -0.105     -0.637     -0.457      0.735      0.501     40.855
;   23:30:49.1201-23:30:49.1457      0.749     -0.132     -0.649     -0.458      0.736      0.499     40.876
;   23:30:49.1463-23:30:49.2023      0.703     -0.016     -0.711     -0.460      0.738      0.493     40.926
;   23:30:49.2028-23:30:49.2268      0.721     -0.190     -0.666     -0.462      0.740      0.488     40.985
;   23:30:49.2353-23:30:49.2673      0.707     -0.293     -0.643     -0.464      0.743      0.482     41.059
;   23:30:49.2679-23:30:49.3143      0.706     -0.214     -0.675     -0.466      0.745      0.476     41.134
;   23:30:49.3148-23:30:49.3255      0.723      0.052     -0.689     -0.466      0.747      0.473     41.153
;   23:30:49.3313-23:30:49.3799      0.719     -0.216     -0.660     -0.466      0.749      0.471     41.159
;   23:30:49.3804-23:30:49.4327      0.739     -0.175     -0.650     -0.465      0.752      0.467     41.187
;   23:30:49.4503-23:30:49.4972      0.691     -0.374     -0.618     -0.465      0.755      0.463     41.258
;   23:30:49.4977-23:30:49.5228      0.669     -0.147     -0.729     -0.463      0.756      0.463     41.264
;   23:30:49.5271-23:30:49.5585      0.718     -0.137     -0.683     -0.461      0.757      0.463     41.260
;   23:30:49.5591-23:30:49.5815      0.734     -0.060     -0.676     -0.459      0.758      0.464     41.262

vswu   = [-648.959,-28.025,-84.072]         ; => My 3DP estimates (km/s) For 1998-09-24/23:30:48.542 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  200 Hz < f < 400 Hz  at  1998-09-24/23:30:48.542 UT
;
;   23:30:48.5500-23:30:48.5697    149.745     30.255    113.019     66.981    129.266     50.734
;   23:30:48.5799-23:30:48.5991    153.514     26.486    108.800     71.200    125.112     54.888
;   23:30:48.6188-23:30:48.6508    148.412     31.588    112.608     67.392    128.663     51.337
;   23:30:48.6524-23:30:48.6668    142.627     37.373    109.565     70.435    124.735     55.265
;   23:30:48.6679-23:30:48.6999    141.117     38.883    113.197     66.803    128.339     51.661
;   23:30:48.7004-23:30:48.7244    145.738     34.262    115.630     64.370    131.552     48.448
;   23:30:48.8055-23:30:48.8497    143.956     36.044    110.594     69.406    125.980     54.020
;   23:30:48.8503-23:30:48.9265    140.611     39.389    114.793     65.207    129.930     50.070
;   23:30:48.9265-23:30:48.9996    140.557     39.443    112.092     67.908    127.058     52.942
;   23:30:49.0001-23:30:49.0396    147.325     32.675    110.461     69.539    126.215     53.785
;   23:30:49.0449-23:30:49.0609    120.513     59.487     69.975    110.025     82.547     97.453
;   23:30:49.0615-23:30:49.0967    120.477     59.523     70.052    109.948     82.646     97.354
;   23:30:49.1100-23:30:49.1196    138.228     41.772    117.251     62.749    132.114     47.886
;   23:30:49.1201-23:30:49.1457    139.842     40.158    115.748     64.252    130.796     49.204
;   23:30:49.1463-23:30:49.2023    133.367     46.633    113.342     66.658    127.182     52.818
;   23:30:49.2028-23:30:49.2268    143.029     36.971    112.970     67.030    128.383     51.617
;   23:30:49.2353-23:30:49.2673    148.930     31.070    111.273     68.727    127.291     52.709
;   23:30:49.2679-23:30:49.3143    144.148     35.852    111.607     68.393    127.154     52.846
;   23:30:49.3148-23:30:49.3255    128.670     51.330    115.939     64.061    129.071     50.929
;   23:30:49.3313-23:30:49.3799    143.898     36.102    112.612     67.388    128.205     51.795
;   23:30:49.3804-23:30:49.4327    141.213     38.787    114.558     65.442    129.918     50.082
;   23:30:49.4503-23:30:49.4972    152.852     27.148    109.798     70.202    126.124     53.876
;   23:30:49.4977-23:30:49.5228    139.275     40.725    109.303     70.697    124.255     55.745
;   23:30:49.5271-23:30:49.5585    138.651     41.349    113.155     66.845    128.152     51.848
;   23:30:49.5591-23:30:49.5815    134.100     45.900    115.320     64.680    129.674     50.326

theta_kb0924_200_400   = DBLARR(nn)
theta_kn0924_200_400   = DBLARR(nn)
theta_kv0924_200_400   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_200_400[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_200_400[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_200_400[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_200_400[j]),  $
                     REFORM(theta_kn0924_200_400[j]),$
                     REFORM(theta_kv0924_200_400[j])
;
; => For  200 Hz < f < 400 Hz  at  1998-09-24/23:30:48.542 UT
;
;   23:30:48.5500-23:30:48.5697     30.255     66.981     50.734
;   23:30:48.5799-23:30:48.5991     26.486     71.200     54.888
;   23:30:48.6188-23:30:48.6508     31.588     67.392     51.337
;   23:30:48.6524-23:30:48.6668     37.373     70.435     55.265
;   23:30:48.6679-23:30:48.6999     38.883     66.803     51.661
;   23:30:48.7004-23:30:48.7244     34.262     64.370     48.448
;   23:30:48.8055-23:30:48.8497     36.044     69.406     54.020
;   23:30:48.8503-23:30:48.9265     39.389     65.207     50.070
;   23:30:48.9265-23:30:48.9996     39.443     67.908     52.942
;   23:30:49.0001-23:30:49.0396     32.675     69.539     53.785
;   23:30:49.0449-23:30:49.0609     59.487     69.975     82.547
;   23:30:49.0615-23:30:49.0967     59.523     70.052     82.646
;   23:30:49.1100-23:30:49.1196     41.772     62.749     47.886
;   23:30:49.1201-23:30:49.1457     40.158     64.252     49.204
;   23:30:49.1463-23:30:49.2023     46.633     66.658     52.818
;   23:30:49.2028-23:30:49.2268     36.971     67.030     51.617
;   23:30:49.2353-23:30:49.2673     31.070     68.727     52.709
;   23:30:49.2679-23:30:49.3143     35.852     68.393     52.846
;   23:30:49.3148-23:30:49.3255     51.330     64.061     50.929
;   23:30:49.3313-23:30:49.3799     36.102     67.388     51.795
;   23:30:49.3804-23:30:49.4327     38.787     65.442     50.082
;   23:30:49.4503-23:30:49.4972     27.148     70.202     53.876
;   23:30:49.4977-23:30:49.5228     40.725     70.697     55.745
;   23:30:49.5271-23:30:49.5585     41.349     66.845     51.848
;   23:30:49.5591-23:30:49.5815     45.900     64.680     50.326

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_200_400
PRINT,FORMAT=tkbf,theta_kn0924_200_400
PRINT,FORMAT=tkbf,theta_kv0924_200_400

theta_kb0924_200_400 = [30.25,26.49,31.59,37.37,38.88,34.26,36.04,39.39,39.44,32.68,$
                        59.49,59.52,41.77,40.16,46.63,36.97,31.07,35.85,51.33,36.10,$
                        38.79,27.15,40.73,41.35,45.90]
theta_kn0924_200_400 = [66.98,71.20,67.39,70.44,66.80,64.37,69.41,65.21,67.91,69.54,$
                        69.98,70.05,62.75,64.25,66.66,67.03,68.73,68.39,64.06,67.39,$
                        65.44,70.20,70.70,66.84,64.68]
theta_kv0924_200_400 = [50.73,54.89,51.34,55.27,51.66,48.45,54.02,50.07,52.94,53.79,$
                        82.55,82.65,47.89,49.20,52.82,51.62,52.71,52.85,50.93,51.79,$
                        50.08,53.88,55.74,51.85,50.33]


DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24

;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 5L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0
print, hfc0, format='(";",8f10.1)'
;      30.0

vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

bvec0   = [-0.21570, 0.97446, 0.06246]
bmag0   = [35.53833]
;-----------------------------------------------------------------------------------------
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:43:18.951 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 222-507
;Plot Range: 23:43:19.0694-23:43:19.2214
;The angle between DC-Field and the k-vector is :
;       85.763 +/- 0.547 degrees
;The eigenvalues ratios are:
;       40.543304       1.4272298
;The Minimum Variance eigenvector is:
;<-0.35115,-0.92369, 0.15326> +/- <-0.03608, 0.02087, 0.04313>
;
;Plot Index Range: 1311-1425
;Plot Range: 23:43:19.6502-23:43:19.7110
;The angle between DC-Field and the k-vector is :
;       81.508 +/- 1.243 degrees
;The eigenvalues ratios are:
;       20.759092       19.873908
;The Minimum Variance eigenvector is:
;<-0.59098, 0.26256, 0.76276> +/- < 0.00852,-0.07677, 0.03303>
;
;Plot Index Range: 1830-1966
;Plot Range: 23:43:19.9270-23:43:19.9995
;The angle between DC-Field and the k-vector is :
;       82.741 +/- 1.407 degrees
;The eigenvalues ratios are:
;       14.219221       1.8227521
;The Minimum Variance eigenvector is:
;< 0.31415,-0.94866,-0.03686> +/- <-0.11216,-0.03754, 0.01020>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:43:19.0694',prefd[0]+'23:43:19.2214'])
tr1     = time_double([prefd[0]+'23:43:19.6502',prefd[0]+'23:43:19.7110'])
tr2     = time_double([prefd[0]+'23:43:19.9270',prefd[0]+'23:43:19.9995'])

kvec0   = [-0.35115,-0.92369, 0.15326]
kvec1   = [-0.59098, 0.26256, 0.76276]
kvec2   = [ 0.31415,-0.94866,-0.03686]

dkvec0  = ABS([-0.03608, 0.02087, 0.04313])
dkvec1  = ABS([ 0.00852,-0.07677, 0.03303])
dkvec2  = ABS([-0.11216,-0.03754, 0.01020])

elam0   = [40.543304,1.4272298]
elam1   = [20.759092,19.873908]
elam2   = [14.219221,1.8227521]

bvec0   = [-0.21307, 0.97271, 0.09178]
bvec1   = [-0.23299, 0.97078, 0.05740]
bvec2   = [-0.24149, 0.96958, 0.03952]
bmag0   = [35.06914]
bmag1   = [35.94601]
bmag2   = [35.86503]

tags    = ['t0','t1','t2']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:43:18.951 UT
;
;   23:43:19.0694-23:43:19.2214     -0.351     -0.924      0.153     -0.213      0.973      0.092     35.069
;   23:43:19.6502-23:43:19.7110     -0.591      0.263      0.763     -0.233      0.971      0.057     35.946
;   23:43:19.9270-23:43:19.9995      0.314     -0.949     -0.037     -0.241      0.970      0.040     35.865

vswu   = [-659.650,-38.526,-32.522]         ; => My 3DP estimates (km/s) For 1998-09-24/23:43:18.951 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:43:18.951 UT
;
;   23:43:19.0694-23:43:19.2214    144.056     35.944     61.842    118.158     66.648    113.352
;   23:43:19.6502-23:43:19.7110     64.128    115.872     77.156    102.844     57.556    122.444
;   23:43:19.9270-23:43:19.9995    175.650      4.350     93.776     86.224    104.844     75.156

theta_kb0924_03_30   = DBLARR(nn)
theta_kn0924_03_30   = DBLARR(nn)
theta_kv0924_03_30   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_03_30[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_03_30[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_03_30[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_03_30[j]),  $
                     REFORM(theta_kn0924_03_30[j]),$
                     REFORM(theta_kv0924_03_30[j])
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:43:18.951 UT
;
;   23:43:19.0694-23:43:19.2214     35.944     61.842     66.648
;   23:43:19.6502-23:43:19.7110     64.128     77.156     57.556
;   23:43:19.9270-23:43:19.9995      4.350     86.224     75.156

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_03_30
PRINT,FORMAT=tkbf,theta_kn0924_03_30
PRINT,FORMAT=tkbf,theta_kv0924_03_30

theta_kb0924_03_30 = [35.94,64.13, 4.35]
theta_kn0924_03_30 = [61.84,77.16,86.22]
theta_kv0924_03_30 = [66.65,57.56,75.16]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24




;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 6L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}
dummy3  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(3)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0      10.0      30.0     100.0
print, hfc0, format='(";",8f10.1)'
;      30.0     100.0     100.0     300.0

vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy1,FCUTOFF=[lfc0[1],hfc0[1]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy2,FCUTOFF=[lfc0[2],hfc0[2]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy3,FCUTOFF=[lfc0[3],hfc0[3]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

bvec0   = [-0.35723, 0.90357, 0.23653]
bmag0   = [36.02998]
;-----------------------------------------------------------------------------------------
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:45:52.184 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 496-611
;Plot Range: 23:45:52.4485-23:45:52.5099
;The angle between DC-Field and the k-vector is :
;       78.775 +/- 1.554 degrees
;The eigenvalues ratios are:
;       13.853695       3.2561507
;The Minimum Variance eigenvector is:
;< 0.30986, 0.93395, 0.17814> +/- <-0.10062, 0.02361, 0.05124>
;
;Plot Index Range: 687-879
;Plot Range: 23:45:52.5504-23:45:52.6528
;The angle between DC-Field and the k-vector is :
;       89.175 +/- 1.378 degrees
;The eigenvalues ratios are:
;       10.955564       3.3222930
;The Minimum Variance eigenvector is:
;< 0.32928,-0.90789, 0.25944> +/- < 0.08096, 0.04810, 0.06558>
;
;Plot Index Range: 687-831
;Plot Range: 23:45:52.5504-23:45:52.6272
;The angle between DC-Field and the k-vector is :
;       83.156 +/- 0.458 degrees
;The eigenvalues ratios are:
;       111.40141       2.4391355
;The Minimum Variance eigenvector is:
;< 0.40732,-0.89024, 0.20388> +/- < 0.02260, 0.01651, 0.02692>
;
;Plot Index Range: 1861-2047
;Plot Range: 23:45:53.1765-23:45:53.2757
;The angle between DC-Field and the k-vector is :
;       28.610 +/- 1.432 degrees
;The eigenvalues ratios are:
;       10.556916       4.0535800
;The Minimum Variance eigenvector is:
;<-0.74647, 0.60257, 0.28228> +/- < 0.07561, 0.08586, 0.01666>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:45:52.4485',prefd[0]+'23:45:52.5099'])
tr1     = time_double([prefd[0]+'23:45:52.5504',prefd[0]+'23:45:52.6272'])
tr2     = time_double([prefd[0]+'23:45:53.1765',prefd[0]+'23:45:53.2757'])

kvec0   = [ 0.30986, 0.93395, 0.17814]
kvec1   = [ 0.40732,-0.89024, 0.20388]
kvec2   = [-0.74647, 0.60257, 0.28228]

dkvec0  = ABS([-0.10062, 0.02361, 0.05124])
dkvec1  = ABS([ 0.02260, 0.01651, 0.02692])
dkvec2  = ABS([ 0.07561, 0.08586, 0.01666])

elam0   = [13.853695,3.2561507]
elam1   = [111.40141,2.4391355]
elam2   = [10.556916,4.0535800]

bvec0   = [-0.40030, 0.84940, 0.34392]
bvec1   = [-0.41103, 0.86811, 0.27573]
bvec2   = [-0.32137, 0.94226, 0.09228]
bmag0   = [36.98357]
bmag1   = [37.39432]
bmag2   = [37.65568]

tags    = ['t0','t1','t2']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.4485-23:45:52.5099      0.310      0.934      0.178     -0.400      0.849      0.344     36.984
;   23:45:52.5504-23:45:52.6272      0.407     -0.890      0.204     -0.411      0.868      0.276     37.394
;   23:45:53.1765-23:45:53.2757     -0.746      0.603      0.282     -0.321      0.942      0.092     37.656

vswu   = [-673.799,-38.333,-24.744]         ; => My 3DP estimates (km/s) For 1998-09-24/23:45:52.184 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.4485-23:45:52.5099     43.070    136.930    123.328     56.672    111.635     68.365
;   23:45:52.5504-23:45:52.6272    152.132     27.868    104.239     75.761    111.305     68.695
;   23:45:53.1765-23:45:53.2757     33.517    146.483     63.035    116.965     45.555    134.445

theta_kb0924_03_30_2   = DBLARR(nn)
theta_kn0924_03_30_2   = DBLARR(nn)
theta_kv0924_03_30_2   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_03_30_2[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_03_30_2[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_03_30_2[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_03_30_2[j]),  $
                     REFORM(theta_kn0924_03_30_2[j]),$
                     REFORM(theta_kv0924_03_30_2[j])
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.4485-23:45:52.5099     43.070     56.672     68.365
;   23:45:52.5504-23:45:52.6272     27.868     75.761     68.695
;   23:45:53.1765-23:45:53.2757     33.517     63.035     45.555

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_03_30_2
PRINT,FORMAT=tkbf,theta_kn0924_03_30_2
PRINT,FORMAT=tkbf,theta_kv0924_03_30_2

theta_kb0924_03_30_2 = [43.07,27.87,33.52]
theta_kn0924_03_30_2 = [56.67,75.76,63.03]
theta_kv0924_03_30_2 = [68.37,68.70,45.56]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
; => For  10 Hz < f < 100 Hz  at  1998-09-24/23:45:52.184 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 510-601
;Plot Range: 23:45:52.4560-23:45:52.5045
;The angle between DC-Field and the k-vector is :
;       29.914 +/- 1.698 degrees
;The eigenvalues ratios are:
;       14.575075       3.2713029
;The Minimum Variance eigenvector is:
;< 0.61631, 0.76502, 0.18685> +/- <-0.08740, 0.05622, 0.05810>
;
;Plot Index Range: 668-908
;Plot Range: 23:45:52.5403-23:45:52.6683
;The angle between DC-Field and the k-vector is :
;       58.385 +/- 1.150 degrees
;The eigenvalues ratios are:
;       12.309177       2.5921494
;The Minimum Variance eigenvector is:
;<-0.26467, 0.95178,-0.15513> +/- < 0.08989, 0.01654,-0.05191>
;
;Plot Index Range: 1693-1720
;Plot Range: 23:45:53.0869-23:45:53.1013
;The angle between DC-Field and the k-vector is :
;       50.297 +/- 2.084 degrees
;The eigenvalues ratios are:
;       31.044317       2.6369960
;The Minimum Variance eigenvector is:
;< 0.21001, 0.77953, 0.59011> +/- < 0.10824,-0.00640,-0.03007>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:45:52.4560',prefd[0]+'23:45:52.5045'])
tr1     = time_double([prefd[0]+'23:45:52.5403',prefd[0]+'23:45:52.6683'])
tr2     = time_double([prefd[0]+'23:45:53.0869',prefd[0]+'23:45:53.1013'])

kvec0   = [ 0.61631, 0.76502, 0.18685]
kvec1   = [-0.26467, 0.95178,-0.15513]
kvec2   = [ 0.21001, 0.77953, 0.59011]

dkvec0  = ABS([-0.08740, 0.05622, 0.05810])
dkvec1  = ABS([ 0.08989, 0.01654,-0.05191])
dkvec2  = ABS([ 0.10824,-0.00640,-0.03007])

elam0   = [14.575075,3.2713029]
elam1   = [12.309177,2.5921494]
elam2   = [31.044317,2.6369960]

bvec0   = [-0.40027, 0.84930, 0.34420]
bvec1   = [-0.41357, 0.87300, 0.25217]
bvec2   = [-0.32230, 0.92363, 0.20741]
bmag0   = [36.97547]
bmag1   = [37.52479]
bmag2   = [38.47757]

tags    = ['t0','t1','t2']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  10 Hz < f < 100 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.4560-23:45:52.5045      0.616      0.765      0.187     -0.400      0.849      0.344     36.975
;   23:45:52.5403-23:45:52.6683     -0.265      0.952     -0.155     -0.414      0.873      0.252     37.525
;   23:45:53.0869-23:45:53.1013      0.210      0.780      0.590     -0.322      0.924      0.207     38.478

vswu   = [-673.799,-38.333,-24.744]         ; => My 3DP estimates (km/s) For 1998-09-24/23:45:52.184 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  10 Hz < f < 100 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.4560-23:45:52.5045     62.137    117.863    142.686     37.314    131.695     48.305
;   23:45:52.5403-23:45:52.6683     25.678    154.322     85.100     94.900     77.542    102.458
;   23:45:53.0869-23:45:53.1013     39.222    140.778    124.380     55.620    105.986     74.014

theta_kb0924_10_100   = DBLARR(nn)
theta_kn0924_10_100   = DBLARR(nn)
theta_kv0924_10_100   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_10_100[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_10_100[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_10_100[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_10_100[j]),  $
                     REFORM(theta_kn0924_10_100[j]),$
                     REFORM(theta_kv0924_10_100[j])
;
; => For  10 Hz < f < 100 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.4560-23:45:52.5045     62.137     37.314     48.305
;   23:45:52.5403-23:45:52.6683     25.678     85.100     77.542
;   23:45:53.0869-23:45:53.1013     39.222     55.620     74.014

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_10_100
PRINT,FORMAT=tkbf,theta_kn0924_10_100
PRINT,FORMAT=tkbf,theta_kv0924_10_100

theta_kb0924_10_100 = [62.14,25.68,39.22]
theta_kn0924_10_100 = [37.31,85.10,55.62]
theta_kv0924_10_100 = [48.30,77.54,74.01]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
; => For  30 Hz < f < 100 Hz  at  1998-09-24/23:45:52.184 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 181-253
;Plot Range: 23:45:52.2805-23:45:52.3189
;The angle between DC-Field and the k-vector is :
;       84.218 +/- 1.751 degrees
;The eigenvalues ratios are:
;       17.020331       2.3618471
;The Minimum Variance eigenvector is:
;< 0.12098, 0.99264, 0.00599> +/- < 0.11759,-0.01449, 0.02683>
;
;Plot Index Range: 432-461
;Plot Range: 23:45:52.4144-23:45:52.4299
;The angle between DC-Field and the k-vector is :
;       75.749 +/- 3.582 degrees
;The eigenvalues ratios are:
;       11.045271       4.1551802
;The Minimum Variance eigenvector is:
;<-0.50622,-0.80133, 0.31875> +/- < 0.15446,-0.07615, 0.05388>
;
;Plot Index Range: 790-814
;Plot Range: 23:45:52.6053-23:45:52.6181
;The angle between DC-Field and the k-vector is :
;       43.918 +/- 1.174 degrees
;The eigenvalues ratios are:
;       105.62444       3.3581263
;The Minimum Variance eigenvector is:
;<-0.38381, 0.75559,-0.53082> +/- <-0.05392,-0.02729, 0.00014>
;
;Plot Index Range: 1352-1380
;Plot Range: 23:45:52.9051-23:45:52.9200
;The angle between DC-Field and the k-vector is :
;       81.867 +/- 3.095 degrees
;The eigenvalues ratios are:
;       14.628501       2.2880040
;The Minimum Variance eigenvector is:
;< 0.48207, 0.15612,-0.86211> +/- < 0.10839, 0.10177, 0.07904>
;
;Plot Index Range: 1509-1546
;Plot Range: 23:45:52.9888-23:45:53.0085
;The angle between DC-Field and the k-vector is :
;       51.330 +/- 2.071 degrees
;The eigenvalues ratios are:
;       23.218763       1.9591213
;The Minimum Variance eigenvector is:
;<-0.91343,-0.28841,-0.28717> +/- < 0.02434,-0.11706, 0.04014>
;
;Plot Index Range: 1547-1609
;Plot Range: 23:45:53.0091-23:45:53.0421
;The angle between DC-Field and the k-vector is :
;       88.677 +/- 0.891 degrees
;The eigenvalues ratios are:
;       69.760363       2.7773742
;The Minimum Variance eigenvector is:
;<-0.13019, 0.95333, 0.27241> +/- < 0.05794, 0.01077,-0.01001>
;
;Plot Index Range: 1641-1671
;Plot Range: 23:45:53.0592-23:45:53.0752
;The angle between DC-Field and the k-vector is :
;       85.125 +/- 0.802 degrees
;The eigenvalues ratios are:
;       177.88869       1.7117800
;The Minimum Variance eigenvector is:
;<-0.00459, 0.45789, 0.88900> +/- < 0.01978,-0.03930, 0.02035>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:45:52.2805',prefd[0]+'23:45:52.3189'])
tr1     = time_double([prefd[0]+'23:45:52.4144',prefd[0]+'23:45:52.4299'])
tr2     = time_double([prefd[0]+'23:45:52.6053',prefd[0]+'23:45:52.6181'])
tr3     = time_double([prefd[0]+'23:45:52.9051',prefd[0]+'23:45:52.9200'])
tr4     = time_double([prefd[0]+'23:45:52.9888',prefd[0]+'23:45:53.0085'])
tr5     = time_double([prefd[0]+'23:45:53.0091',prefd[0]+'23:45:53.0421'])
tr6     = time_double([prefd[0]+'23:45:53.0592',prefd[0]+'23:45:53.0752'])

kvec0   = [ 0.12098, 0.99264, 0.00599]
kvec1   = [-0.50622,-0.80133, 0.31875]
kvec2   = [-0.38381, 0.75559,-0.53082]
kvec3   = [ 0.48207, 0.15612,-0.86211]
kvec4   = [-0.91343,-0.28841,-0.28717]
kvec5   = [-0.13019, 0.95333, 0.27241]
kvec6   = [-0.00459, 0.45789, 0.88900]

dkvec0  = ABS([ 0.11759,-0.01449, 0.02683])
dkvec1  = ABS([ 0.15446,-0.07615, 0.05388])
dkvec2  = ABS([-0.05392,-0.02729, 0.00014])
dkvec3  = ABS([ 0.10839, 0.10177, 0.07904])
dkvec4  = ABS([ 0.02434,-0.11706, 0.04014])
dkvec5  = ABS([ 0.05794, 0.01077,-0.01001])
dkvec6  = ABS([ 0.01978,-0.03930, 0.02035])

elam0   = [17.020331,2.3618471]
elam1   = [11.045271,4.1551802]
elam2   = [105.62444,3.3581263]
elam3   = [14.628501,2.2880040]
elam4   = [23.218763,1.9591213]
elam5   = [69.760363,2.7773742]
elam6   = [177.88869,1.7117800]

bvec0   = [-0.39363, 0.86680, 0.30613]
bvec1   = [-0.40175, 0.85313, 0.33282]
bvec2   = [-0.41674, 0.87697, 0.23921]
bvec3   = [-0.37812, 0.88589, 0.26874]
bvec4   = [-0.35177, 0.89643, 0.26956]
bvec5   = [-0.34326, 0.90304, 0.25813]
bvec6   = [-0.33056, 0.91603, 0.22716]
bmag0   = [36.96551]
bmag1   = [37.33871]
bmag2   = [37.62800]
bmag3   = [38.00787]
bmag4   = [37.89287]
bmag5   = [37.96736]
bmag6   = [38.26227]

tags    = ['t0','t1','t2','t3','t4','t5','t6']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5,tr6)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  30 Hz < f < 100 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.2805-23:45:52.3189      0.121      0.993      0.006     -0.394      0.867      0.306     36.966
;   23:45:52.4144-23:45:52.4299     -0.506     -0.801      0.319     -0.402      0.853      0.333     37.339
;   23:45:52.6053-23:45:52.6181     -0.384      0.756     -0.531     -0.417      0.877      0.239     37.628
;   23:45:52.9051-23:45:52.9200      0.482      0.156     -0.862     -0.378      0.886      0.269     38.008
;   23:45:52.9888-23:45:53.0085     -0.913     -0.288     -0.287     -0.352      0.896      0.270     37.893
;   23:45:53.0091-23:45:53.0421     -0.130      0.953      0.272     -0.343      0.903      0.258     37.967
;   23:45:53.0592-23:45:53.0752     -0.005      0.458      0.889     -0.331      0.916      0.227     38.262

vswu   = [-673.799,-38.333,-24.744]         ; => My 3DP estimates (km/s) For 1998-09-24/23:45:52.184 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  30 Hz < f < 100 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.2805-23:45:52.3189     35.449    144.551    109.329     70.671    100.211     79.789
;   23:45:52.4144-23:45:52.4299    111.974     68.026     57.975    122.025     57.393    122.607
;   23:45:52.6053-23:45:52.6181     45.925    134.075     68.557    111.443     68.931    111.069
;   23:45:52.9051-23:45:52.9200    106.001     73.999    100.427     79.573    117.274     62.726
;   23:45:52.9888-23:45:53.0085     90.839     89.161      4.963    175.037     20.243    159.757
;   23:45:53.0091-23:45:53.0421     12.605    167.395    100.581     79.419     86.227     93.773
;   23:45:53.0592-23:45:53.0752     51.472    128.528    113.559     66.441     93.095     86.905

theta_kb0924_30_100   = DBLARR(nn)
theta_kn0924_30_100   = DBLARR(nn)
theta_kv0924_30_100   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_30_100[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_30_100[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_30_100[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_30_100[j]),  $
                     REFORM(theta_kn0924_30_100[j]),$
                     REFORM(theta_kv0924_30_100[j])
;
; => For  30 Hz < f < 100 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.2805-23:45:52.3189     35.449     70.671     79.789
;   23:45:52.4144-23:45:52.4299     68.026     57.975     57.393
;   23:45:52.6053-23:45:52.6181     45.925     68.557     68.931
;   23:45:52.9051-23:45:52.9200     73.999     79.573     62.726
;   23:45:52.9888-23:45:53.0085     89.161      4.963     20.243
;   23:45:53.0091-23:45:53.0421     12.605     79.419     86.227
;   23:45:53.0592-23:45:53.0752     51.472     66.441     86.905

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_30_100
PRINT,FORMAT=tkbf,theta_kn0924_30_100
PRINT,FORMAT=tkbf,theta_kv0924_30_100

theta_kb0924_30_100 = [35.45,68.03,45.93,74.00,89.16,12.61,51.47]
theta_kn0924_30_100 = [70.67,57.98,68.56,79.57, 4.96,79.42,66.44]
theta_kv0924_30_100 = [79.79,57.39,68.93,62.73,20.24,86.23,86.91]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24



;-----------------------------------------------------------------------------------------
; => For  100 Hz < f < 300 Hz  at  1998-09-24/23:45:52.184 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 165-249
;Plot Range: 23:45:52.2720-23:45:52.3168
;The angle between DC-Field and the k-vector is :
;       89.252 +/- 2.516 degrees
;The eigenvalues ratios are:
;       8.1271246       3.8372941
;The Minimum Variance eigenvector is:
;<-0.22860, 0.96841,-0.09958> +/- < 0.15315, 0.03101,-0.05005>
;
;Plot Index Range: 165-211
;Plot Range: 23:45:52.2720-23:45:52.2965
;The angle between DC-Field and the k-vector is :
;       66.501 +/- 2.915 degrees
;The eigenvalues ratios are:
;       10.491600       3.5389407
;The Minimum Variance eigenvector is:
;<-0.26831, 0.96178,-0.05470> +/- < 0.15640, 0.04116,-0.04347>
;
;Plot Index Range: 227-249
;Plot Range: 23:45:52.3051-23:45:52.3168
;The angle between DC-Field and the k-vector is :
;       81.499 +/- 2.799 degrees
;The eigenvalues ratios are:
;       21.914105       3.4254733
;The Minimum Variance eigenvector is:
;<-0.15521, 0.98393,-0.08824> +/- < 0.12220, 0.01375,-0.06165>
;
;Plot Index Range: 625-740
;Plot Range: 23:45:52.5173-23:45:52.5787
;The angle between DC-Field and the k-vector is :
;       79.160 +/- 1.582 degrees
;The eigenvalues ratios are:
;       13.428118       2.2216080
;The Minimum Variance eigenvector is:
;<-0.39793, 0.91257, 0.09418> +/- < 0.10849, 0.05046,-0.03056>
;
;Plot Index Range: 625-666
;Plot Range: 23:45:52.5173-23:45:52.5392
;The angle between DC-Field and the k-vector is :
;       72.591 +/- 1.708 degrees
;The eigenvalues ratios are:
;       30.109949       2.0537280
;The Minimum Variance eigenvector is:
;<-0.44551, 0.88835, 0.11117> +/- < 0.09504, 0.04809,-0.00336>
;
;Plot Index Range: 687-720
;Plot Range: 23:45:52.5504-23:45:52.5680
;The angle between DC-Field and the k-vector is :
;       66.530 +/- 1.408 degrees
;The eigenvalues ratios are:
;       53.748889       3.8948033
;The Minimum Variance eigenvector is:
;<-0.37382, 0.92745,-0.00937> +/- < 0.06325, 0.02513,-0.03616>
;
;Plot Index Range: 792-863
;Plot Range: 23:45:52.6064-23:45:52.6443
;The angle between DC-Field and the k-vector is :
;       83.613 +/- 0.800 degrees
;The eigenvalues ratios are:
;       75.312227       2.9754440
;The Minimum Variance eigenvector is:
;<-0.43834, 0.87636, 0.19961> +/- < 0.04589, 0.02640,-0.01515>
;
;Plot Index Range: 885-924
;Plot Range: 23:45:52.6560-23:45:52.6768
;The angle between DC-Field and the k-vector is :
;       74.254 +/- 1.978 degrees
;The eigenvalues ratios are:
;       24.034594       3.1534748
;The Minimum Variance eigenvector is:
;<-0.56609, 0.80905, 0.15807> +/- < 0.09067, 0.06695,-0.01799>
;
;Plot Index Range: 942-993
;Plot Range: 23:45:52.6864-23:45:52.7136
;The angle between DC-Field and the k-vector is :
;       89.589 +/- 1.587 degrees
;The eigenvalues ratios are:
;       28.038376       12.250312
;The Minimum Variance eigenvector is:
;<-0.01452, 0.03111, 0.99941> +/- < 0.04935,-0.07441, 0.00303>
;
;Plot Index Range: 1039-1088
;Plot Range: 23:45:52.7381-23:45:52.7643
;The angle between DC-Field and the k-vector is :
;       86.711 +/- 1.368 degrees
;The eigenvalues ratios are:
;       38.539052       2.0964882
;The Minimum Variance eigenvector is:
;<-0.24328, 0.96967,-0.02354> +/- < 0.06316, 0.01435,-0.06165>
;
;Plot Index Range: 1089-1117
;Plot Range: 23:45:52.7648-23:45:52.7797
;The angle between DC-Field and the k-vector is :
;       86.820 +/- 3.151 degrees
;The eigenvalues ratios are:
;       14.175149       3.6809604
;The Minimum Variance eigenvector is:
;<-0.17117, 0.98360, 0.05690> +/- < 0.14506, 0.02895,-0.06399>
;
;Plot Index Range: 1133-1164
;Plot Range: 23:45:52.7883-23:45:52.8048
;The angle between DC-Field and the k-vector is :
;       61.205 +/- 3.110 degrees
;The eigenvalues ratios are:
;       13.241567       2.4419507
;The Minimum Variance eigenvector is:
;<-0.11893, 0.95587,-0.26864> +/- < 0.16699, 0.01050,-0.03655>
;
;Plot Index Range: 1185-1236
;Plot Range: 23:45:52.8160-23:45:52.8432
;The angle between DC-Field and the k-vector is :
;       72.886 +/- 1.231 degrees
;The eigenvalues ratios are:
;       45.270082       2.4018341
;The Minimum Variance eigenvector is:
;<-0.50855, 0.86087,-0.01666> +/- < 0.06707, 0.03926,-0.01830>
;
;Plot Index Range: 1249-1284
;Plot Range: 23:45:52.8501-23:45:52.8688
;The angle between DC-Field and the k-vector is :
;       76.557 +/- 2.252 degrees
;The eigenvalues ratios are:
;       20.998343       2.1831746
;The Minimum Variance eigenvector is:
;<-0.30145, 0.92449,-0.23332> +/- < 0.12521, 0.03421,-0.02621>
;
;Plot Index Range: 1356-1400
;Plot Range: 23:45:52.9072-23:45:52.9307
;The angle between DC-Field and the k-vector is :
;       86.621 +/- 1.672 degrees
;The eigenvalues ratios are:
;       29.284075       1.7958114
;The Minimum Variance eigenvector is:
;<-0.39123, 0.86238,-0.32129> +/- < 0.09968, 0.04270,-0.00677>
;
;Plot Index Range: 1672-1721
;Plot Range: 23:45:53.0757-23:45:53.1019
;The angle between DC-Field and the k-vector is :
;       79.438 +/- 1.066 degrees
;The eigenvalues ratios are:
;       62.121487       3.6812325
;The Minimum Variance eigenvector is:
;<-0.89916, 0.14206, 0.41392> +/- < 0.00704,-0.05495, 0.03416>
;
;Plot Index Range: 1776-1808
;Plot Range: 23:45:53.1312-23:45:53.1483
;The angle between DC-Field and the k-vector is :
;       73.626 +/- 2.764 degrees
;The eigenvalues ratios are:
;       15.798078       2.3363247
;The Minimum Variance eigenvector is:
;<-0.95488,-0.04277,-0.29390> +/- < 0.01047, 0.14521,-0.05516>
;
;Plot Index Range: 1920-1941
;Plot Range: 23:45:53.2080-23:45:53.2192
;The angle between DC-Field and the k-vector is :
;       76.697 +/- 1.845 degrees
;The eigenvalues ratios are:
;       50.222982       1.2351845
;The Minimum Variance eigenvector is:
;< 0.95346, 0.29549,-0.05992> +/- < 0.02923,-0.09993,-0.02766>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:45:52.2720',prefd[0]+'23:45:52.2965'])
tr1     = time_double([prefd[0]+'23:45:52.3051',prefd[0]+'23:45:52.3168'])
tr2     = time_double([prefd[0]+'23:45:52.5173',prefd[0]+'23:45:52.5392'])
tr3     = time_double([prefd[0]+'23:45:52.5504',prefd[0]+'23:45:52.5680'])
tr4     = time_double([prefd[0]+'23:45:52.6064',prefd[0]+'23:45:52.6443'])
tr5     = time_double([prefd[0]+'23:45:52.6560',prefd[0]+'23:45:52.6768'])
tr6     = time_double([prefd[0]+'23:45:52.6864',prefd[0]+'23:45:52.7136'])
tr7     = time_double([prefd[0]+'23:45:52.7381',prefd[0]+'23:45:52.7643'])
tr8     = time_double([prefd[0]+'23:45:52.7648',prefd[0]+'23:45:52.7797'])
tr9     = time_double([prefd[0]+'23:45:52.7883',prefd[0]+'23:45:52.8048'])
tr10    = time_double([prefd[0]+'23:45:52.8160',prefd[0]+'23:45:52.8432'])
tr11    = time_double([prefd[0]+'23:45:52.8501',prefd[0]+'23:45:52.8688'])
tr12    = time_double([prefd[0]+'23:45:52.9072',prefd[0]+'23:45:52.9307'])
tr13    = time_double([prefd[0]+'23:45:53.0757',prefd[0]+'23:45:53.1019'])
tr14    = time_double([prefd[0]+'23:45:53.1312',prefd[0]+'23:45:53.1483'])
tr15    = time_double([prefd[0]+'23:45:53.2080',prefd[0]+'23:45:53.2192'])

kvec0   = [-0.26831, 0.96178,-0.05470]
kvec1   = [-0.15521, 0.98393,-0.08824]
kvec2   = [-0.44551, 0.88835, 0.11117]
kvec3   = [-0.37382, 0.92745,-0.00937]
kvec4   = [-0.43834, 0.87636, 0.19961]
kvec5   = [-0.56609, 0.80905, 0.15807]
kvec6   = [-0.01452, 0.03111, 0.99941]
kvec7   = [-0.24328, 0.96967,-0.02354]
kvec8   = [-0.17117, 0.98360, 0.05690]
kvec9   = [-0.11893, 0.95587,-0.26864]
kvec10  = [-0.50855, 0.86087,-0.01666]
kvec11  = [-0.30145, 0.92449,-0.23332]
kvec12  = [-0.39123, 0.86238,-0.32129]
kvec13  = [-0.89916, 0.14206, 0.41392]
kvec14  = [-0.95488,-0.04277,-0.29390]
kvec15  = [ 0.95346, 0.29549,-0.05992]

dkvec0  = ABS([ 0.15640, 0.04116,-0.04347])
dkvec1  = ABS([ 0.12220, 0.01375,-0.06165])
dkvec2  = ABS([ 0.09504, 0.04809,-0.00336])
dkvec3  = ABS([ 0.06325, 0.02513,-0.03616])
dkvec4  = ABS([ 0.04589, 0.02640,-0.01515])
dkvec5  = ABS([ 0.09067, 0.06695,-0.01799])
dkvec6  = ABS([ 0.04935,-0.07441, 0.00303])
dkvec7  = ABS([ 0.06316, 0.01435,-0.06165])
dkvec8  = ABS([ 0.14506, 0.02895,-0.06399])
dkvec9  = ABS([ 0.16699, 0.01050,-0.03655])
dkvec10 = ABS([ 0.06707, 0.03926,-0.01830])
dkvec11 = ABS([ 0.12521, 0.03421,-0.02621])
dkvec12 = ABS([ 0.09968, 0.04270,-0.00677])
dkvec13 = ABS([ 0.00704,-0.05495, 0.03416])
dkvec14 = ABS([ 0.01047, 0.14521,-0.05516])
dkvec15 = ABS([ 0.02923,-0.09993,-0.02766])

elam0   = [10.491600,3.5389407]
elam1   = [21.914105,3.4254733]
elam2   = [30.109949,2.0537280]
elam3   = [53.748889,3.8948033]
elam4   = [75.312227,2.9754440]
elam5   = [24.034594,3.1534748]
elam6   = [28.038376,12.250312]
elam7   = [38.539052,2.0964882]
elam8   = [14.175149,3.6809604]
elam9   = [13.241567,2.4419507]
elam10  = [45.270082,2.4018341]
elam11  = [20.998343,2.1831746]
elam12  = [29.284075,1.7958114]
elam13  = [62.121487,3.6812325]
elam14  = [15.798078,2.3363247]
elam15  = [50.222982,1.2351845]

bvec0   = [-0.39118, 0.86844, 0.30462]
bvec1   = [-0.39549, 0.86553, 0.30733]
bvec2   = [-0.40051, 0.85089, 0.33997]
bvec3   = [-0.40321, 0.85583, 0.32389]
bvec4   = [-0.41965, 0.88121, 0.21688]
bvec5   = [-0.41930, 0.89091, 0.17448]
bvec6   = [-0.41365, 0.89748, 0.15295]
bvec7   = [-0.40422, 0.90199, 0.15142]
bvec8   = [-0.40003, 0.89909, 0.17774]
bvec9   = [-0.39469, 0.89479, 0.20863]
bvec10  = [-0.38779, 0.88891, 0.24379]
bvec11  = [-0.38415, 0.88761, 0.25410]
bvec12  = [-0.37678, 0.88622, 0.26953]
bvec13  = [-0.32387, 0.92222, 0.21115]
bvec14  = [-0.31817, 0.93359, 0.16477]
bvec15  = [-0.31875, 0.94267, 0.09886]
bmag0   = [36.74172]
bmag1   = [37.13659]
bmag2   = [37.02854]
bmag3   = [37.11294]
bmag4   = [37.81704]
bmag5   = [37.65031]
bmag6   = [37.07808]
bmag7   = [36.62094]
bmag8   = [36.77810]
bmag9   = [37.00132]
bmag10  = [37.33335]
bmag11  = [37.57768]
bmag12  = [38.02568]
bmag13  = [38.43571]
bmag14  = [38.25774]
bmag15  = [37.75819]

tags    = ['t0','t1','t2','t3','t4','t5','t6','t7','t8','t9','t10','t11','t12','t13',$
           't14','t15']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,$
                        tr13,tr14,tr15)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,$
                        kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,$
                        dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  100 Hz < f < 300 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.2720-23:45:52.2965     -0.268      0.962     -0.055     -0.391      0.868      0.305     36.742
;   23:45:52.3051-23:45:52.3168     -0.155      0.984     -0.088     -0.395      0.866      0.307     37.137
;   23:45:52.5173-23:45:52.5392     -0.446      0.888      0.111     -0.401      0.851      0.340     37.029
;   23:45:52.5504-23:45:52.5680     -0.374      0.927     -0.009     -0.403      0.856      0.324     37.113
;   23:45:52.6064-23:45:52.6443     -0.438      0.876      0.200     -0.420      0.881      0.217     37.817
;   23:45:52.6560-23:45:52.6768     -0.566      0.809      0.158     -0.419      0.891      0.174     37.650
;   23:45:52.6864-23:45:52.7136     -0.015      0.031      0.999     -0.414      0.897      0.153     37.078
;   23:45:52.7381-23:45:52.7643     -0.243      0.970     -0.024     -0.404      0.902      0.151     36.621
;   23:45:52.7648-23:45:52.7797     -0.171      0.984      0.057     -0.400      0.899      0.178     36.778
;   23:45:52.7883-23:45:52.8048     -0.119      0.956     -0.269     -0.395      0.895      0.209     37.001
;   23:45:52.8160-23:45:52.8432     -0.509      0.861     -0.017     -0.388      0.889      0.244     37.333
;   23:45:52.8501-23:45:52.8688     -0.301      0.924     -0.233     -0.384      0.888      0.254     37.578
;   23:45:52.9072-23:45:52.9307     -0.391      0.862     -0.321     -0.377      0.886      0.270     38.026
;   23:45:53.0757-23:45:53.1019     -0.899      0.142      0.414     -0.324      0.922      0.211     38.436
;   23:45:53.1312-23:45:53.1483     -0.955     -0.043     -0.294     -0.318      0.934      0.165     38.258
;   23:45:53.2080-23:45:53.2192      0.953      0.295     -0.060     -0.319      0.943      0.099     37.758

vswu   = [-673.799,-38.333,-24.744]         ; => My 3DP estimates (km/s) For 1998-09-24/23:45:52.184 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  100 Hz < f < 300 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.2720-23:45:52.2965     22.551    157.449     87.002     92.998     77.578    102.422
;   23:45:52.3051-23:45:52.3168     27.640    152.360     92.551     87.449     84.132     95.868
;   23:45:52.5173-23:45:52.5392     13.563    166.437     79.988    100.012     67.046    112.954
;   23:45:52.5504-23:45:52.5680     19.707    160.293     81.904     98.096     71.297    108.703
;   23:45:52.6064-23:45:52.6443      1.820    178.180     81.965     98.035     67.649    112.351
;   23:45:52.6560-23:45:52.6768      9.689    170.311     73.410    106.590     59.131    120.869
;   23:45:52.6864-23:45:52.7136     79.235    100.765    109.534     70.466     91.369     88.631
;   23:45:52.7381-23:45:52.7643     14.210    165.790     89.023     90.977     79.132    100.868
;   23:45:52.7648-23:45:52.7797     15.650    164.350     94.551     85.449     83.520     96.480
;   23:45:52.7883-23:45:52.8048     32.199    147.801     90.572     89.428     85.742     94.258
;   23:45:52.8160-23:45:52.8432     16.588    163.412     73.674    106.326     62.669    117.331
;   23:45:52.8501-23:45:52.8688     28.705    151.295     81.275     98.725     75.118    104.882
;   23:45:52.9072-23:45:52.9307     34.405    145.595     73.894    106.106     69.319    110.681
;   23:45:53.0757-23:45:53.1019     59.362    120.638     49.501    130.499     29.088    150.912
;   23:45:53.1312-23:45:53.1483     77.557    102.443     10.769    169.231     15.007    164.993
;   23:45:53.2080-23:45:53.2192     91.793     88.207    156.353     23.647    164.985     15.015

theta_kb0924_100_300   = DBLARR(nn)
theta_kn0924_100_300   = DBLARR(nn)
theta_kv0924_100_300   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_100_300[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_100_300[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_100_300[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_100_300[j]),  $
                     REFORM(theta_kn0924_100_300[j]),$
                     REFORM(theta_kv0924_100_300[j])
;
; => For  100 Hz < f < 300 Hz  at  1998-09-24/23:45:52.184 UT
;
;   23:45:52.2720-23:45:52.2965     22.551     87.002     77.578
;   23:45:52.3051-23:45:52.3168     27.640     87.449     84.132
;   23:45:52.5173-23:45:52.5392     13.563     79.988     67.046
;   23:45:52.5504-23:45:52.5680     19.707     81.904     71.297
;   23:45:52.6064-23:45:52.6443      1.820     81.965     67.649
;   23:45:52.6560-23:45:52.6768      9.689     73.410     59.131
;   23:45:52.6864-23:45:52.7136     79.235     70.466     88.631
;   23:45:52.7381-23:45:52.7643     14.210     89.023     79.132
;   23:45:52.7648-23:45:52.7797     15.650     85.449     83.520
;   23:45:52.7883-23:45:52.8048     32.199     89.428     85.742
;   23:45:52.8160-23:45:52.8432     16.588     73.674     62.669
;   23:45:52.8501-23:45:52.8688     28.705     81.275     75.118
;   23:45:52.9072-23:45:52.9307     34.405     73.894     69.319
;   23:45:53.0757-23:45:53.1019     59.362     49.501     29.088
;   23:45:53.1312-23:45:53.1483     77.557     10.769     15.007
;   23:45:53.2080-23:45:53.2192     88.207     23.647     15.015

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_100_300
PRINT,FORMAT=tkbf,theta_kn0924_100_300
PRINT,FORMAT=tkbf,theta_kv0924_100_300

theta_kb0924_100_300 = [22.55,27.64,13.56,19.71, 1.82, 9.69,79.23,14.21,15.65,32.20,16.59,28.70,34.40,59.36,77.56,88.21]
theta_kn0924_100_300 = [87.00,87.45,79.99,81.90,81.97,73.41,70.47,89.02,85.45,89.43,73.67,81.27,73.89,49.50,10.77,23.65]
theta_kv0924_100_300 = [77.58,84.13,67.05,71.30,67.65,59.13,88.63,79.13,83.52,85.74,62.67,75.12,69.32,29.09,15.01,15.01]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24



;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 7L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}
dummy3  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(3)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0      10.0      15.0      30.0
print, hfc0, format='(";",8f10.1)'
;      30.0      30.0      60.0     100.0

vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy1,FCUTOFF=[lfc0[1],hfc0[1]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy3,FCUTOFF=[lfc0[3],hfc0[3]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

bvec0   = [-0.36052, 0.87588, 0.32070]
bmag0   = [35.94512]
;-----------------------------------------------------------------------------------------
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:45:53.379 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 0-195
;Plot Range: 23:45:53.3790-23:45:53.4830
;The angle between DC-Field and the k-vector is :
;       87.982 +/- 0.702 degrees
;The eigenvalues ratios are:
;       36.294570       3.4691180
;The Minimum Variance eigenvector is:
;< 0.84150, 0.42724,-0.33067> +/- < 0.02937,-0.05276, 0.00657>
;
;Plot Index Range: 1090-1270
;Plot Range: 23:45:53.9603-23:45:54.0563
;The angle between DC-Field and the k-vector is :
;       86.507 +/- 1.066 degrees
;The eigenvalues ratios are:
;       18.098118       2.7334335
;The Minimum Variance eigenvector is:
;<-0.61395,-0.78848, 0.03698> +/- <-0.06429, 0.05190, 0.03920>
;
;Plot Index Range: 1535-1844
;Plot Range: 23:45:54.1977-23:45:54.3625
;The angle between DC-Field and the k-vector is :
;       87.613 +/- 1.046 degrees
;The eigenvalues ratios are:
;       11.662294       4.6997212
;The Minimum Variance eigenvector is:
;<-0.81915,-0.56581, 0.09404> +/- < 0.05319,-0.07143, 0.03352>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:45:53.3790',prefd[0]+'23:45:53.4830'])
tr1     = time_double([prefd[0]+'23:45:53.9603',prefd[0]+'23:45:54.0563'])
tr2     = time_double([prefd[0]+'23:45:54.1977',prefd[0]+'23:45:54.3625'])

kvec0   = [ 0.84150, 0.42724,-0.33067]
kvec1   = [-0.61395,-0.78848, 0.03698]
kvec2   = [-0.81915,-0.56581, 0.09404]

elam0   = [36.294570,3.4691180]
elam1   = [18.098118,2.7334335]
elam2   = [11.662294,4.6997212]

dkvec0  = ABS([ 0.02937,-0.05276, 0.00657])
dkvec1  = ABS([-0.06429, 0.05190, 0.03920])
dkvec2  = ABS([ 0.05319,-0.07143, 0.03352])

bvec0   = [-0.33137, 0.94228, 0.04754]
bvec1   = [-0.17263, 0.97093, 0.16525]
bvec2   = [-0.13380, 0.98966, 0.04879]
bmag0   = [36.55270]
bmag1   = [37.31338]
bmag2   = [37.31278]

tags    = ['t0','t1','t2']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:45:53.379 UT
;
;   23:45:53.3790-23:45:53.4830      0.841      0.427     -0.331     -0.331      0.942      0.048     36.553
;   23:45:53.9603-23:45:54.0563     -0.614     -0.788      0.037     -0.173      0.971      0.165     37.313
;   23:45:54.1977-23:45:54.3625     -0.819     -0.566      0.094     -0.134      0.990      0.049     37.313

vswu   = [-673.363,-37.922,-24.995]         ; => My 3DP estimates (km/s) For 1998-09-24/23:45:53.379 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:45:53.379 UT
;
;   23:45:53.3790-23:45:53.4830     83.799     96.201    138.622     41.378    148.359     31.641
;   23:45:53.9603-23:45:54.0563    130.803     49.197     43.780    136.220     49.043    130.957
;   23:45:54.1977-23:45:54.3625    116.473     63.527     32.742    147.258     32.263    147.737

theta_kb0924_03_30_3   = DBLARR(nn)
theta_kn0924_03_30_3   = DBLARR(nn)
theta_kv0924_03_30_3   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_03_30_3[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_03_30_3[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_03_30_3[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_03_30_3[j]),  $
                     REFORM(theta_kn0924_03_30_3[j]),$
                     REFORM(theta_kv0924_03_30_3[j])
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:45:53.379 UT
;
;   23:45:53.3790-23:45:53.4830     83.799     41.378     31.641
;   23:45:53.9603-23:45:54.0563     49.197     43.780     49.043
;   23:45:54.1977-23:45:54.3625     63.527     32.742     32.263

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_03_30_3
PRINT,FORMAT=tkbf,theta_kn0924_03_30_3
PRINT,FORMAT=tkbf,theta_kv0924_03_30_3

theta_kb0924_03_30_3 = [83.80,49.20,63.53]
theta_kn0924_03_30_3 = [41.38,43.78,32.74]
theta_kv0924_03_30_3 = [31.64,49.04,32.26]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
; => For  10 Hz < f < 30 Hz  at  1998-09-24/23:45:53.379 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 59-165
;Plot Range: 23:45:53.4105-23:45:53.4670
;The angle between DC-Field and the k-vector is :
;       82.589 +/- 1.725 degrees
;The eigenvalues ratios are:
;       12.422212       2.9564838
;The Minimum Variance eigenvector is:
;< 0.83506, 0.48611,-0.25763> +/- < 0.04535,-0.10562,-0.05229>
;
;Plot Index Range: 286-351
;Plot Range: 23:45:53.5315-23:45:53.5662
;The angle between DC-Field and the k-vector is :
;       86.791 +/- 0.126 degrees
;The eigenvalues ratios are:
;       3207.9226       6.6885591
;The Minimum Variance eigenvector is:
;< 0.83370, 0.52747,-0.16346> +/- < 0.00437,-0.00654, 0.00121>
;
;Plot Index Range: 376-474
;Plot Range: 23:45:53.5795-23:45:53.6318
;The angle between DC-Field and the k-vector is :
;       87.316 +/- 1.304 degrees
;The eigenvalues ratios are:
;       21.865255       1.4370167
;The Minimum Variance eigenvector is:
;< 0.13241,-0.71833, 0.68298> +/- < 0.09865,-0.01882,-0.03892>
;
;Plot Index Range: 510-605
;Plot Range: 23:45:53.6510-23:45:53.7017
;The angle between DC-Field and the k-vector is :
;       34.396 +/- 1.849 degrees
;The eigenvalues ratios are:
;       12.129272       3.1620564
;The Minimum Variance eigenvector is:
;<-0.66941,-0.73580,-0.10243> +/- <-0.09682, 0.08711, 0.00702>
;
;Plot Index Range: 685-817
;Plot Range: 23:45:53.7443-23:45:53.8147
;The angle between DC-Field and the k-vector is :
;       26.088 +/- 0.641 degrees
;The eigenvalues ratios are:
;       62.979651       5.1292091
;The Minimum Variance eigenvector is:
;< 0.23506, 0.96530, 0.11377> +/- < 0.04686,-0.01041,-0.00853>
;
;Plot Index Range: 1578-1695
;Plot Range: 23:45:54.2206-23:45:54.2830
;The angle between DC-Field and the k-vector is :
;       35.514 +/- 0.634 degrees
;The eigenvalues ratios are:
;       72.433134       3.4183791
;The Minimum Variance eigenvector is:
;< 0.96623, 0.23769,-0.09950> +/- < 0.01014,-0.04614,-0.01177>
;
;Plot Index Range: 1959-2047
;Plot Range: 23:45:54.4238-23:45:54.4707
;The angle between DC-Field and the k-vector is :
;       59.148 +/- 0.155 degrees
;The eigenvalues ratios are:
;       1579.4425       1.3766043
;The Minimum Variance eigenvector is:
;< 0.98563,-0.16033,-0.05316> +/- <-0.00186,-0.01241, 0.00290>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:45:53.4105',prefd[0]+'23:45:53.4670'])
tr1     = time_double([prefd[0]+'23:45:53.5315',prefd[0]+'23:45:53.5662'])
tr2     = time_double([prefd[0]+'23:45:53.5795',prefd[0]+'23:45:53.6318'])
tr3     = time_double([prefd[0]+'23:45:53.6510',prefd[0]+'23:45:53.7017'])
tr4     = time_double([prefd[0]+'23:45:53.7443',prefd[0]+'23:45:53.8147'])
tr5     = time_double([prefd[0]+'23:45:54.2206',prefd[0]+'23:45:54.2830'])
tr6     = time_double([prefd[0]+'23:45:54.4238',prefd[0]+'23:45:54.4707'])

kvec0   = [ 0.83506, 0.48611,-0.25763]
kvec1   = [ 0.83370, 0.52747,-0.16346]
kvec2   = [ 0.13241,-0.71833, 0.68298]
kvec3   = [-0.66941,-0.73580,-0.10243]
kvec4   = [ 0.23506, 0.96530, 0.11377]
kvec5   = [ 0.96623, 0.23769,-0.09950]
kvec6   = [ 0.98563,-0.16033,-0.05316]

dkvec0  = ABS([ 0.04535,-0.10562,-0.05229])
dkvec1  = ABS([ 0.00437,-0.00654, 0.00121])
dkvec2  = ABS([ 0.09865,-0.01882,-0.03892])
dkvec3  = ABS([-0.09682, 0.08711, 0.00702])
dkvec4  = ABS([ 0.04686,-0.01041,-0.00853])
dkvec5  = ABS([ 0.01014,-0.04614,-0.01177])
dkvec6  = ABS([-0.00186,-0.01241, 0.00290])

elam0   = [12.422212,2.9564838]
elam1   = [3207.9226,6.6885591]
elam2   = [21.865255,1.4370167]
elam3   = [12.129272,3.1620564]
elam4   = [62.979651,5.1292091]
elam5   = [72.433134,3.4183791]
elam6   = [1579.4425,1.3766043]

bvec0   = [-0.33056, 0.94251, 0.04900]
bvec1   = [-0.29953, 0.95266, 0.05196]
bvec2   = [-0.27956, 0.95902, 0.04580]
bvec3   = [-0.26621, 0.96266, 0.04860]
bvec4   = [-0.26988, 0.95990, 0.07561]
bvec5   = [-0.12963, 0.98994, 0.05621]
bvec6   = [-0.21097, 0.97530, 0.06354]
bmag0   = [36.54142]
bmag1   = [36.66088]
bmag2   = [36.54723]
bmag3   = [36.25351]
bmag4   = [36.19436]
bmag5   = [37.62001]
bmag6   = [35.57579]

tags    = ['t0','t1','t2','t3','t4','t5','t6']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5,tr6)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  10 Hz < f < 30 Hz  at  1998-09-24/23:45:53.379 UT
;
;   23:45:53.4105-23:45:53.4670      0.835      0.486     -0.258     -0.331      0.943      0.049     36.541
;   23:45:53.5315-23:45:53.5662      0.834      0.527     -0.163     -0.300      0.953      0.052     36.661
;   23:45:53.5795-23:45:53.6318      0.132     -0.718      0.683     -0.280      0.959      0.046     36.547
;   23:45:53.6510-23:45:53.7017     -0.669     -0.736     -0.102     -0.266      0.963      0.049     36.254
;   23:45:53.7443-23:45:53.8147      0.235      0.965      0.114     -0.270      0.960      0.076     36.194
;   23:45:54.2206-23:45:54.2830      0.966      0.238     -0.100     -0.130      0.990      0.056     37.620
;   23:45:54.4238-23:45:54.4707      0.986     -0.160     -0.053     -0.211      0.975      0.064     35.576

vswu   = [-673.363,-37.922,-24.995]         ; => My 3DP estimates (km/s) For 1998-09-24/23:45:53.379 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  10 Hz < f < 30 Hz  at  1998-09-24/23:45:53.379 UT
;
;   23:45:53.4105-23:45:53.4670     80.241     99.759    141.475     38.525    148.314     31.686
;   23:45:53.5315-23:45:53.5662     75.860    104.140    145.316     34.684    148.803     31.197
;   23:45:53.5795-23:45:53.6318    133.997     46.003    101.297     78.703     96.721     83.279
;   23:45:53.6510-23:45:53.7017    122.351     57.649     36.036    143.964     44.518    135.482
;   23:45:53.7443-23:45:53.8147     29.336    150.664    117.775     62.225    107.036     72.964
;   23:45:54.2206-23:45:54.2830     84.004     95.996    154.355     25.645    166.833     13.167
;   23:45:54.4238-23:45:54.4707    111.573     68.427    147.937     32.063    166.512     13.488

theta_kb0924_10_30   = DBLARR(nn)
theta_kn0924_10_30   = DBLARR(nn)
theta_kv0924_10_30   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_10_30[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_10_30[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_10_30[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_10_30[j]),  $
                     REFORM(theta_kn0924_10_30[j]),$
                     REFORM(theta_kv0924_10_30[j])
;
; => For  10 Hz < f < 30 Hz  at  1998-09-24/23:45:53.379 UT
;
;   23:45:53.4105-23:45:53.4670     80.241     38.525     31.686
;   23:45:53.5315-23:45:53.5662     75.860     34.684     31.197
;   23:45:53.5795-23:45:53.6318     46.003     78.703     83.279
;   23:45:53.6510-23:45:53.7017     57.649     36.036     44.518
;   23:45:53.7443-23:45:53.8147     29.336     62.225     72.964
;   23:45:54.2206-23:45:54.2830     84.004     25.645     13.167
;   23:45:54.4238-23:45:54.4707     68.427     32.063     13.488

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_10_30
PRINT,FORMAT=tkbf,theta_kn0924_10_30
PRINT,FORMAT=tkbf,theta_kv0924_10_30

theta_kb0924_10_30 = [80.24,75.86,46.00,57.65,29.34,84.00,68.43]
theta_kn0924_10_30 = [38.52,34.68,78.70,36.04,62.22,25.64,32.06]
theta_kv0924_10_30 = [31.69,31.20,83.28,44.52,72.96,13.17,13.49]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
; => For  30 Hz < f < 100 Hz  at  1998-09-24/23:45:53.379 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 937-1041
;Plot Range: 23:45:53.8787-23:45:53.9342
;The angle between DC-Field and the k-vector is :
;       86.506 +/- 1.996 degrees
;The eigenvalues ratios are:
;       9.9023298       2.0580086
;The Minimum Variance eigenvector is:
;< 0.88320, 0.30161, 0.35916> +/- < 0.06722,-0.11815,-0.06607>
;
;Plot Index Range: 937-975
;Plot Range: 23:45:53.8787-23:45:53.8990
;The angle between DC-Field and the k-vector is :
;       76.613 +/- 1.498 degrees
;The eigenvalues ratios are:
;       41.533379       4.0895355
;The Minimum Variance eigenvector is:
;< 0.94764, 0.28012, 0.15335> +/- < 0.02689,-0.06759,-0.04267>
;
;Plot Index Range: 1002-1041
;Plot Range: 23:45:53.9134-23:45:53.9342
;The angle between DC-Field and the k-vector is :
;       85.136 +/- 1.541 degrees
;The eigenvalues ratios are:
;       38.376669       1.6240703
;The Minimum Variance eigenvector is:
;<-0.83295,-0.26101,-0.48793> +/- < 0.04936,-0.07370,-0.04484>
;
;Plot Index Range: 1112-1166
;Plot Range: 23:45:53.9721-23:45:54.0009
;The angle between DC-Field and the k-vector is :
;       85.920 +/- 1.373 degrees
;The eigenvalues ratios are:
;       34.812951       4.2771430
;The Minimum Variance eigenvector is:
;< 0.86884, 0.46138, 0.17959> +/- < 0.03759,-0.07452, 0.00961>
;
;Plot Index Range: 1167-1241
;Plot Range: 23:45:54.0014-23:45:54.0409
;The angle between DC-Field and the k-vector is :
;       87.772 +/- 1.105 degrees
;The eigenvalues ratios are:
;       38.793612       4.5146921
;The Minimum Variance eigenvector is:
;< 0.55075, 0.80295, 0.22792> +/- < 0.06022,-0.04128,-0.00007>
;
;Plot Index Range: 1242-1276
;Plot Range: 23:45:54.0414-23:45:54.0595
;The angle between DC-Field and the k-vector is :
;       83.250 +/- 1.357 degrees
;The eigenvalues ratios are:
;       56.005101       4.4059436
;The Minimum Variance eigenvector is:
;< 0.78905, 0.61418,-0.01347> +/- < 0.04244,-0.05392, 0.02773>
;
;Plot Index Range: 1386-1460
;Plot Range: 23:45:54.1182-23:45:54.1577
;The angle between DC-Field and the k-vector is :
;       87.222 +/- 1.104 degrees
;The eigenvalues ratios are:
;       38.873166       1.7444184
;The Minimum Variance eigenvector is:
;< 0.63555, 0.49466,-0.59278> +/- <-0.05772, 0.05768,-0.01375>
;
;Plot Index Range: 1695-1731
;Plot Range: 23:45:54.2830-23:45:54.3022
;The angle between DC-Field and the k-vector is :
;       66.891 +/- 2.584 degrees
;The eigenvalues ratios are:
;       15.980759       5.5799013
;The Minimum Variance eigenvector is:
;< 0.85932, 0.30861, 0.40783> +/- <-0.06064, 0.11562, 0.04027>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:45:53.8787',prefd[0]+'23:45:53.8990'])
tr1     = time_double([prefd[0]+'23:45:53.9134',prefd[0]+'23:45:53.9342'])
tr2     = time_double([prefd[0]+'23:45:53.9721',prefd[0]+'23:45:54.0009'])
tr3     = time_double([prefd[0]+'23:45:54.0014',prefd[0]+'23:45:54.0409'])
tr4     = time_double([prefd[0]+'23:45:54.0414',prefd[0]+'23:45:54.0595'])
tr5     = time_double([prefd[0]+'23:45:54.1182',prefd[0]+'23:45:54.1577'])
tr6     = time_double([prefd[0]+'23:45:54.2830',prefd[0]+'23:45:54.3022'])

kvec0   = [ 0.94764, 0.28012, 0.15335]
kvec1   = [-0.83295,-0.26101,-0.48793]
kvec2   = [ 0.86884, 0.46138, 0.17959]
kvec3   = [ 0.55075, 0.80295, 0.22792]
kvec4   = [ 0.78905, 0.61418,-0.01347]
kvec5   = [ 0.63555, 0.49466,-0.59278]
kvec6   = [ 0.85932, 0.30861, 0.40783]

dkvec0  = ABS([ 0.02689,-0.06759,-0.04267])
dkvec1  = ABS([ 0.04936,-0.07370,-0.04484])
dkvec2  = ABS([ 0.03759,-0.07452, 0.00961])
dkvec3  = ABS([ 0.06022,-0.04128,-0.00007])
dkvec4  = ABS([ 0.04244,-0.05392, 0.02773])
dkvec5  = ABS([-0.05772, 0.05768,-0.01375])
dkvec6  = ABS([-0.06064, 0.11562, 0.04027])

elam0   = [41.533379,4.0895355]
elam1   = [38.376669,1.6240703]
elam2   = [34.812951,4.2771430]
elam3   = [38.793612,4.5146921]
elam4   = [56.005101,4.4059436]
elam5   = [38.873166,1.7444184]
elam6   = [15.980759,5.5799013]

bvec0   = [-0.22172, 0.96990, 0.10052]
bvec1   = [-0.19922, 0.97237, 0.12157]
bvec2   = [-0.17888, 0.97108, 0.15801]
bvec3   = [-0.16901, 0.97014, 0.17391]
bvec4   = [-0.16011, 0.97218, 0.17096]
bvec5   = [-0.13697, 0.98135, 0.13447]
bvec6   = [-0.13185, 0.99053, 0.03811]
bmag0   = [36.76622]
bmag1   = [36.74579]
bmag2   = [37.15865]
bmag3   = [37.42200]
bmag4   = [37.58584]
bmag5   = [37.88613]
bmag6   = [37.41882]

tags    = ['t0','t1','t2','t3','t4','t5','t6']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5,tr6)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  30 Hz < f < 100 Hz  at  1998-09-24/23:45:53.379 UT
;
;   23:45:53.8787-23:45:53.8990      0.948      0.280      0.153     -0.222      0.970      0.101     36.766
;   23:45:53.9134-23:45:53.9342     -0.833     -0.261     -0.488     -0.199      0.972      0.122     36.746
;   23:45:53.9721-23:45:54.0009      0.869      0.461      0.180     -0.179      0.971      0.158     37.159
;   23:45:54.0014-23:45:54.0409      0.551      0.803      0.228     -0.169      0.970      0.174     37.422
;   23:45:54.0414-23:45:54.0595      0.789      0.614     -0.013     -0.160      0.972      0.171     37.586
;   23:45:54.1182-23:45:54.1577      0.636      0.495     -0.593     -0.137      0.981      0.134     37.886
;   23:45:54.2830-23:45:54.3022      0.859      0.309      0.408     -0.132      0.991      0.038     37.419

vswu   = [-673.363,-37.922,-24.995]         ; => My 3DP estimates (km/s) For 1998-09-24/23:45:53.379 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  30 Hz < f < 100 Hz  at  1998-09-24/23:45:53.379 UT
;
;   23:45:53.8787-23:45:53.8990     85.584     94.416    168.539     11.461    165.220     14.780
;   23:45:53.9134-23:45:53.9342     98.463     81.537      9.896    170.104     30.254    149.746
;   23:45:53.9721-23:45:54.0009     71.277    108.723    163.110     16.890    154.085     25.915
;   23:45:54.0014-23:45:54.0409     43.487    136.513    139.267     40.733    127.089     52.911
;   23:45:54.0414-23:45:54.0595     62.066    117.934    148.399     31.601    145.212     34.788
;   23:45:54.1182-23:45:54.1577     71.417    108.583    119.182     60.818    129.788     50.212
;   23:45:54.2830-23:45:54.3022     77.999    102.001    172.924      7.076    152.850     27.150

theta_kb0924_30_100_2   = DBLARR(nn)
theta_kn0924_30_100_2   = DBLARR(nn)
theta_kv0924_30_100_2   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_30_100_2[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_30_100_2[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_30_100_2[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_30_100_2[j]),  $
                     REFORM(theta_kn0924_30_100_2[j]),$
                     REFORM(theta_kv0924_30_100_2[j])
;
; => For  30 Hz < f < 100 Hz  at  1998-09-24/23:45:53.379 UT
;
;   23:45:53.8787-23:45:53.8990     85.584     11.461     14.780
;   23:45:53.9134-23:45:53.9342     81.537      9.896     30.254
;   23:45:53.9721-23:45:54.0009     71.277     16.890     25.915
;   23:45:54.0014-23:45:54.0409     43.487     40.733     52.911
;   23:45:54.0414-23:45:54.0595     62.066     31.601     34.788
;   23:45:54.1182-23:45:54.1577     71.417     60.818     50.212
;   23:45:54.2830-23:45:54.3022     77.999      7.076     27.150

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_30_100_2
PRINT,FORMAT=tkbf,theta_kn0924_30_100_2
PRINT,FORMAT=tkbf,theta_kv0924_30_100_2

theta_kb0924_30_100_2 = [85.58,81.54,71.28,43.49,62.07,71.42,78.00]
theta_kn0924_30_100_2 = [11.46, 9.90,16.89,40.73,31.60,60.82, 7.08]
theta_kv0924_30_100_2 = [14.78,30.25,25.91,52.91,34.79,50.21,27.15]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 8L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0       4.0      10.0
print, hfc0, format='(";",8f10.1)'
;      30.0      40.0      40.0

vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy1,FCUTOFF=[lfc0[1],hfc0[1]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy2,FCUTOFF=[lfc0[2],hfc0[2]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

bvec0   = [-0.51771, 0.07381, 0.85236]
bmag0   = [35.49329]
;-----------------------------------------------------------------------------------------
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:39.020 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 130-261
;Plot Range: 23:48:39.0893-23:48:39.1592
;The angle between DC-Field and the k-vector is :
;       89.954 +/- 0.407 degrees
;The eigenvalues ratios are:
;       154.74879       1.2726007
;The Minimum Variance eigenvector is:
;<-0.69954,-0.70333, 0.12641> +/- <-0.01087, 0.01663, 0.03233>
;
;Plot Index Range: 819-1068
;Plot Range: 23:48:39.4568-23:48:39.5896
;The angle between DC-Field and the k-vector is :
;       61.957 +/- 0.551 degrees
;The eigenvalues ratios are:
;       45.537709       2.4461524
;The Minimum Variance eigenvector is:
;<-0.99818, 0.02093,-0.05653> +/- < 0.00296, 0.03621,-0.03886>
;
;Plot Index Range: 1513-1614
;Plot Range: 23:48:39.8269-23:48:39.8808
;The angle between DC-Field and the k-vector is :
;       88.605 +/- 1.836 degrees
;The eigenvalues ratios are:
;       11.657016       4.1448612
;The Minimum Variance eigenvector is:
;< 0.19072, 0.85902, 0.47508> +/- < 0.12517,-0.02118,-0.01195>
;
;Plot Index Range: 1733-1838
;Plot Range: 23:48:39.9443-23:48:40.0003
;The angle between DC-Field and the k-vector is :
;       66.813 +/- 1.243 degrees
;The eigenvalues ratios are:
;       22.399406       1.3734763
;The Minimum Variance eigenvector is:
;<-0.94753, 0.06257,-0.31350> +/- < 0.00401,-0.10044,-0.03217>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:48:39.0893',prefd[0]+'23:48:39.1592'])
tr1     = time_double([prefd[0]+'23:48:39.4568',prefd[0]+'23:48:39.5896'])
tr2     = time_double([prefd[0]+'23:48:39.8269',prefd[0]+'23:48:39.8808'])
tr3     = time_double([prefd[0]+'23:48:39.9443',prefd[0]+'23:48:40.0003'])

kvec0   = [-0.69954,-0.70333, 0.12641]
kvec1   = [-0.99818, 0.02093,-0.05653]
kvec2   = [ 0.19072, 0.85902, 0.47508]
kvec3   = [-0.94753, 0.06257,-0.31350]

dkvec0  = ABS([-0.01087, 0.01663, 0.03233])
dkvec1  = ABS([ 0.00296, 0.03621,-0.03886])
dkvec2  = ABS([ 0.12517,-0.02118,-0.01195])
dkvec3  = ABS([ 0.00401,-0.10044,-0.03217])

elam0   = [154.74879,1.2726007]
elam1   = [45.537709,2.4461524]
elam2   = [11.657016,4.1448612]
elam3   = [22.399406,1.3734763]

bvec0   = [-0.57094, 0.13760, 0.80938]
bvec1   = [-0.48937, 0.06926, 0.86869]
bvec2   = [-0.52446, 0.06980, 0.84855]
bvec3   = [-0.53003, 0.05332, 0.84630]
bmag0   = [35.77160]
bmag1   = [33.45378]
bmag2   = [35.60096]
bmag3   = [36.19178]

tags    = ['t0','t1','t2','t3']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:39.020 UT
;
;   23:48:39.0893-23:48:39.1592     -0.700     -0.703      0.126     -0.571      0.138      0.809     35.772
;   23:48:39.4568-23:48:39.5896     -0.998      0.021     -0.057     -0.489      0.069      0.869     33.454
;   23:48:39.8269-23:48:39.8808      0.191      0.859      0.475     -0.524      0.070      0.849     35.601
;   23:48:39.9443-23:48:40.0003     -0.948      0.063     -0.313     -0.530      0.053      0.846     36.192

vswu   = [-676.862,71.871,-53.301]         ; => My 3DP estimates (km/s) For 1998-09-24/23:48:39.020 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:39.020 UT
;
;   23:48:39.0893-23:48:39.1592     66.113    113.887     41.322    138.678     52.439    127.561
;   23:48:39.4568-23:48:39.5896     63.844    116.156     22.027    157.973      5.005    174.995
;   23:48:39.8269-23:48:39.8808     68.711    111.289    121.689     58.311     97.801     82.199
;   23:48:39.9443-23:48:40.0003     76.099    103.901     16.427    163.573     13.971    166.029

theta_kb0924_03_30_4   = DBLARR(nn)
theta_kn0924_03_30_4   = DBLARR(nn)
theta_kv0924_03_30_4   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_03_30_4[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_03_30_4[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_03_30_4[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_03_30_4[j]),  $
                     REFORM(theta_kn0924_03_30_4[j]),$
                     REFORM(theta_kv0924_03_30_4[j])
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:39.020 UT
;
;   23:48:39.0893-23:48:39.1592     66.113     41.322     52.439
;   23:48:39.4568-23:48:39.5896     63.844     22.027      5.005
;   23:48:39.8269-23:48:39.8808     68.711     58.311     82.199
;   23:48:39.9443-23:48:40.0003     76.099     16.427     13.971

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_03_30_4
PRINT,FORMAT=tkbf,theta_kn0924_03_30_4
PRINT,FORMAT=tkbf,theta_kv0924_03_30_4

theta_kb0924_03_30_4 = [66.11,63.84,68.71,76.10]
theta_kn0924_03_30_4 = [41.32,22.03,58.31,16.43]
theta_kv0924_03_30_4 = [52.44, 5.01,82.20,13.97]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24

;-----------------------------------------------------------------------------------------
; => For  4 Hz < f < 40 Hz  at  1998-09-24/23:48:39.020 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 130-261
;Plot Range: 23:48:39.0893-23:48:39.1592
;The angle between DC-Field and the k-vector is :
;       86.245 +/- 0.699 degrees
;The eigenvalues ratios are:
;       53.596030       1.3871830
;The Minimum Variance eigenvector is:
;< 0.70811, 0.70610,-0.00130> +/- <-0.01974, 0.01969,-0.05720>
;
;Plot Index Range: 819-1068
;Plot Range: 23:48:39.4568-23:48:39.5896
;The angle between DC-Field and the k-vector is :
;       58.970 +/- 0.770 degrees
;The eigenvalues ratios are:
;       24.294523       2.3006524
;The Minimum Variance eigenvector is:
;<-1.00000, 0.00039,-0.00264> +/- < 0.00016, 0.05376,-0.05100>
;
;Plot Index Range: 1513-1614
;Plot Range: 23:48:39.8269-23:48:39.8808
;The angle between DC-Field and the k-vector is :
;       82.747 +/- 2.317 degrees
;The eigenvalues ratios are:
;       7.9890147       6.0076109
;The Minimum Variance eigenvector is:
;< 0.17237, 0.83122, 0.52854> +/- < 0.13808, 0.01178,-0.06356>
;
;Plot Index Range: 1734-1838
;Plot Range: 23:48:39.9448-23:48:40.0003
;The angle between DC-Field and the k-vector is :
;       71.416 +/- 1.822 degrees
;The eigenvalues ratios are:
;       11.518623       2.0627809
;The Minimum Variance eigenvector is:
;< 0.79637, 0.09489, 0.59732> +/- <-0.04992, 0.12099, 0.04733>
;


;-----------------------------------------------------------------------------------------
; => For  10 Hz < f < 40 Hz  at  1998-09-24/23:48:39.020 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 0-254
;Plot Range: 23:48:39.0200-23:48:39.1555
;The angle between DC-Field and the k-vector is :
;       66.488 +/- 0.655 degrees
;The eigenvalues ratios are:
;       32.196043       2.3319916
;The Minimum Variance eigenvector is:
;< 0.47453,-0.38843, 0.78990> +/- < 0.04977, 0.03805,-0.01119>
;
;Plot Index Range: 1835-1989
;Plot Range: 23:48:39.9987-23:48:40.0808
;The angle between DC-Field and the k-vector is :
;       76.327 +/- 0.925 degrees
;The eigenvalues ratios are:
;       27.053090       2.2106113
;The Minimum Variance eigenvector is:
;< 0.93018, 0.16024,-0.33029> +/- < 0.00175,-0.07340,-0.03069>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:48:39.0200',prefd[0]+'23:48:39.1555'])
tr1     = time_double([prefd[0]+'23:48:39.9987',prefd[0]+'23:48:40.0808'])

kvec0   = [ 0.47453,-0.38843, 0.78990]
kvec1   = [ 0.93018, 0.16024,-0.33029]

dkvec0  = ABS([ 0.04977, 0.03805,-0.01119])
dkvec1  = ABS([ 0.00175,-0.07340,-0.03069])

elam0   = [32.196043,2.3319916]
elam1   = [27.053090,2.2106113]

bvec0   = [-0.57287, 0.13625, 0.80823]
bvec1   = [-0.53793, 0.04520, 0.84176]
bmag0   = [35.97463]
bmag1   = [36.30701]

tags    = ['t0','t1']
tr_str  = CREATE_STRUCT(tags,tr0,tr1)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  10 Hz < f < 40 Hz  at  1998-09-24/23:48:39.020 UT
;
;   23:48:39.0200-23:48:39.1555      0.475     -0.388      0.790     -0.573      0.136      0.808     35.975
;   23:48:39.9987-23:48:40.0808      0.930      0.160     -0.330     -0.538      0.045      0.842     36.307

vswu   = [-676.862,71.871,-53.301]         ; => My 3DP estimates (km/s) For 1998-09-24/23:48:39.020 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  10 Hz < f < 40 Hz  at  1998-09-24/23:48:39.020 UT
;
;   23:48:39.0200-23:48:39.1555     71.720    108.280    128.143     51.857    124.959     55.041
;   23:48:39.9987-23:48:40.0808    140.458     39.542    140.607     39.393    151.583     28.417

theta_kb0924_10_40   = DBLARR(nn)
theta_kn0924_10_40   = DBLARR(nn)
theta_kv0924_10_40   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_10_40[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_10_40[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_10_40[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_10_40[j]),  $
                     REFORM(theta_kn0924_10_40[j]),$
                     REFORM(theta_kv0924_10_40[j])
;
; => For  10 Hz < f < 40 Hz  at  1998-09-24/23:48:39.020 UT
;
;   23:48:39.0200-23:48:39.1555     71.720     51.857     55.041
;   23:48:39.9987-23:48:40.0808     39.542     39.393     28.417

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_10_40
PRINT,FORMAT=tkbf,theta_kn0924_10_40
PRINT,FORMAT=tkbf,theta_kv0924_10_40

theta_kb0924_10_40 = [71.72,39.54]
theta_kn0924_10_40 = [51.86,39.39]
theta_kv0924_10_40 = [55.04,28.42]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 9L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}
dummy3  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(3)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0       5.0       7.0      65.0
print, hfc0, format='(";",8f10.1)'
;      30.0      30.0      30.0     300.0

vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy1,FCUTOFF=[lfc0[1],hfc0[1]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy2,FCUTOFF=[lfc0[2],hfc0[2]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy3,FCUTOFF=[lfc0[3],hfc0[3]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

;-----------------------------------------------------------------------------------------
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:42.131 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 1884-2047
;Plot Range: 23:48:43.1358-23:48:43.2227
;The angle between DC-Field and the k-vector is :
;       88.483 +/- 0.628 degrees
;The eigenvalues ratios are:
;       53.356093       2.1415350
;The Minimum Variance eigenvector is:
;<-0.87410, 0.03281,-0.48464> +/- < 0.01612,-0.04268,-0.03196>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:48:43.1358',prefd[0]+'23:48:43.2227'])
kvec0   = [-0.87410, 0.03281,-0.48464]
dkvec0  = ABS([ 0.01612,-0.04268,-0.03196])
elam0   = [53.356093,2.1415350]

bvec0   = [-0.36657, 0.10617, 0.92429]
bmag0   = [36.70069]

tags    = ['t0']
tr_str  = CREATE_STRUCT(tags,tr0)
kv_str  = CREATE_STRUCT(tags,kvec0)
dkv_str = CREATE_STRUCT(tags,dkvec0)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:42.131 UT
;
;   23:48:43.1358-23:48:43.2227     -0.874      0.033     -0.485     -0.367      0.106      0.924     36.701

vswu   = [-679.223,76.920,-53.406]         ; => My 3DP estimates (km/s) For 1998-09-24/23:48:42.131 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:42.131 UT
;
;   23:48:43.1358-23:48:43.2227     97.125     82.875     16.869    163.131     24.860    155.140

theta_kb0924_03_30_5   = DBLARR(nn)
theta_kn0924_03_30_5   = DBLARR(nn)
theta_kv0924_03_30_5   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_03_30_5[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_03_30_5[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_03_30_5[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_03_30_5[j]),  $
                     REFORM(theta_kn0924_03_30_5[j]),$
                     REFORM(theta_kv0924_03_30_5[j])
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:42.131 UT
;
;   23:48:43.1358-23:48:43.2227     82.875     16.869     24.860

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_03_30_5
PRINT,FORMAT=tkbf,theta_kn0924_03_30_5
PRINT,FORMAT=tkbf,theta_kv0924_03_30_5

theta_kb0924_03_30_5 = [82.88]
theta_kn0924_03_30_5 = [16.87]
theta_kv0924_03_30_5 = [24.86]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
; => For  7 Hz < f < 30 Hz  at  1998-09-24/23:48:42.131 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 1246-1394
;Plot Range: 23:48:42.7955-23:48:42.8745
;The angle between DC-Field and the k-vector is :
;       85.627 +/- 0.844 degrees
;The eigenvalues ratios are:
;       33.348120       5.3057982
;The Minimum Variance eigenvector is:
;<-0.67216, 0.58668,-0.45167> +/- < 0.04240, 0.01131,-0.04841>
;
;Plot Index Range: 1395-1545
;Plot Range: 23:48:42.8750-23:48:42.9550
;The angle between DC-Field and the k-vector is :
;       87.699 +/- 0.672 degrees
;The eigenvalues ratios are:
;       50.765468       4.3166271
;The Minimum Variance eigenvector is:
;<-0.60638, 0.57885,-0.54519> +/- < 0.04201, 0.01768,-0.02796>
;


;-----------------------------------------------------------------------------------------
; => For  65 Hz < f < 300 Hz  at  1998-09-24/23:48:42.131 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 1467-1533
;Plot Range: 23:48:42.9134-23:48:42.9486
;The angle between DC-Field and the k-vector is :
;       80.986 +/- 1.125 degrees
;The eigenvalues ratios are:
;       41.869068       1.5556371
;The Minimum Variance eigenvector is:
;< 0.50505,-0.35900,-0.78488> +/- <-0.04583, 0.04784,-0.05137>
;
;Plot Index Range: 1710-1850
;Plot Range: 23:48:43.0430-23:48:43.1177
;The angle between DC-Field and the k-vector is :
;       49.805 +/- 1.246 degrees
;The eigenvalues ratios are:
;       17.150403       1.4015240
;The Minimum Variance eigenvector is:
;<-0.37503, 0.18313, 0.90874> +/- < 0.10356,-0.00391, 0.04353>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:48:42.9134',prefd[0]+'23:48:42.9486'])
tr1     = time_double([prefd[0]+'23:48:43.0430',prefd[0]+'23:48:43.1177'])

kvec0   = [ 0.50505,-0.35900,-0.78488]
kvec1   = [-0.37503, 0.18313, 0.90874]

dkvec0  = ABS([-0.04583, 0.04784,-0.05137])
dkvec1  = ABS([ 0.10356,-0.00391, 0.04353])

elam0   = [41.869068,1.5556371]
elam1   = [17.150403,1.4015240]

bvec0   = [-0.35979, 0.04736, 0.93183]
bvec1   = [-0.35951, 0.08646, 0.92908]
bmag0   = [36.62919]
bmag1   = [36.61893]

tags    = ['t0','t1']
tr_str  = CREATE_STRUCT(tags,tr0,tr1)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  65 Hz < f < 300 Hz  at  1998-09-24/23:48:42.131 UT
;
;   23:48:42.9134-23:48:42.9486      0.505     -0.359     -0.785     -0.360      0.047      0.932     36.629
;   23:48:43.0430-23:48:43.1177     -0.375      0.183      0.909     -0.360      0.086      0.929     36.619

vswu   = [-679.223,76.920,-53.406]         ; => My 3DP estimates (km/s) For 1998-09-24/23:48:42.131 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  65 Hz < f < 300 Hz  at  1998-09-24/23:48:42.131 UT
;
;   23:48:42.9134-23:48:42.9486    158.448     21.552     96.603     83.397    118.650     61.350
;   23:48:43.0430-23:48:43.1177      5.758    174.242     90.424     89.576     71.260    108.740

theta_kb0924_65_300   = DBLARR(nn)
theta_kn0924_65_300   = DBLARR(nn)
theta_kv0924_65_300   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_65_300[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_65_300[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_65_300[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_65_300[j]),  $
                     REFORM(theta_kn0924_65_300[j]),$
                     REFORM(theta_kv0924_65_300[j])
;
; => For  65 Hz < f < 300 Hz  at  1998-09-24/23:48:42.131 UT
;
;   23:48:42.9134-23:48:42.9486     21.552     83.397     61.350
;   23:48:43.0430-23:48:43.1177      5.758     89.576     71.260

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_65_300
PRINT,FORMAT=tkbf,theta_kn0924_65_300
PRINT,FORMAT=tkbf,theta_kv0924_65_300

theta_kb0924_65_300 = [21.55, 5.76]
theta_kn0924_65_300 = [83.40,89.58]
theta_kv0924_65_300 = [61.35,71.26]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 10L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0       6.0      10.0
print, hfc0, format='(";",8f10.1)'
;      30.0      30.0     100.0

vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

vector_mv_plot,DATE=date,MYMAG=dummy1,FCUTOFF=[lfc0[1],hfc0[1]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi

;-----------------------------------------------------------------------------------------
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:51.622 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 201-273
;Plot Range: 23:48:51.7292-23:48:51.7676
;The angle between DC-Field and the k-vector is :
;       66.275 +/- 1.750 degrees
;The eigenvalues ratios are:
;       17.035350       1.1485499
;The Minimum Variance eigenvector is:
;< 0.97104,-0.07546,-0.22668> +/- < 0.00106, 0.13381,-0.04001>
;
;Plot Index Range: 391-465
;Plot Range: 23:48:51.8305-23:48:51.8700
;The angle between DC-Field and the k-vector is :
;       14.111 +/- 1.516 degrees
;The eigenvalues ratios are:
;       21.521769       7.0496031
;The Minimum Variance eigenvector is:
;< 0.33812, 0.93928, 0.05848> +/- < 0.09001,-0.03203,-0.00597>
;
;Plot Index Range: 677-796
;Plot Range: 23:48:51.9831-23:48:52.0465
;The angle between DC-Field and the k-vector is :
;       65.031 +/- 1.389 degrees
;The eigenvalues ratios are:
;       16.355393       6.0779648
;The Minimum Variance eigenvector is:
;< 0.87050,-0.10569, 0.48068> +/- < 0.03199,-0.06079,-0.07130>
;
;Plot Index Range: 706-796
;Plot Range: 23:48:51.9985-23:48:52.0465
;The angle between DC-Field and the k-vector is :
;       67.791 +/- 1.283 degrees
;The eigenvalues ratios are:
;       24.369127       9.5501529
;The Minimum Variance eigenvector is:
;< 0.80539,-0.09212, 0.58554> +/- < 0.04124,-0.03784,-0.06268>
;
;Plot Index Range: 850-1148
;Plot Range: 23:48:52.0753-23:48:52.2343
;The angle between DC-Field and the k-vector is :
;       84.541 +/- 0.863 degrees
;The eigenvalues ratios are:
;       16.787034       1.8157096
;The Minimum Variance eigenvector is:
;< 0.82697,-0.29246, 0.48019> +/- <-0.03738,-0.07957, 0.01592>
;
;Plot Index Range: 944-1110
;Plot Range: 23:48:52.1255-23:48:52.2140
;The angle between DC-Field and the k-vector is :
;       89.356 +/- 0.889 degrees
;The eigenvalues ratios are:
;       27.153925       2.0031317
;The Minimum Variance eigenvector is:
;< 0.78323,-0.53048, 0.32427> +/- <-0.04608,-0.06408, 0.00646>
;
;Plot Index Range: 1110-1239
;Plot Range: 23:48:52.2140-23:48:52.2828
;The angle between DC-Field and the k-vector is :
;       84.884 +/- 0.587 degrees
;The eigenvalues ratios are:
;       76.307833       2.7608438
;The Minimum Variance eigenvector is:
;< 0.11369,-0.25738, 0.95960> +/- < 0.02528, 0.03949, 0.00760>
;
;Plot Index Range: 1497-1665
;Plot Range: 23:48:52.4204-23:48:52.5100
;The angle between DC-Field and the k-vector is :
;       70.746 +/- 1.247 degrees
;The eigenvalues ratios are:
;       14.580223       4.1599116
;The Minimum Variance eigenvector is:
;< 0.21867,-0.55855,-0.80013> +/- < 0.04299,-0.06761, 0.05894>
;
;Plot Index Range: 1786-1869
;Plot Range: 23:48:52.5745-23:48:52.6188
;The angle between DC-Field and the k-vector is :
;       18.889 +/- 0.992 degrees
;The eigenvalues ratios are:
;       42.643769       2.3939870
;The Minimum Variance eigenvector is:
;<-0.12104, 0.79854,-0.58965> +/- <-0.05316, 0.02405, 0.04349>
;
;Plot Index Range: 1870-1965
;Plot Range: 23:48:52.6193-23:48:52.6700
;The angle between DC-Field and the k-vector is :
;       76.016 +/- 1.187 degrees
;The eigenvalues ratios are:
;       26.732400       11.262658
;The Minimum Variance eigenvector is:
;< 0.87821,-0.35410, 0.32150> +/- < 0.00509,-0.04532,-0.06383>
;
;Plot Index Range: 1966-2047
;Plot Range: 23:48:52.6705-23:48:52.7137
;The angle between DC-Field and the k-vector is :
;       29.644 +/- 0.654 degrees
;The eigenvalues ratios are:
;       97.883290       4.5885985
;The Minimum Variance eigenvector is:
;<-0.19853, 0.39234, 0.89814> +/- < 0.03045,-0.02679, 0.01843>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:48:51.7292',prefd[0]+'23:48:51.7676'])
tr1     = time_double([prefd[0]+'23:48:51.8305',prefd[0]+'23:48:51.8700'])
tr2     = time_double([prefd[0]+'23:48:51.9985',prefd[0]+'23:48:52.0465'])
tr3     = time_double([prefd[0]+'23:48:52.1255',prefd[0]+'23:48:52.2140'])
tr4     = time_double([prefd[0]+'23:48:52.2140',prefd[0]+'23:48:52.2828'])
tr5     = time_double([prefd[0]+'23:48:52.4204',prefd[0]+'23:48:52.5100'])
tr6     = time_double([prefd[0]+'23:48:52.5745',prefd[0]+'23:48:52.6188'])
tr7     = time_double([prefd[0]+'23:48:52.6193',prefd[0]+'23:48:52.6700'])
tr8     = time_double([prefd[0]+'23:48:52.6705',prefd[0]+'23:48:52.7137'])

kvec0   = [ 0.97104,-0.07546,-0.22668]
kvec1   = [ 0.33812, 0.93928, 0.05848]
kvec2   = [ 0.80539,-0.09212, 0.58554]
kvec3   = [ 0.78323,-0.53048, 0.32427]
kvec4   = [ 0.11369,-0.25738, 0.95960]
kvec5   = [ 0.21867,-0.55855,-0.80013]
kvec6   = [-0.12104, 0.79854,-0.58965]
kvec7   = [ 0.87821,-0.35410, 0.32150]
kvec8   = [-0.19853, 0.39234, 0.89814]

dkvec0  = ABS([ 0.00106, 0.13381,-0.04001])
dkvec1  = ABS([ 0.09001,-0.03203,-0.00597])
dkvec2  = ABS([ 0.04124,-0.03784,-0.06268])
dkvec3  = ABS([-0.04608,-0.06408, 0.00646])
dkvec4  = ABS([ 0.02528, 0.03949, 0.00760])
dkvec5  = ABS([ 0.04299,-0.06761, 0.05894])
dkvec6  = ABS([-0.05316, 0.02405, 0.04349])
dkvec7  = ABS([ 0.00509,-0.04532,-0.06383])
dkvec8  = ABS([ 0.03045,-0.02679, 0.01843])

elam0   = [17.035350,1.1485499]
elam1   = [21.521769,7.0496031]
elam2   = [24.369127,9.5501529]
elam3   = [27.153925,2.0031317]
elam4   = [76.307833,2.7608438]
elam5   = [14.580223,4.1599116]
elam6   = [42.643769,2.3939870]
elam7   = [26.732400,11.262658]
elam8   = [97.883290,4.5885985]

bvec0   = [-0.44006,-0.05226, 0.89645]
bvec1   = [-0.43928,-0.07447, 0.89525]
bvec2   = [-0.43960,-0.08303, 0.89435]
bvec3   = [-0.43170,-0.06896, 0.89937]
bvec4   = [-0.42504,-0.07594, 0.90195]
bvec5   = [-0.43640,-0.08465, 0.89575]
bvec6   = [-0.42788,-0.07712, 0.90054]
bvec7   = [-0.42489,-0.08280, 0.90145]
bvec8   = [-0.42234,-0.08726, 0.90223]
bmag0   = [35.99808]
bmag1   = [36.22013]
bmag2   = [36.40689]
bmag3   = [36.82518]
bmag4   = [36.70990]
bmag5   = [37.06684]
bmag6   = [36.77235]
bmag7   = [36.79766]
bmag8   = [36.84108]

tags    = ['t0','t1','t2','t3','t4','t5','t6','t7','t8']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,$
                        dkvec8)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:51.622 UT
;
;   23:48:51.7292-23:48:51.7676      0.971     -0.075     -0.227     -0.440     -0.052      0.896     35.998
;   23:48:51.8305-23:48:51.8700      0.338      0.939      0.058     -0.439     -0.074      0.895     36.220
;   23:48:51.9985-23:48:52.0465      0.805     -0.092      0.586     -0.440     -0.083      0.894     36.407
;   23:48:52.1255-23:48:52.2140      0.783     -0.530      0.324     -0.432     -0.069      0.899     36.825
;   23:48:52.2140-23:48:52.2828      0.114     -0.257      0.960     -0.425     -0.076      0.902     36.710
;   23:48:52.4204-23:48:52.5100      0.219     -0.559     -0.800     -0.436     -0.085      0.896     37.067
;   23:48:52.5745-23:48:52.6188     -0.121      0.799     -0.590     -0.428     -0.077      0.901     36.772
;   23:48:52.6193-23:48:52.6700      0.878     -0.354      0.322     -0.425     -0.083      0.901     36.798
;   23:48:52.6705-23:48:52.7137     -0.199      0.392      0.898     -0.422     -0.087      0.902     36.841

vswu   = [-686.423,92.322,-53.727]         ; => My 3DP estimates (km/s) For 1998-09-24/23:48:51.622 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:51.622 UT
;
;   23:48:51.7292-23:48:51.7676    128.798     51.202    142.526     37.474    162.174     17.826
;   23:48:51.8305-23:48:51.8700     99.563     80.437    122.386     57.614    102.345     77.655
;   23:48:51.9985-23:48:52.0465     79.789    100.211    156.281     23.719    148.577     31.423
;   23:48:52.1255-23:48:52.2140     90.567     89.433    135.214     44.786    150.400     29.600
;   23:48:52.2140-23:48:52.2828     33.204    146.796    111.994     68.006    102.754     77.246
;   23:48:52.4204-23:48:52.5100    139.895     40.105     78.705    101.295    103.204     76.796
;   23:48:52.5745-23:48:52.6188    122.738     57.262     82.182     97.818     74.257    105.743
;   23:48:52.6193-23:48:52.6700     93.096     86.904    146.555     33.445    160.000     20.000
;   23:48:52.6705-23:48:52.7137     30.690    149.310    102.188     77.812     79.697    100.303

theta_kb0924_03_30_6   = DBLARR(nn)
theta_kn0924_03_30_6   = DBLARR(nn)
theta_kv0924_03_30_6   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_03_30_6[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_03_30_6[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_03_30_6[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_03_30_6[j]),  $
                     REFORM(theta_kn0924_03_30_6[j]),$
                     REFORM(theta_kv0924_03_30_6[j])
;
; => For  3 Hz < f < 30 Hz  at  1998-09-24/23:48:51.622 UT
;
;   23:48:51.7292-23:48:51.7676     51.202     37.474     17.826
;   23:48:51.8305-23:48:51.8700     80.437     57.614     77.655
;   23:48:51.9985-23:48:52.0465     79.789     23.719     31.423
;   23:48:52.1255-23:48:52.2140     89.433     44.786     29.600
;   23:48:52.2140-23:48:52.2828     33.204     68.006     77.246
;   23:48:52.4204-23:48:52.5100     40.105     78.705     76.796
;   23:48:52.5745-23:48:52.6188     57.262     82.182     74.257
;   23:48:52.6193-23:48:52.6700     86.904     33.445     20.000
;   23:48:52.6705-23:48:52.7137     30.690     77.812     79.697

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_03_30_6
PRINT,FORMAT=tkbf,theta_kn0924_03_30_6
PRINT,FORMAT=tkbf,theta_kv0924_03_30_6

theta_kb0924_03_30_6 = [51.20,80.44,79.79,89.43,33.20,40.11,57.26,86.90,30.69]
theta_kn0924_03_30_6 = [37.47,57.61,23.72,44.79,68.01,78.70,82.18,33.45,77.81]
theta_kv0924_03_30_6 = [17.83,77.66,31.42,29.60,77.25,76.80,74.26,20.00,79.70]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24

;-----------------------------------------------------------------------------------------
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:48:51.622 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 201-279
;Plot Range: 23:48:51.7292-23:48:51.7708
;The angle between DC-Field and the k-vector is :
;       28.292 +/- 0.864 degrees
;The eigenvalues ratios are:
;       59.084627       2.2420611
;The Minimum Variance eigenvector is:
;< 0.97591,-0.10233, 0.19267> +/- <-0.00339,-0.06126,-0.01535>
;
;Plot Index Range: 336-470
;Plot Range: 23:48:51.8012-23:48:51.8727
;The angle between DC-Field and the k-vector is :
;       43.559 +/- 1.748 degrees
;The eigenvalues ratios are:
;       9.9766346       2.5831514
;The Minimum Variance eigenvector is:
;<-0.67404,-0.03938, 0.73764> +/- < 0.07247,-0.09819, 0.06098>
;
;Plot Index Range: 336-408
;Plot Range: 23:48:51.8012-23:48:51.8396
;The angle between DC-Field and the k-vector is :
;       69.630 +/- 1.070 degrees
;The eigenvalues ratios are:
;       42.325833       4.2162804
;The Minimum Variance eigenvector is:
;<-0.26654, 0.19362, 0.94417> +/- <-0.03484,-0.06153, 0.00278>
;
;Plot Index Range: 408-470
;Plot Range: 23:48:51.8396-23:48:51.8727
;The angle between DC-Field and the k-vector is :
;       80.304 +/- 1.409 degrees
;The eigenvalues ratios are:
;       29.079338       1.8947801
;The Minimum Variance eigenvector is:
;<-0.87608,-0.10477, 0.47065> +/- <-0.03581,-0.04972,-0.07772>
;
;Plot Index Range: 519-666
;Plot Range: 23:48:51.8988-23:48:51.9772
;The angle between DC-Field and the k-vector is :
;       65.443 +/- 0.488 degrees
;The eigenvalues ratios are:
;       96.270569       11.498885
;The Minimum Variance eigenvector is:
;<-0.94313, 0.31190, 0.11497> +/- < 0.00368, 0.02184,-0.02905>
;
;Plot Index Range: 703-797
;Plot Range: 23:48:51.9969-23:48:52.0471
;The angle between DC-Field and the k-vector is :
;       52.661 +/- 0.822 degrees
;The eigenvalues ratios are:
;       54.253045       5.6325929
;The Minimum Variance eigenvector is:
;< 0.81531, 0.00362, 0.57902> +/- < 0.02593,-0.03530,-0.03629>
;
;Plot Index Range: 703-785
;Plot Range: 23:48:51.9969-23:48:52.0407
;The angle between DC-Field and the k-vector is :
;       54.381 +/- 0.519 degrees
;The eigenvalues ratios are:
;       152.72944       6.1228892
;The Minimum Variance eigenvector is:
;< 0.78947, 0.03079, 0.61301> +/- < 0.01651,-0.02295,-0.02011>
;
;Plot Index Range: 919-981
;Plot Range: 23:48:52.1121-23:48:52.1452
;The angle between DC-Field and the k-vector is :
;       63.218 +/- 0.669 degrees
;The eigenvalues ratios are:
;       122.13862       16.406894
;The Minimum Variance eigenvector is:
;<-0.91682, 0.39446, 0.06195> +/- < 0.00574, 0.01877,-0.03464>
;
;Plot Index Range: 1014-1080
;Plot Range: 23:48:52.1628-23:48:52.1980
;The angle between DC-Field and the k-vector is :
;       21.507 +/- 1.305 degrees
;The eigenvalues ratios are:
;       31.633553       16.152013
;The Minimum Variance eigenvector is:
;<-0.08897, 0.05393, 0.99457> +/- <-0.07734, 0.00607,-0.00725>
;
;Plot Index Range: 1160-1245
;Plot Range: 23:48:52.2407-23:48:52.2860
;The angle between DC-Field and the k-vector is :
;       78.306 +/- 0.840 degrees
;The eigenvalues ratios are:
;       57.354470       11.282906
;The Minimum Variance eigenvector is:
;<-0.53149, 0.42313,-0.73381> +/- <-0.03690, 0.01689, 0.03647>
;
;Plot Index Range: 1795-1845
;Plot Range: 23:48:52.5793-23:48:52.6060
;The angle between DC-Field and the k-vector is :
;       29.517 +/- 0.790 degrees
;The eigenvalues ratios are:
;       109.46513       2.4674859
;The Minimum Variance eigenvector is:
;< 0.52519, 0.56150,-0.63945> +/- <-0.04312, 0.01245,-0.02448>
;
;Plot Index Range: 1918-1990
;Plot Range: 23:48:52.6449-23:48:52.6833
;The angle between DC-Field and the k-vector is :
;       56.019 +/- 0.887 degrees
;The eigenvalues ratios are:
;       60.743539       4.9412592
;The Minimum Variance eigenvector is:
;<-0.85805, 0.40195, 0.31967> +/- < 0.00022, 0.03642,-0.04521>
;

prefd   = '1998-09-24/'
tr0     = time_double([prefd[0]+'23:48:51.7292',prefd[0]+'23:48:51.7708'])
tr1     = time_double([prefd[0]+'23:48:51.8012',prefd[0]+'23:48:51.8396'])
tr2     = time_double([prefd[0]+'23:48:51.8396',prefd[0]+'23:48:51.8727'])
tr3     = time_double([prefd[0]+'23:48:51.8988',prefd[0]+'23:48:51.9772'])
tr4     = time_double([prefd[0]+'23:48:51.9969',prefd[0]+'23:48:52.0407'])
tr5     = time_double([prefd[0]+'23:48:52.1121',prefd[0]+'23:48:52.1452'])
tr6     = time_double([prefd[0]+'23:48:52.1628',prefd[0]+'23:48:52.1980'])
tr7     = time_double([prefd[0]+'23:48:52.2407',prefd[0]+'23:48:52.2860'])
tr8     = time_double([prefd[0]+'23:48:52.5793',prefd[0]+'23:48:52.6060'])
tr9     = time_double([prefd[0]+'23:48:52.6449',prefd[0]+'23:48:52.6833'])

kvec0   = [ 0.97591,-0.10233, 0.19267]
kvec1   = [-0.26654, 0.19362, 0.94417]
kvec2   = [-0.87608,-0.10477, 0.47065]
kvec3   = [-0.94313, 0.31190, 0.11497]
kvec4   = [ 0.78947, 0.03079, 0.61301]
kvec5   = [-0.91682, 0.39446, 0.06195]
kvec6   = [-0.08897, 0.05393, 0.99457]
kvec7   = [-0.53149, 0.42313,-0.73381]
kvec8   = [ 0.52519, 0.56150,-0.63945]
kvec9   = [-0.85805, 0.40195, 0.31967]

dkvec0  = ABS([-0.00339,-0.06126,-0.01535])
dkvec1  = ABS([-0.03484,-0.06153, 0.00278])
dkvec2  = ABS([-0.03581,-0.04972,-0.07772])
dkvec3  = ABS([ 0.00368, 0.02184,-0.02905])
dkvec4  = ABS([ 0.01651,-0.02295,-0.02011])
dkvec5  = ABS([ 0.00574, 0.01877,-0.03464])
dkvec6  = ABS([-0.07734, 0.00607,-0.00725])
dkvec7  = ABS([-0.03690, 0.01689, 0.03647])
dkvec8  = ABS([-0.04312, 0.01245,-0.02448])
dkvec9  = ABS([ 0.00022, 0.03642,-0.04521])

elam0   = [59.084627,2.2420611]
elam1   = [42.325833,4.2162804]
elam2   = [29.079338,1.8947801]
elam3   = [96.270569,11.498885]
elam4   = [152.72944,6.1228892]
elam5   = [122.13862,16.406894]
elam6   = [31.633553,16.152013]
elam7   = [57.354470,11.282906]
elam8   = [109.46513,2.4674859]
elam9   = [60.743539,4.9412592]

bvec0   = [-0.44005,-0.05247, 0.89644]
bvec1   = [-0.43961,-0.06764, 0.89563]
bvec2   = [-0.43918,-0.07548, 0.89522]
bvec3   = [-0.43586,-0.07279, 0.89707]
bvec4   = [-0.43938,-0.08250, 0.89450]
bvec5   = [-0.43742,-0.07189, 0.89638]
bvec6   = [-0.43009,-0.06838, 0.90019]
bvec7   = [-0.42618,-0.08185, 0.90091]
bvec8   = [-0.42812,-0.07656, 0.90047]
bvec9   = [-0.42372,-0.08535, 0.90176]
bmag0   = [35.99711]
bmag1   = [36.13456]
bmag2   = [36.23442]
bmag3   = [36.29160]
bmag4   = [36.40070]
bmag5   = [36.87651]
bmag6   = [36.80124]
bmag7   = [36.72199]
bmag8   = [36.76735]
bmag9   = [36.81766]

tags    = ['t0','t1','t2','t3','t4','t5','t6','t7','t8','t9']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,$
                        kvec9)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,$
                        dkvec8,dkvec9)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:48:51.622 UT
;
;   23:48:51.7292-23:48:51.7708      0.976     -0.102      0.193     -0.440     -0.052      0.896     35.997
;   23:48:51.8012-23:48:51.8396     -0.267      0.194      0.944     -0.440     -0.068      0.896     36.135
;   23:48:51.8396-23:48:51.8727     -0.876     -0.105      0.471     -0.439     -0.075      0.895     36.234
;   23:48:51.8988-23:48:51.9772     -0.943      0.312      0.115     -0.436     -0.073      0.897     36.292
;   23:48:51.9969-23:48:52.0407      0.789      0.031      0.613     -0.439     -0.082      0.895     36.401
;   23:48:52.1121-23:48:52.1452     -0.917      0.394      0.062     -0.437     -0.072      0.896     36.877
;   23:48:52.1628-23:48:52.1980     -0.089      0.054      0.995     -0.430     -0.068      0.900     36.801
;   23:48:52.2407-23:48:52.2860     -0.531      0.423     -0.734     -0.426     -0.082      0.901     36.722
;   23:48:52.5793-23:48:52.6060      0.525      0.562     -0.639     -0.428     -0.077      0.900     36.767
;   23:48:52.6449-23:48:52.6833     -0.858      0.402      0.320     -0.424     -0.085      0.902     36.818

vswu   = [-686.423,92.322,-53.727]         ; => My 3DP estimates (km/s) For 1998-09-24/23:48:51.622 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:48:51.622 UT
;
;   23:48:51.7292-23:48:51.7708    104.558     75.442    159.256     20.744    173.123      6.877
;   23:48:51.8012-23:48:51.8396     18.249    161.751     96.946     83.054     77.521    102.479
;   23:48:51.8396-23:48:51.8727     35.512    144.488     48.448    131.552     35.379    144.621
;   23:48:51.8988-23:48:51.9772     60.561    119.439     41.045    138.955     15.318    164.682
;   23:48:51.9969-23:48:52.0407     78.526    101.474    159.617     20.383    145.427     34.573
;   23:48:52.1121-23:48:52.1452     64.646    115.354     43.108    136.892     17.532    162.468
;   23:48:52.1628-23:48:52.1980     21.584    158.416    105.646     74.354     88.960     91.040
;   23:48:52.2407-23:48:52.2860    117.983     62.017     49.990    130.010     50.346    129.654
;   23:48:52.5793-23:48:52.6060    147.527     32.473    112.675     67.325    113.258     66.742
;   23:48:52.6449-23:48:52.6833     51.864    128.136     54.068    125.932     28.772    151.228

theta_kb0924_06_30_3   = DBLARR(nn)
theta_kn0924_06_30_3   = DBLARR(nn)
theta_kv0924_06_30_3   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_06_30_3[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_06_30_3[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_06_30_3[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_06_30_3[j]),  $
                     REFORM(theta_kn0924_06_30_3[j]),$
                     REFORM(theta_kv0924_06_30_3[j])
;
; => For  6 Hz < f < 30 Hz  at  1998-09-24/23:48:51.622 UT
;
;   23:48:51.7292-23:48:51.7708     75.442     20.744      6.877
;   23:48:51.8012-23:48:51.8396     18.249     83.054     77.521
;   23:48:51.8396-23:48:51.8727     35.512     48.448     35.379
;   23:48:51.8988-23:48:51.9772     60.561     41.045     15.318
;   23:48:51.9969-23:48:52.0407     78.526     20.383     34.573
;   23:48:52.1121-23:48:52.1452     64.646     43.108     17.532
;   23:48:52.1628-23:48:52.1980     21.584     74.354     88.960
;   23:48:52.2407-23:48:52.2860     62.017     49.990     50.346
;   23:48:52.5793-23:48:52.6060     32.473     67.325     66.742
;   23:48:52.6449-23:48:52.6833     51.864     54.068     28.772

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_06_30_3
PRINT,FORMAT=tkbf,theta_kn0924_06_30_3
PRINT,FORMAT=tkbf,theta_kv0924_06_30_3

theta_kb0924_06_30_3 = [75.44,18.25,35.51,60.56,78.53,64.65,21.58,62.02,32.47,51.86]
theta_kn0924_06_30_3 = [20.74,83.05,48.45,41.04,20.38,43.11,74.35,49.99,67.33,54.07]
theta_kv0924_06_30_3 = [ 6.88,77.52,35.38,15.32,34.57,17.53,88.96,50.35,66.74,28.77]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 11L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0       5.0       7.0
print, hfc0, format='(";",8f10.1)'
;      30.0      50.0      50.0

date = '092598'
vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi,STATS=stats_092498_0004x04_3_30

vector_mv_plot,DATE=date,MYMAG=dummy2,FCUTOFF=[lfc0[2],hfc0[2]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi,STATS=stats_092498_0004x04_7_50

;-----------------------------------------------------------------------------------------
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:04:04.545 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 237-381
;Plot Range: 00:04:04.6714-00:04:04.7482
;The angle between DC-Field and the k-vector is :
;       28.823 +/- 0.733 degrees
;The eigenvalues ratios are:
;       44.674902       7.6483467
;The Minimum Variance eigenvector is:
;<-0.07775,-0.78702,-0.61201> +/- < 0.03346,-0.02902, 0.03307>
;
;Plot Index Range: 666-795
;Plot Range: 00:04:04.9002-00:04:04.9690
;The angle between DC-Field and the k-vector is :
;       73.991 +/- 0.845 degrees
;The eigenvalues ratios are:
;       37.916871       3.0856684
;The Minimum Variance eigenvector is:
;<-0.97773,-0.06902, 0.19821> +/- < 0.00898,-0.06221, 0.02264>
;
;Plot Index Range: 951-1032
;Plot Range: 00:04:05.0522-00:04:05.0954
;The angle between DC-Field and the k-vector is :
;       88.612 +/- 0.743 degrees
;The eigenvalues ratios are:
;       76.347417       29.751994
;The Minimum Variance eigenvector is:
;<-0.89497,-0.19178,-0.40280> +/- < 0.01334, 0.02072,-0.03951>
;
;Plot Index Range: 1356-1515
;Plot Range: 00:04:05.2682-00:04:05.3530
;The angle between DC-Field and the k-vector is :
;       88.926 +/- 0.656 degrees
;The eigenvalues ratios are:
;       50.196517       1.4617938
;The Minimum Variance eigenvector is:
;< 0.84838, 0.24190, 0.47090> +/- < 0.01180, 0.04280,-0.04325>
;
;Plot Index Range: 1356-1473
;Plot Range: 00:04:05.2682-00:04:05.3306
;The angle between DC-Field and the k-vector is :
;       84.313 +/- 0.809 degrees
;The eigenvalues ratios are:
;       45.187875       2.9499405
;The Minimum Variance eigenvector is:
;< 0.83176, 0.31891, 0.45439> +/- <-0.03089, 0.05071, 0.02095>
;
;Plot Index Range: 1474-1578
;Plot Range: 00:04:05.3311-00:04:05.3866
;The angle between DC-Field and the k-vector is :
;       87.893 +/- 0.635 degrees
;The eigenvalues ratios are:
;       80.999390       4.7278766
;The Minimum Variance eigenvector is:
;< 0.99316, 0.10809,-0.04425> +/- < 0.00355,-0.04096,-0.02041>
;
;Plot Index Range: 1702-1809
;Plot Range: 00:04:05.4527-00:04:05.5098
;The angle between DC-Field and the k-vector is :
;       84.374 +/- 0.138 degrees
;The eigenvalues ratios are:
;       1636.1879       4.0595368
;The Minimum Variance eigenvector is:
;< 0.93980, 0.28381, 0.19032> +/- < 0.00258,-0.00974, 0.00179>
;

struct0 = stats_092498_0004x04_3_30
nplots  = N_TAGS(struct0)
tr_ss   = STRARR(nplots)
kv_ss   = STRARR(nplots)
dkv_ss  = STRARR(nplots)
eig_ss  = STRARR(nplots)
pr_str  = ',prefd[0]+'
tr_pre  = '     = time_double([prefd[0]+'
dv_0s   = '])'
kv_0s   = ']'

FOR j=0L, nplots - 1L DO BEGIN                                            $
  tr_0p = 'tr'+STRTRIM(j,2L)                                            & $
  tr_00 = time_string(struct0.(j).TRANGE,PREC=4)                        & $
  tr_01 = STRMID(tr_00[*],11L)                                          & $
  test  = tr_0p[0]+tr_pre[0]+"'"+tr_01[0]+"'"+pr_str[0]+"'"+tr_01[1]+"'"+dv_0s[0]  & $
  tr_ss[j] = test[0]

kvform = '(f8.5,",",f8.5,",",f8.5)'
FOR j=0L, nplots - 1L DO BEGIN                                            $
  kv_0p = 'kvec'+STRTRIM(j,2L)+'   = ['                                 & $
  kv_00 = struct0.(j).MVA.EIGENVECTORS[*,0]                             & $
  kv_01 = STRING(FORMAT=kvform,kv_00)                                   & $
  test  = kv_0p[0]+kv_01+kv_0s[0]                                       & $
  kv_ss[j] = test[0]

FOR j=0L, nplots - 1L DO BEGIN                                            $
  dv_0p = 'dkvec'+STRTRIM(j,2L)+'  = ABS(['                             & $
  dv_00 = struct0.(j).MVA.DMIN_VEC                                      & $
  dv_01 = STRING(FORMAT=kvform,kv_00)                                   & $
  test  = dv_0p[0]+dv_01+dv_0s[0]                                       & $
  dkv_ss[j] = test[0]

eform = '(g,",",g)'
FOR j=0L, nplots - 1L DO BEGIN                                            $
  eg_0p = 'elam'+STRTRIM(j,2L)+'   = ['                                 & $
  eg_mx = struct0.(j).MVA.EIGENVALUES[0]                                & $
  eg_md = struct0.(j).MVA.EIGENVALUES[1]                                & $
  eg_mn = struct0.(j).MVA.EIGENVALUES[2]                                & $
  er_00 = FLOAT([eg_md/eg_mn,eg_mx/eg_md])                              & $
  er_01 = STRCOMPRESS(STRING(FORMAT=eform,er_00),/REMOVE_ALL)           & $
  test  = eg_0p[0]+er_01+kv_0s[0]                                       & $
  eig_ss[j] = test[0]


PRINT, TRANSPOSE(tr_ss)
PRINT, TRANSPOSE(kv_ss)
PRINT, TRANSPOSE(dkv_ss)
PRINT, TRANSPOSE(eig_ss)

prefd   = '1998-09-25/'
tr0     = time_double([prefd[0]+'00:04:04.6714',prefd[0]+'00:04:04.7482'])
tr1     = time_double([prefd[0]+'00:04:04.9002',prefd[0]+'00:04:04.9690'])
tr2     = time_double([prefd[0]+'00:04:05.0522',prefd[0]+'00:04:05.0954'])
tr3     = time_double([prefd[0]+'00:04:05.2682',prefd[0]+'00:04:05.3530'])
tr4     = time_double([prefd[0]+'00:04:05.3311',prefd[0]+'00:04:05.3866'])
tr5     = time_double([prefd[0]+'00:04:05.4527',prefd[0]+'00:04:05.5098'])

kvec0   = [-0.07775,-0.78702,-0.61201]
kvec1   = [-0.97773,-0.06902, 0.19821]
kvec2   = [-0.89497,-0.19178,-0.40280]
kvec3   = [ 0.84838, 0.24190, 0.47090]
kvec4   = [ 0.99316, 0.10809,-0.04425]
kvec5   = [ 0.93980, 0.28381, 0.19032]

dkvec0  = ABS([ 0.93980, 0.28381, 0.19032])
dkvec1  = ABS([ 0.93980, 0.28381, 0.19032])
dkvec2  = ABS([ 0.93980, 0.28381, 0.19032])
dkvec3  = ABS([ 0.93980, 0.28381, 0.19032])
dkvec4  = ABS([ 0.93980, 0.28381, 0.19032])
dkvec5  = ABS([ 0.93980, 0.28381, 0.19032])

elam0   = [44.67490,7.648347]
elam1   = [37.91687,3.085668]
elam2   = [76.34742,29.75200]
elam3   = [50.19652,1.461794]
elam4   = [80.99939,4.727877]
elam5   = [1636.188,4.059537]

bvec0   = [-0.10802, 0.97756,-0.18084]
bvec1   = [-0.14572, 0.97975,-0.13716]
bvec2   = [-0.17636, 0.97927,-0.09965]
bvec3   = [-0.18466, 0.97561,-0.11852]
bvec4   = [-0.19465, 0.97332,-0.12142]
bvec5   = [-0.20073, 0.96818,-0.14933]
bmag0   = [23.77359]
bmag1   = [23.31873]
bmag2   = [23.31872]
bmag3   = [23.24363]
bmag4   = [23.18337]
bmag5   = [23.18519]

tags    = ['t0','t1','t2','t3','t4','t5']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:04:04.545 UT
;
;   00:04:04.6714-00:04:04.7482     -0.078     -0.787     -0.612     -0.108      0.978     -0.181     23.774
;   00:04:04.9002-00:04:04.9690     -0.978     -0.069      0.198     -0.146      0.980     -0.137     23.319
;   00:04:05.0522-00:04:05.0954     -0.895     -0.192     -0.403     -0.176      0.979     -0.100     23.319
;   00:04:05.2682-00:04:05.3530      0.848      0.242      0.471     -0.185      0.976     -0.119     23.244
;   00:04:05.3311-00:04:05.3866      0.993      0.108     -0.044     -0.195      0.973     -0.121     23.183
;   00:04:05.4527-00:04:05.5098      0.940      0.284      0.190     -0.201      0.968     -0.149     23.185

vswu   = [-703.974,-39.131,-29.547]         ; => My 3DP estimates (km/s) For 1998-09-25/00:04:04.545 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:04:04.545 UT
;
;   00:04:04.6714-00:04:04.7482    130.563     49.437     63.070    116.930     81.557     98.443
;   00:04:04.9002-00:04:04.9690     87.268     92.732     32.729    147.271     13.857    166.143
;   00:04:05.0522-00:04:05.0954     89.417     90.583      4.012    175.988     23.029    156.971
;   00:04:05.2682-00:04:05.3530     88.652     91.348    171.577      8.423    151.577     28.423
;   00:04:05.3311-00:04:05.3866     94.746     85.254    156.411     23.589    174.211      5.789
;   00:04:05.4527-00:04:05.5098     86.692     93.308    170.510      9.490    163.994     16.006

theta_kb0924_03_30_7   = DBLARR(nn)
theta_kn0924_03_30_7   = DBLARR(nn)
theta_kv0924_03_30_7   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_03_30_7[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_03_30_7[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_03_30_7[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_03_30_7[j]),  $
                     REFORM(theta_kn0924_03_30_7[j]),$
                     REFORM(theta_kv0924_03_30_7[j])
;
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:04:04.545 UT
;
;   00:04:04.6714-00:04:04.7482     49.437     63.070     81.557
;   00:04:04.9002-00:04:04.9690     87.268     32.729     13.857
;   00:04:05.0522-00:04:05.0954     89.417      4.012     23.029
;   00:04:05.2682-00:04:05.3530     88.652      8.423     28.423
;   00:04:05.3311-00:04:05.3866     85.254     23.589      5.789
;   00:04:05.4527-00:04:05.5098     86.692      9.490     16.006

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_03_30_7
PRINT,FORMAT=tkbf,theta_kn0924_03_30_7
PRINT,FORMAT=tkbf,theta_kv0924_03_30_7

theta_kb0924_03_30_7 = [49.44,87.27,89.42,88.65,85.25,86.69]
theta_kn0924_03_30_7 = [63.07,32.73, 4.01, 8.42,23.59, 9.49]
theta_kv0924_03_30_7 = [81.56,13.86,23.03,28.42, 5.79,16.01]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
; => For  7 Hz < f < 50 Hz  at  1998-09-25/00:04:04.545 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 978-1065
;Plot Range: 00:04:05.0666-00:04:05.1130
;The angle between DC-Field and the k-vector is :
;       81.433 +/- 1.646 degrees
;The eigenvalues ratios are:
;       16.019542       5.4041036
;The Minimum Variance eigenvector is:
;< 0.95221, 0.05256, 0.30090> +/- < 0.03277,-0.03792,-0.09708>
;
;Plot Index Range: 1381-1482
;Plot Range: 00:04:05.2815-00:04:05.3354
;The angle between DC-Field and the k-vector is :
;       88.606 +/- 0.248 degrees
;The eigenvalues ratios are:
;       536.54725       5.0934740
;The Minimum Variance eigenvector is:
;< 0.85275, 0.24633, 0.46058> +/- <-0.00733, 0.01526, 0.00540>
;
;Plot Index Range: 1509-1587
;Plot Range: 00:04:05.3498-00:04:05.3914
;The angle between DC-Field and the k-vector is :
;       65.706 +/- 0.979 degrees
;The eigenvalues ratios are:
;       46.497449       2.6958021
;The Minimum Variance eigenvector is:
;<-0.94919, 0.23615,-0.20804> +/- < 0.01526, 0.06750, 0.00702>
;
;Plot Index Range: 1708-1767
;Plot Range: 00:04:05.4559-00:04:05.4874
;The angle between DC-Field and the k-vector is :
;       74.605 +/- 1.201 degrees
;The eigenvalues ratios are:
;       41.233641       3.8446314
;The Minimum Variance eigenvector is:
;<-0.89935,-0.36793, 0.23623> +/- <-0.03328, 0.05717,-0.03766>
;
;Plot Index Range: 1768-1869
;Plot Range: 00:04:05.4879-00:04:05.5418
;The angle between DC-Field and the k-vector is :
;       68.568 +/- 0.906 degrees
;The eigenvalues ratios are:
;       41.946461       3.2690691
;The Minimum Variance eigenvector is:
;<-0.81977, 0.14215,-0.55476> +/- <-0.03566,-0.03671, 0.04329>
;
;Plot Index Range: 1945-1998
;Plot Range: 00:04:05.5823-00:04:05.6106
;The angle between DC-Field and the k-vector is :
;       86.827 +/- 0.848 degrees
;The eigenvalues ratios are:
;       89.751167       1.7023744
;The Minimum Variance eigenvector is:
;<-0.99147,-0.07696, 0.10516> +/- < 0.00766,-0.04001, 0.04292>
;

struct0 = stats_092498_0004x04_7_50
nplots  = N_TAGS(struct0)
tr_ss   = STRARR(nplots)
kv_ss   = STRARR(nplots)
dkv_ss  = STRARR(nplots)
eig_ss  = STRARR(nplots)
pr_str  = ',prefd[0]+'
tr_pre  = '     = time_double([prefd[0]+'
dv_0s   = '])'
kv_0s   = ']'

FOR j=0L, nplots - 1L DO BEGIN                                            $
  tr_0p = 'tr'+STRTRIM(j,2L)                                            & $
  tr_00 = time_string(struct0.(j).TRANGE,PREC=4)                        & $
  tr_01 = STRMID(tr_00[*],11L)                                          & $
  test  = tr_0p[0]+tr_pre[0]+"'"+tr_01[0]+"'"+pr_str[0]+"'"+tr_01[1]+"'"+dv_0s[0]  & $
  tr_ss[j] = test[0]

kvform = '(f8.5,",",f8.5,",",f8.5)'
FOR j=0L, nplots - 1L DO BEGIN                                            $
  kv_0p = 'kvec'+STRTRIM(j,2L)+'   = ['                                 & $
  kv_00 = struct0.(j).MVA.EIGENVECTORS[*,0]                             & $
  kv_01 = STRING(FORMAT=kvform,kv_00)                                   & $
  test  = kv_0p[0]+kv_01+kv_0s[0]                                       & $
  kv_ss[j] = test[0]

FOR j=0L, nplots - 1L DO BEGIN                                            $
  dv_0p = 'dkvec'+STRTRIM(j,2L)+'  = ABS(['                             & $
  dv_00 = struct0.(j).MVA.DMIN_VEC                                      & $
  dv_01 = STRING(FORMAT=kvform,kv_00)                                   & $
  test  = dv_0p[0]+dv_01+dv_0s[0]                                       & $
  dkv_ss[j] = test[0]

eform = '(g,",",g)'
FOR j=0L, nplots - 1L DO BEGIN                                            $
  eg_0p = 'elam'+STRTRIM(j,2L)+'   = ['                                 & $
  eg_mx = struct0.(j).MVA.EIGENVALUES[0]                                & $
  eg_md = struct0.(j).MVA.EIGENVALUES[1]                                & $
  eg_mn = struct0.(j).MVA.EIGENVALUES[2]                                & $
  er_00 = FLOAT([eg_md/eg_mn,eg_mx/eg_md])                              & $
  er_01 = STRCOMPRESS(STRING(FORMAT=eform,er_00),/REMOVE_ALL)           & $
  test  = eg_0p[0]+er_01+kv_0s[0]                                       & $
  eig_ss[j] = test[0]


PRINT, TRANSPOSE(tr_ss)
PRINT, TRANSPOSE(kv_ss)
PRINT, TRANSPOSE(dkv_ss)
PRINT, TRANSPOSE(eig_ss)


prefd   = '1998-09-25/'
tr0     = time_double([prefd[0]+'00:04:05.0666',prefd[0]+'00:04:05.1130'])
tr1     = time_double([prefd[0]+'00:04:05.2815',prefd[0]+'00:04:05.3354'])
tr2     = time_double([prefd[0]+'00:04:05.3498',prefd[0]+'00:04:05.3914'])
tr3     = time_double([prefd[0]+'00:04:05.4559',prefd[0]+'00:04:05.4874'])
tr4     = time_double([prefd[0]+'00:04:05.4879',prefd[0]+'00:04:05.5418'])
tr5     = time_double([prefd[0]+'00:04:05.5823',prefd[0]+'00:04:05.6106'])

kvec0   = [ 0.95221, 0.05256, 0.30090]
kvec1   = [ 0.85275, 0.24633, 0.46058]
kvec2   = [-0.94919, 0.23615,-0.20804]
kvec3   = [-0.89935,-0.36793, 0.23623]
kvec4   = [-0.81977, 0.14215,-0.55476]
kvec5   = [-0.99147,-0.07696, 0.10516]

dkvec0  = ABS([-0.99147,-0.07696, 0.10516])
dkvec1  = ABS([-0.99147,-0.07696, 0.10516])
dkvec2  = ABS([-0.99147,-0.07696, 0.10516])
dkvec3  = ABS([-0.99147,-0.07696, 0.10516])
dkvec4  = ABS([-0.99147,-0.07696, 0.10516])
dkvec5  = ABS([-0.99147,-0.07696, 0.10516])

elam0   = [16.01954,5.404104]
elam1   = [536.5472,5.093474]
elam2   = [46.49745,2.695802]
elam3   = [41.23364,3.844631]
elam4   = [41.94646,3.269069]
elam5   = [89.75117,1.702374]

bvec0   = [-0.17864, 0.97896,-0.09857]
bvec1   = [-0.18435, 0.97576,-0.11787]
bvec2   = [-0.19663, 0.97269,-0.12332]
bvec3   = [-0.20134, 0.96850,-0.14653]
bvec4   = [-0.19905, 0.96719,-0.15781]
bvec5   = [-0.19773, 0.96529,-0.17061]
bmag0   = [23.41982]
bmag1   = [23.23606]
bmag2   = [23.19373]
bmag3   = [23.19260]
bmag4   = [23.16525]
bmag5   = [23.15012]

tags    = ['t0','t1','t2','t3','t4','t5']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  7 Hz < f < 50 Hz  at  1998-09-25/00:04:04.545 UT
;
;   00:04:05.0666-00:04:05.1130      0.952      0.053      0.301     -0.179      0.979     -0.099     23.420
;   00:04:05.2815-00:04:05.3354      0.853      0.246      0.461     -0.184      0.976     -0.118     23.236
;   00:04:05.3498-00:04:05.3914     -0.949      0.236     -0.208     -0.197      0.973     -0.123     23.194
;   00:04:05.4559-00:04:05.4874     -0.899     -0.368      0.236     -0.201      0.968     -0.147     23.193
;   00:04:05.4879-00:04:05.5418     -0.820      0.142     -0.555     -0.199      0.967     -0.158     23.165
;   00:04:05.5823-00:04:05.6106     -0.991     -0.077      0.105     -0.198      0.965     -0.171     23.150

vswu   = [-703.974,-39.131,-29.547]         ; => My 3DP estimates (km/s) For 1998-09-25/00:04:04.545 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  7 Hz < f < 50 Hz  at  1998-09-25/00:04:04.545 UT
;
;   00:04:05.0666-00:04:05.1130     98.529     81.471    169.896     10.104    164.889     15.111
;   00:04:05.2815-00:04:05.3354     88.346     91.654    172.165      7.835    152.084     27.916
;   00:04:05.3498-00:04:05.3914     63.769    116.231     27.557    152.443     19.522    160.478
;   00:04:05.4559-00:04:05.4874    102.115     77.885     34.675    145.325     24.812    155.188
;   00:04:05.4879-00:04:05.5418     67.157    112.843     24.883    155.117     33.578    146.422
;   00:04:05.5823-00:04:05.6106     84.041     95.959     27.467    152.533      8.530    171.470

theta_kb0924_07_50   = DBLARR(nn)
theta_kn0924_07_50   = DBLARR(nn)
theta_kv0924_07_50   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_07_50[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_07_50[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_07_50[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_07_50[j]),  $
                     REFORM(theta_kn0924_07_50[j]),$
                     REFORM(theta_kv0924_07_50[j])
;
; => For  7 Hz < f < 50 Hz  at  1998-09-25/00:04:04.545 UT
;
;   00:04:05.0666-00:04:05.1130     81.471     10.104     15.111
;   00:04:05.2815-00:04:05.3354     88.346      7.835     27.916
;   00:04:05.3498-00:04:05.3914     63.769     27.557     19.522
;   00:04:05.4559-00:04:05.4874     77.885     34.675     24.812
;   00:04:05.4879-00:04:05.5418     67.157     24.883     33.578
;   00:04:05.5823-00:04:05.6106     84.041     27.467      8.530

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_07_50
PRINT,FORMAT=tkbf,theta_kn0924_07_50
PRINT,FORMAT=tkbf,theta_kv0924_07_50

theta_kb0924_07_50 = [81.47,88.35,63.77,77.88,67.16,84.04]
theta_kn0924_07_50 = [10.10, 7.84,27.56,34.67,24.88,27.47]
theta_kv0924_07_50 = [15.11,27.92,19.52,24.81,33.58, 8.53]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 12L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0       5.0      40.0
print, hfc0, format='(";",8f10.1)'
;      30.0      50.0     200.0

date = '092598'
vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi,STATS=stats_092498_0005x23_3_30

vector_mv_plot,DATE=date,MYMAG=dummy1,FCUTOFF=[lfc0[1],hfc0[1]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi,STATS=stats_092498_0005x23_5_50

vector_mv_plot,DATE=date,MYMAG=dummy2,FCUTOFF=[lfc0[2],hfc0[2]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi,STATS=stats_092498_0005x23_40_200

;-----------------------------------------------------------------------------------------
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:05:23.432 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 132-381
;Plot Range: 00:05:23.5024-00:05:23.6352
;The angle between DC-Field and the k-vector is :
;       62.826 +/- 0.709 degrees
;The eigenvalues ratios are:
;       28.308674       2.7402802
;The Minimum Variance eigenvector is:
;<-0.11640, 0.21932, 0.96869> +/- < 0.01395,-0.06333, 0.01601>
;
;Plot Index Range: 690-846
;Plot Range: 00:05:23.8000-00:05:23.8832
;The angle between DC-Field and the k-vector is :
;       84.523 +/- 0.663 degrees
;The eigenvalues ratios are:
;       50.155744       10.980321
;The Minimum Variance eigenvector is:
;< 0.52467, 0.55136,-0.64863> +/- <-0.04002, 0.02934,-0.00742>
;
;Plot Index Range: 846-1070
;Plot Range: 00:05:23.8832-00:05:24.0027
;The angle between DC-Field and the k-vector is :
;       78.324 +/- 0.561 degrees
;The eigenvalues ratios are:
;       48.826378       3.6732045
;The Minimum Variance eigenvector is:
;<-0.75587,-0.64998, 0.07862> +/- <-0.03092, 0.03342,-0.02093>
;
;Plot Index Range: 1149-1296
;Plot Range: 00:05:24.0448-00:05:24.1232
;The angle between DC-Field and the k-vector is :
;       48.464 +/- 0.640 degrees
;The eigenvalues ratios are:
;       56.842111       12.162736
;The Minimum Variance eigenvector is:
;< 0.33095, 0.94358,-0.01133> +/- < 0.04444,-0.01550, 0.00712>
;
;Plot Index Range: 1558-1716
;Plot Range: 00:05:24.2629-00:05:24.3472
;The angle between DC-Field and the k-vector is :
;       71.113 +/- 1.189 degrees
;The eigenvalues ratios are:
;       16.727663       3.6567964
;The Minimum Variance eigenvector is:
;<-0.90514,-0.19579, 0.37735> +/- < 0.03687,-0.07086, 0.05168>
;
;Plot Index Range: 1716-1911
;Plot Range: 00:05:24.3472-00:05:24.4512
;The angle between DC-Field and the k-vector is :
;       18.140 +/- 1.074 degrees
;The eigenvalues ratios are:
;       16.609494       1.8633531
;The Minimum Variance eigenvector is:
;<-0.67826, 0.66451, 0.31368> +/- < 0.06966, 0.07101, 0.00018>
;

struct0 = stats_092498_0005x23_3_30
nplots  = N_TAGS(struct0)
tr_ss   = STRARR(nplots)
kv_ss   = STRARR(nplots)
dkv_ss  = STRARR(nplots)
eig_ss  = STRARR(nplots)
pr_str  = ',prefd[0]+'
tr_pre  = '     = time_double([prefd[0]+'
dv_0s   = '])'
kv_0s   = ']'

FOR j=0L, nplots - 1L DO BEGIN                                            $
  tr_0p = 'tr'+STRTRIM(j,2L)                                            & $
  tr_00 = time_string(struct0.(j).TRANGE,PREC=4)                        & $
  tr_01 = STRMID(tr_00[*],11L)                                          & $
  test  = tr_0p[0]+tr_pre[0]+"'"+tr_01[0]+"'"+pr_str[0]+"'"+tr_01[1]+"'"+dv_0s[0]  & $
  tr_ss[j] = test[0]

kvform = '(f8.5,",",f8.5,",",f8.5)'
FOR j=0L, nplots - 1L DO BEGIN                                            $
  kv_0p = 'kvec'+STRTRIM(j,2L)+'   = ['                                 & $
  kv_00 = struct0.(j).MVA.EIGENVECTORS[*,0]                             & $
  kv_01 = STRING(FORMAT=kvform,kv_00)                                   & $
  test  = kv_0p[0]+kv_01+kv_0s[0]                                       & $
  kv_ss[j] = test[0]

FOR j=0L, nplots - 1L DO BEGIN                                            $
  dv_0p = 'dkvec'+STRTRIM(j,2L)+'  = ABS(['                             & $
  dv_00 = struct0.(j).MVA.DMIN_VEC                                      & $
  dv_01 = STRING(FORMAT=kvform,kv_00)                                   & $
  test  = dv_0p[0]+dv_01+dv_0s[0]                                       & $
  dkv_ss[j] = test[0]

eform = '(g,",",g)'
FOR j=0L, nplots - 1L DO BEGIN                                            $
  eg_0p = 'elam'+STRTRIM(j,2L)+'   = ['                                 & $
  eg_mx = struct0.(j).MVA.EIGENVALUES[0]                                & $
  eg_md = struct0.(j).MVA.EIGENVALUES[1]                                & $
  eg_mn = struct0.(j).MVA.EIGENVALUES[2]                                & $
  er_00 = FLOAT([eg_md/eg_mn,eg_mx/eg_md])                              & $
  er_01 = STRCOMPRESS(STRING(FORMAT=eform,er_00),/REMOVE_ALL)           & $
  test  = eg_0p[0]+er_01+kv_0s[0]                                       & $
  eig_ss[j] = test[0]


PRINT, TRANSPOSE(tr_ss)
PRINT, TRANSPOSE(kv_ss)
PRINT, TRANSPOSE(dkv_ss)
PRINT, TRANSPOSE(eig_ss)

prefd   = '1998-09-25/'
tr0     = time_double([prefd[0]+'00:05:23.5024',prefd[0]+'00:05:23.6352'])
tr1     = time_double([prefd[0]+'00:05:23.8000',prefd[0]+'00:05:23.8832'])
tr2     = time_double([prefd[0]+'00:05:23.8832',prefd[0]+'00:05:24.0026'])
tr3     = time_double([prefd[0]+'00:05:24.0448',prefd[0]+'00:05:24.1232'])
tr4     = time_double([prefd[0]+'00:05:24.2629',prefd[0]+'00:05:24.3472'])
tr5     = time_double([prefd[0]+'00:05:24.3472',prefd[0]+'00:05:24.4512'])

kvec0   = [-0.11640, 0.21932, 0.96869]
kvec1   = [ 0.52467, 0.55136,-0.64863]
kvec2   = [-0.75587,-0.64998, 0.07862]
kvec3   = [ 0.33095, 0.94358,-0.01133]
kvec4   = [-0.90514,-0.19579, 0.37735]
kvec5   = [-0.67826, 0.66451, 0.31368]

dkvec0  = ABS([-0.67826, 0.66451, 0.31368])
dkvec1  = ABS([-0.67826, 0.66451, 0.31368])
dkvec2  = ABS([-0.67826, 0.66451, 0.31368])
dkvec3  = ABS([-0.67826, 0.66451, 0.31368])
dkvec4  = ABS([-0.67826, 0.66451, 0.31368])
dkvec5  = ABS([-0.67826, 0.66451, 0.31368])

elam0   = [28.30867,2.740280]
elam1   = [50.15574,10.98032]
elam2   = [48.82638,3.673204]
elam3   = [56.84211,12.16274]
elam4   = [16.72766,3.656796]
elam5   = [16.60950,1.863353]

bvec0   = [-0.46626, 0.80732, 0.36156]
bvec1   = [-0.49286, 0.83919, 0.22942]
bvec2   = [-0.47873, 0.85567, 0.19650]
bvec3   = [-0.46905, 0.85942, 0.20335]
bvec4   = [-0.44775, 0.87069, 0.20319]
bvec5   = [-0.44929, 0.88446, 0.11779]
bmag0   = [22.78819]
bmag1   = [24.16436]
bmag2   = [23.88314]
bmag3   = [23.40712]
bmag4   = [24.16453]
bmag5   = [24.03419]

tags    = ['t0','t1','t2','t3','t4','t5']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:05:23.432 UT
;
;   00:05:23.5024-00:05:23.6352     -0.116      0.219      0.969     -0.466      0.807      0.362     22.788
;   00:05:23.8000-00:05:23.8832      0.525      0.551     -0.649     -0.493      0.839      0.229     24.164
;   00:05:23.8832-00:05:24.0026     -0.756     -0.650      0.079     -0.479      0.856      0.196     23.883
;   00:05:24.0448-00:05:24.1232      0.331      0.944     -0.011     -0.469      0.859      0.203     23.407
;   00:05:24.2629-00:05:24.3472     -0.905     -0.196      0.377     -0.448      0.871      0.203     24.165
;   00:05:24.3472-00:05:24.4512     -0.678      0.665      0.314     -0.449      0.884      0.118     24.034

vswu   = [-720.792,7.078,-38.687]         ; => My 3DP estimates (km/s) For 1998-09-25/00:05:23.432 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:05:23.432 UT
;
;   00:05:23.5024-00:05:23.6352     54.439    125.561    105.794     74.206     86.189     93.811
;   00:05:23.8000-00:05:23.8832     86.830     93.170    112.313     67.687    118.929     61.071
;   00:05:23.8832-00:05:24.0026    100.304     79.696     36.191    143.809     41.913    138.087
;   00:05:24.0448-00:05:24.1232     49.202    130.798    120.412     59.588    108.699     71.301
;   00:05:24.2629-00:05:24.3472     71.852    108.148     42.124    137.876     28.158    151.842
;   00:05:24.3472-00:05:24.4512     21.656    158.344     68.483    111.517     48.167    131.833

theta_kb0924_03_30_8   = DBLARR(nn)
theta_kn0924_03_30_8   = DBLARR(nn)
theta_kv0924_03_30_8   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_03_30_8[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_03_30_8[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_03_30_8[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_03_30_8[j]),  $
                     REFORM(theta_kn0924_03_30_8[j]),$
                     REFORM(theta_kv0924_03_30_8[j])
;
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:05:23.432 UT
;
;   00:05:23.5024-00:05:23.6352     54.439     74.206     86.189
;   00:05:23.8000-00:05:23.8832     86.830     67.687     61.071
;   00:05:23.8832-00:05:24.0026     79.696     36.191     41.913
;   00:05:24.0448-00:05:24.1232     49.202     59.588     71.301
;   00:05:24.2629-00:05:24.3472     71.852     42.124     28.158
;   00:05:24.3472-00:05:24.4512     21.656     68.483     48.167

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_03_30_8
PRINT,FORMAT=tkbf,theta_kn0924_03_30_8
PRINT,FORMAT=tkbf,theta_kv0924_03_30_8

theta_kb0924_03_30_8 = [54.44,86.83,79.70,49.20,71.85,21.66]
theta_kn0924_03_30_8 = [74.21,67.69,36.19,59.59,42.12,68.48]
theta_kv0924_03_30_8 = [86.19,61.07,41.91,71.30,28.16,48.17]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
; => For  40 Hz < f < 200 Hz  at  1998-09-25/00:05:23.432 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 51-93
;Plot Range: 00:05:23.4592-00:05:23.4816
;The angle between DC-Field and the k-vector is :
;       88.488 +/- 1.343 degrees
;The eigenvalues ratios are:
;       46.371280       6.0888810
;The Minimum Variance eigenvector is:
;< 0.74360, 0.52564,-0.41324> +/- <-0.04427, 0.06072,-0.00243>
;
;Plot Index Range: 128-158
;Plot Range: 00:05:23.5003-00:05:23.5163
;The angle between DC-Field and the k-vector is :
;       78.059 +/- 1.736 degrees
;The eigenvalues ratios are:
;       39.547784       3.2834053
;The Minimum Variance eigenvector is:
;< 0.86216, 0.31373,-0.39781> +/- <-0.02101, 0.08845, 0.02422>
;
;Plot Index Range: 188-251
;Plot Range: 00:05:23.5323-00:05:23.5659
;The angle between DC-Field and the k-vector is :
;       85.001 +/- 0.883 degrees
;The eigenvalues ratios are:
;       69.869291       3.9498544
;The Minimum Variance eigenvector is:
;<-0.88997,-0.41396, 0.19129> +/- <-0.02571, 0.04937,-0.01277>
;
;Plot Index Range: 339-360
;Plot Range: 00:05:23.6128-00:05:23.6240
;The angle between DC-Field and the k-vector is :
;       59.785 +/- 1.439 degrees
;The eigenvalues ratios are:
;       81.297298       4.2115674
;The Minimum Variance eigenvector is:
;<-0.99821, 0.05975, 0.00121> +/- < 0.00351, 0.05932,-0.03651>
;
;Plot Index Range: 572-627
;Plot Range: 00:05:23.7371-00:05:23.7664
;The angle between DC-Field and the k-vector is :
;       87.903 +/- 2.043 degrees
;The eigenvalues ratios are:
;       16.501743       1.7799022
;The Minimum Variance eigenvector is:
;< 0.83417, 0.46872,-0.29063> +/- <-0.05528, 0.12147, 0.03725>
;
;Plot Index Range: 639-672
;Plot Range: 00:05:23.7728-00:05:23.7904
;The angle between DC-Field and the k-vector is :
;       81.793 +/- 0.733 degrees
;The eigenvalues ratios are:
;       192.69355       1.2092175
;The Minimum Variance eigenvector is:
;<-0.77294,-0.61234, 0.16615> +/- <-0.02241, 0.03517, 0.02535>
;
;Plot Index Range: 729-789
;Plot Range: 00:05:23.8208-00:05:23.8528
;The angle between DC-Field and the k-vector is :
;       81.054 +/- 1.649 degrees
;The eigenvalues ratios are:
;       22.429924       1.8562027
;The Minimum Variance eigenvector is:
;< 0.80826, 0.54728, 0.21726> +/- <-0.06717, 0.08184, 0.04373>
;
;Plot Index Range: 954-1034
;Plot Range: 00:05:23.9408-00:05:23.9835
;The angle between DC-Field and the k-vector is :
;       83.032 +/- 1.010 degrees
;The eigenvalues ratios are:
;       42.683448       3.8542296
;The Minimum Variance eigenvector is:
;<-0.82616,-0.56179,-0.04289> +/- <-0.03671, 0.05544,-0.01921>
;
;Plot Index Range: 1141-1177
;Plot Range: 00:05:24.0405-00:05:24.0597
;The angle between DC-Field and the k-vector is :
;       81.608 +/- 1.754 degrees
;The eigenvalues ratios are:
;       32.473287       1.4812203
;The Minimum Variance eigenvector is:
;<-0.81397,-0.54001,-0.21412> +/- < 0.03065,-0.00328,-0.10826>
;
;Plot Index Range: 1239-1269
;Plot Range: 00:05:24.0928-00:05:24.1088
;The angle between DC-Field and the k-vector is :
;       87.542 +/- 2.507 degrees
;The eigenvalues ratios are:
;       19.958299       6.3668484
;The Minimum Variance eigenvector is:
;<-0.85966,-0.45820, 0.22593> +/- <-0.05333, 0.11188, 0.02399>
;
;Plot Index Range: 1350-1380
;Plot Range: 00:05:24.1520-00:05:24.1680
;The angle between DC-Field and the k-vector is :
;       86.561 +/- 2.583 degrees
;The eigenvalues ratios are:
;       18.911881       7.4812368
;The Minimum Variance eigenvector is:
;<-0.61446,-0.53876, 0.57634> +/- < 0.10107,-0.06170, 0.05008>
;
;Plot Index Range: 1392-1425
;Plot Range: 00:05:24.1744-00:05:24.1920
;The angle between DC-Field and the k-vector is :
;       82.705 +/- 2.623 degrees
;The eigenvalues ratios are:
;       16.849003       3.5171536
;The Minimum Variance eigenvector is:
;< 0.73035, 0.06084, 0.68036> +/- <-0.05178, 0.12412, 0.04449>
;
;Plot Index Range: 1800-1845
;Plot Range: 00:05:24.3920-00:05:24.4160
;The angle between DC-Field and the k-vector is :
;       78.896 +/- 1.613 degrees
;The eigenvalues ratios are:
;       30.640212       3.9227568
;The Minimum Variance eigenvector is:
;< 0.92761, 0.31431,-0.20189> +/- < 0.03123,-0.08937, 0.00433>
;



struct0 = stats_092498_0005x23_40_200
nplots  = N_TAGS(struct0)
tr_ss   = STRARR(nplots)
kv_ss   = STRARR(nplots)
dkv_ss  = STRARR(nplots)
eig_ss  = STRARR(nplots)
pr_str  = ',prefd[0]+'
tr_pre  = '     = time_double([prefd[0]+'
dv_0s   = '])'
kv_0s   = ']'

FOR j=0L, nplots - 1L DO BEGIN                                            $
  tr_0p = 'tr'+STRTRIM(j,2L)                                            & $
  tr_00 = time_string(struct0.(j).TRANGE,PREC=4)                        & $
  tr_01 = STRMID(tr_00[*],11L)                                          & $
  test  = tr_0p[0]+tr_pre[0]+"'"+tr_01[0]+"'"+pr_str[0]+"'"+tr_01[1]+"'"+dv_0s[0]  & $
  tr_ss[j] = test[0]

kvform = '(f8.5,",",f8.5,",",f8.5)'
FOR j=0L, nplots - 1L DO BEGIN                                            $
  kv_0p = 'kvec'+STRTRIM(j,2L)+'   = ['                                 & $
  kv_00 = struct0.(j).MVA.EIGENVECTORS[*,0]                             & $
  kv_01 = STRING(FORMAT=kvform,kv_00)                                   & $
  test  = kv_0p[0]+kv_01+kv_0s[0]                                       & $
  kv_ss[j] = test[0]

FOR j=0L, nplots - 1L DO BEGIN                                            $
  dv_0p = 'dkvec'+STRTRIM(j,2L)+'  = ABS(['                             & $
  dv_00 = struct0.(j).MVA.DMIN_VEC                                      & $
  dv_01 = STRING(FORMAT=kvform,kv_00)                                   & $
  test  = dv_0p[0]+dv_01+dv_0s[0]                                       & $
  dkv_ss[j] = test[0]

eform = '(g,",",g)'
FOR j=0L, nplots - 1L DO BEGIN                                            $
  eg_0p = 'elam'+STRTRIM(j,2L)+'   = ['                                 & $
  eg_mx = struct0.(j).MVA.EIGENVALUES[0]                                & $
  eg_md = struct0.(j).MVA.EIGENVALUES[1]                                & $
  eg_mn = struct0.(j).MVA.EIGENVALUES[2]                                & $
  er_00 = FLOAT([eg_md/eg_mn,eg_mx/eg_md])                              & $
  er_01 = STRCOMPRESS(STRING(FORMAT=eform,er_00),/REMOVE_ALL)           & $
  test  = eg_0p[0]+er_01+kv_0s[0]                                       & $
  eig_ss[j] = test[0]


PRINT, TRANSPOSE(tr_ss)
PRINT, TRANSPOSE(kv_ss)
PRINT, TRANSPOSE(dkv_ss)
PRINT, TRANSPOSE(eig_ss)

prefd   = '1998-09-25/'
tr0     = time_double([prefd[0]+'00:05:23.4592',prefd[0]+'00:05:23.4816'])
tr1     = time_double([prefd[0]+'00:05:23.5008',prefd[0]+'00:05:23.5162'])
tr2     = time_double([prefd[0]+'00:05:23.5328',prefd[0]+'00:05:23.5658'])
tr3     = time_double([prefd[0]+'00:05:23.6128',prefd[0]+'00:05:23.6234'])
tr4     = time_double([prefd[0]+'00:05:23.7376',prefd[0]+'00:05:23.7658'])
tr5     = time_double([prefd[0]+'00:05:23.7728',prefd[0]+'00:05:23.7904'])
tr6     = time_double([prefd[0]+'00:05:23.8208',prefd[0]+'00:05:23.8528'])
tr7     = time_double([prefd[0]+'00:05:23.9408',prefd[0]+'00:05:23.9834'])
tr8     = time_double([prefd[0]+'00:05:24.0405',prefd[0]+'00:05:24.0592'])
tr9     = time_double([prefd[0]+'00:05:24.0928',prefd[0]+'00:05:24.1088'])
tr10    = time_double([prefd[0]+'00:05:24.1520',prefd[0]+'00:05:24.1680'])
tr11    = time_double([prefd[0]+'00:05:24.1744',prefd[0]+'00:05:24.1920'])
tr12    = time_double([prefd[0]+'00:05:24.3920',prefd[0]+'00:05:24.4160'])

kvec0   = [ 0.74360, 0.52564,-0.41324]
kvec1   = [ 0.86050, 0.31942,-0.39688]
kvec2   = [-0.89009,-0.41376, 0.19116]
kvec3   = [-0.99850, 0.04916, 0.02395]
kvec4   = [ 0.83505, 0.46736,-0.29028]
kvec5   = [-0.77294,-0.61234, 0.16615]
kvec6   = [ 0.80826, 0.54728, 0.21726]
kvec7   = [-0.82616,-0.56179,-0.04289]
kvec8   = [-0.81419,-0.54185,-0.20858]
kvec9   = [-0.85966,-0.45820, 0.22593]
kvec10  = [-0.61446,-0.53876, 0.57634]
kvec11  = [ 0.73035, 0.06084, 0.68036]
kvec12  = [ 0.92761, 0.31431,-0.20189]

dkvec0  = ABS([ 0.92761, 0.31431,-0.20189])
dkvec1  = ABS([ 0.92761, 0.31431,-0.20189])
dkvec2  = ABS([ 0.92761, 0.31431,-0.20189])
dkvec3  = ABS([ 0.92761, 0.31431,-0.20189])
dkvec4  = ABS([ 0.92761, 0.31431,-0.20189])
dkvec5  = ABS([ 0.92761, 0.31431,-0.20189])
dkvec6  = ABS([ 0.92761, 0.31431,-0.20189])
dkvec7  = ABS([ 0.92761, 0.31431,-0.20189])
dkvec8  = ABS([ 0.92761, 0.31431,-0.20189])
dkvec9  = ABS([ 0.92761, 0.31431,-0.20189])
dkvec10 = ABS([ 0.92761, 0.31431,-0.20189])
dkvec11 = ABS([ 0.92761, 0.31431,-0.20189])
dkvec12 = ABS([ 0.92761, 0.31431,-0.20189])

elam0   = [46.37128,6.088881]
elam1   = [39.93233,3.328742]
elam2   = [69.55151,3.968775]
elam3   = [113.8069,4.732501]
elam4   = [16.63271,1.794867]
elam5   = [192.6935,1.209217]
elam6   = [22.42992,1.856203]
elam7   = [42.68345,3.854229]
elam8   = [34.09875,1.501903]
elam9   = [19.95830,6.366848]
elam10   = [18.91188,7.481237]
elam11   = [16.84900,3.517154]
elam12   = [30.64021,3.922757]

bvec0   = [-0.44980, 0.81470, 0.36598]
bvec1   = [-0.45408, 0.81098, 0.36894]
bvec2   = [-0.46143, 0.80812, 0.36609]
bvec3   = [-0.47723, 0.80474, 0.35306]
bvec4   = [-0.49707, 0.81869, 0.28746]
bvec5   = [-0.49867, 0.82524, 0.26513]
bvec6   = [-0.49376, 0.83808, 0.23194]
bvec7   = [-0.47667, 0.85745, 0.19380]
bvec8   = [-0.47226, 0.85910, 0.19727]
bvec9   = [-0.46694, 0.85972, 0.20699]
bvec10  = [-0.45506, 0.86160, 0.22489]
bvec11  = [-0.45103, 0.86311, 0.22718]
bvec12  = [-0.44884, 0.88664, 0.11090]
bmag0   = [22.28275]
bmag1   = [22.49725]
bmag2   = [22.69914]
bmag3   = [23.00872]
bmag4   = [23.96739]
bmag5   = [24.12446]
bmag6   = [24.17150]
bmag7   = [23.80768]
bmag8   = [23.46935]
bmag9   = [23.39295]
bmag10  = [23.48533]
bmag11  = [23.55203]
bmag12  = [23.96985]

tags    = ['t0','t1','t2','t3','t4','t5','t6','t7','t8','t9','t10','t11','t12']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,$
                        kvec9,kvec10,kvec11,kvec12)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,$
                        dkvec8,dkvec9,dkvec10,dkvec11,dkvec12)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  40 Hz < f < 200 Hz  at  1998-09-25/00:05:23.432 UT
;
;   00:05:23.4592-00:05:23.4816      0.744      0.526     -0.413     -0.450      0.815      0.366     22.283
;   00:05:23.5008-00:05:23.5162      0.860      0.319     -0.397     -0.454      0.811      0.369     22.497
;   00:05:23.5328-00:05:23.5658     -0.890     -0.414      0.191     -0.461      0.808      0.366     22.699
;   00:05:23.6128-00:05:23.6234     -0.998      0.049      0.024     -0.477      0.805      0.353     23.009
;   00:05:23.7376-00:05:23.7658      0.835      0.467     -0.290     -0.497      0.819      0.287     23.967
;   00:05:23.7728-00:05:23.7904     -0.773     -0.612      0.166     -0.499      0.825      0.265     24.124
;   00:05:23.8208-00:05:23.8528      0.808      0.547      0.217     -0.494      0.838      0.232     24.172
;   00:05:23.9408-00:05:23.9834     -0.826     -0.562     -0.043     -0.477      0.857      0.194     23.808
;   00:05:24.0405-00:05:24.0592     -0.814     -0.542     -0.209     -0.472      0.859      0.197     23.469
;   00:05:24.0928-00:05:24.1088     -0.860     -0.458      0.226     -0.467      0.860      0.207     23.393
;   00:05:24.1520-00:05:24.1680     -0.614     -0.539      0.576     -0.455      0.862      0.225     23.485
;   00:05:24.1744-00:05:24.1920      0.730      0.061      0.680     -0.451      0.863      0.227     23.552
;   00:05:24.3920-00:05:24.4160      0.928      0.314     -0.202     -0.449      0.887      0.111     23.970

vswu   = [-720.792,7.078,-38.687]         ; => My 3DP estimates (km/s) For 1998-09-25/00:05:23.432 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  40 Hz < f < 200 Hz  at  1998-09-25/00:05:23.432 UT
;
;   00:05:23.4592-00:05:23.4816     93.294     86.706    130.872     49.128    135.659     44.341
;   00:05:23.5008-00:05:23.5162    106.148     73.852    136.173     43.827    146.597     33.403
;   00:05:23.5328-00:05:23.5658     81.586     98.414     32.925    147.075     29.018    150.982
;   00:05:23.6128-00:05:23.6234     58.364    121.636     26.665    153.335      4.986    175.014
;   00:05:23.7376-00:05:23.7658     96.655     83.345    140.091     39.909    144.456     35.544
;   00:05:23.7728-00:05:23.7904     94.349     85.651     38.323    141.677     40.810    139.190
;   00:05:23.8208-00:05:23.8528     83.686     96.314    158.945     21.055    144.423     35.577
;   00:05:23.9408-00:05:23.9834     95.521     84.479     26.705    153.295     34.742    145.258
;   00:05:24.0405-00:05:24.0592     97.016     82.984     20.852    159.148     35.031    144.969
;   00:05:24.0928-00:05:24.1088     86.890     93.110     35.954    144.046     32.671    147.329
;   00:05:24.1520-00:05:24.1680     93.151     86.849     61.078    118.922     54.734    125.266
;   00:05:24.1744-00:05:24.1920     97.027     82.973    155.913     24.087    139.919     40.081
;   00:05:24.3920-00:05:24.4160     99.211     80.789    148.010     31.990    155.829     24.171

theta_kb0924_40_200   = DBLARR(nn)
theta_kn0924_40_200   = DBLARR(nn)
theta_kv0924_40_200   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_40_200[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_40_200[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_40_200[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_40_200[j]),  $
                     REFORM(theta_kn0924_40_200[j]),$
                     REFORM(theta_kv0924_40_200[j])
;
; => For  40 Hz < f < 200 Hz  at  1998-09-25/00:05:23.432 UT
;
;   00:05:23.4592-00:05:23.4816     86.706     49.128     44.341
;   00:05:23.5008-00:05:23.5162     73.852     43.827     33.403
;   00:05:23.5328-00:05:23.5658     81.586     32.925     29.018
;   00:05:23.6128-00:05:23.6234     58.364     26.665      4.986
;   00:05:23.7376-00:05:23.7658     83.345     39.909     35.544
;   00:05:23.7728-00:05:23.7904     85.651     38.323     40.810
;   00:05:23.8208-00:05:23.8528     83.686     21.055     35.577
;   00:05:23.9408-00:05:23.9834     84.479     26.705     34.742
;   00:05:24.0405-00:05:24.0592     82.984     20.852     35.031
;   00:05:24.0928-00:05:24.1088     86.890     35.954     32.671
;   00:05:24.1520-00:05:24.1680     86.849     61.078     54.734
;   00:05:24.1744-00:05:24.1920     82.973     24.087     40.081
;   00:05:24.3920-00:05:24.4160     80.789     31.990     24.171

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_40_200
PRINT,FORMAT=tkbf,theta_kn0924_40_200
PRINT,FORMAT=tkbf,theta_kv0924_40_200

theta_kb0924_40_200 = [86.71,73.85,81.59,58.36,83.34,85.65,83.69,84.48,82.98,86.89,86.85,82.97,80.79]
theta_kn0924_40_200 = [49.13,43.83,32.92,26.66,39.91,38.32,21.05,26.71,20.85,35.95,61.08,24.09,31.99]
theta_kv0924_40_200 = [44.34,33.40,29.02, 4.99,35.54,40.81,35.58,34.74,35.03,32.67,54.73,40.08,24.17]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24


;-----------------------------------------------------------------------------------------
;-----------------------------------------------------------------------------------------
jj      = 13L
dumbmag = magf_htr
tt_tds  = [MIN(REFORM(unx_t0[jj,*]),/NAN),MAX(REFORM(unx_t0[jj,*]),/NAN)]
tmagfx  = MEAN(interp(dumbmag.Y[*,0],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfy  = MEAN(interp(dumbmag.Y[*,1],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
tmagfz  = MEAN(interp(dumbmag.Y[*,2],dumbmag.X,tt_tds,/NO_EXTRAP),/NAN)
dumb_tt = [tt_tds[0],MEAN(tt_tds,/NAN),tt_tds[1]]
dumb_mf = REFORM(REPLICATE(1d0,3L) # [tmagfx,tmagfy,tmagfz])
dumbmfi = {X:dumb_tt,Y:dumb_mf}
dumb_bm = SQRT(TOTAL(dumb_mf^2,2L,/NAN))
dumb_bv = REFORM(dumb_mf[0,*])/dumb_bm[0]

htrmfit = REFORM(t_mag0.GTIME[jj,*])      ; => Unix Time for HTR MFI data
htrmagf = REFORM(t_mag0.GHTR[jj,*,*])       ; => GSE HTR MFI (nT)
htrbmag = SQRT(TOTAL(htrmagf^2,2,/NAN))

dummy0  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(0)}
dummy1  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(1)}
dummy2  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(2)}
dummy3  = {X:REFORM(unx_t0[jj,*]),Y:rotated_gse_bf.(jj).(3)}

lfc0    = lf_str.(jj)
hfc0    = hf_str.(jj)
print, lfc0, format='(";",8f10.1)'
;       3.0       7.0      10.0      20.0
print, hfc0, format='(";",8f10.1)'
;      30.0      50.0     100.0     100.0

date = '092598'
vector_mv_plot,DATE=date,MYMAG=dummy0,FCUTOFF=[lfc0[0],hfc0[0]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi,STATS=stats_092498_0014x50_3_30

vector_mv_plot,DATE=date,MYMAG=dummy1,FCUTOFF=[lfc0[1],hfc0[1]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi,STATS=stats_092498_0014x50_7_50

vector_mv_plot,DATE=date,MYMAG=dummy3,FCUTOFF=[lfc0[3],hfc0[3]],$
               SAT='W',COORD='GSE',FIELD='B',DCBKGF=dumbmfi,STATS=stats_092498_0014x50_20_100

bvec0   = [-0.37595, 0.77556,-0.50711]
bmag0   = [22.95625]
;-----------------------------------------------------------------------------------------
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:14:50.603 UT
;-----------------------------------------------------------------------------------------
;Plot Index Range: 84-188
;Plot Range: 00:14:50.6478-00:14:50.7033
;The angle between DC-Field and the k-vector is :
;       75.475 +/- 0.804 degrees
;The eigenvalues ratios are:
;       51.327906       2.2907179
;The Minimum Variance eigenvector is:
;< 0.74314,-0.33136,-0.58133> +/- <-0.03560,-0.04884,-0.01767>
;
;Plot Index Range: 578-774
;Plot Range: 00:14:50.9113-00:14:51.0158
;The angle between DC-Field and the k-vector is :
;       80.991 +/- 0.637 degrees
;The eigenvalues ratios are:
;       43.491754       1.4764691
;The Minimum Variance eigenvector is:
;<-0.97299,-0.20495, 0.10626> +/- < 0.01454,-0.05258, 0.03176>
;
;Plot Index Range: 1461-1574
;Plot Range: 00:14:51.3822-00:14:51.4425
;The angle between DC-Field and the k-vector is :
;       72.445 +/- 1.412 degrees
;The eigenvalues ratios are:
;       16.630861       1.4983201
;The Minimum Variance eigenvector is:
;< 0.76670, 0.56290,-0.30871> +/- <-0.07352, 0.06160,-0.07026>
;
;Plot Index Range: 1663-1809
;Plot Range: 00:14:51.4899-00:14:51.5678
;The angle between DC-Field and the k-vector is :
;       53.916 +/- 0.621 degrees
;The eigenvalues ratios are:
;       60.748220       1.5201733
;The Minimum Variance eigenvector is:
;<-0.82809,-0.00588,-0.56056> +/- < 0.03192, 0.00258,-0.04718>
;
;Plot Index Range: 1957-2047
;Plot Range: 00:14:51.6467-00:14:51.6947
;The angle between DC-Field and the k-vector is :
;       83.469 +/- 0.419 degrees
;The eigenvalues ratios are:
;       211.99740       7.5379725
;The Minimum Variance eigenvector is:
;< 0.76815, 0.62058, 0.15759> +/- < 0.01718,-0.02224, 0.00384>
;

struct0 = stats_092498_0014x50_3_30
nplots  = N_TAGS(struct0)
tr_ss   = STRARR(nplots)
kv_ss   = STRARR(nplots)
dkv_ss  = STRARR(nplots)
eig_ss  = STRARR(nplots)
pr_str  = ',prefd[0]+'
tr_pre  = '     = time_double([prefd[0]+'
dv_0s   = '])'
kv_0s   = ']'

FOR j=0L, nplots - 1L DO BEGIN                                            $
  tr_0p = 'tr'+STRTRIM(j,2L)                                            & $
  tr_00 = time_string(struct0.(j).TRANGE,PREC=4)                        & $
  tr_01 = STRMID(tr_00[*],11L)                                          & $
  test  = tr_0p[0]+tr_pre[0]+"'"+tr_01[0]+"'"+pr_str[0]+"'"+tr_01[1]+"'"+dv_0s[0]  & $
  tr_ss[j] = test[0]

kvform = '(f8.5,",",f8.5,",",f8.5)'
FOR j=0L, nplots - 1L DO BEGIN                                            $
  kv_0p = 'kvec'+STRTRIM(j,2L)+'   = ['                                 & $
  kv_00 = struct0.(j).MVA.EIGENVECTORS[*,0]                             & $
  kv_01 = STRING(FORMAT=kvform,kv_00)                                   & $
  test  = kv_0p[0]+kv_01+kv_0s[0]                                       & $
  kv_ss[j] = test[0]

FOR j=0L, nplots - 1L DO BEGIN                                            $
  dv_0p = 'dkvec'+STRTRIM(j,2L)+'  = ABS(['                             & $
  dv_00 = struct0.(j).MVA.DMIN_VEC                                      & $
  dv_01 = STRING(FORMAT=kvform,kv_00)                                   & $
  test  = dv_0p[0]+dv_01+dv_0s[0]                                       & $
  dkv_ss[j] = test[0]

eform = '(g,",",g)'
FOR j=0L, nplots - 1L DO BEGIN                                            $
  eg_0p = 'elam'+STRTRIM(j,2L)+'   = ['                                 & $
  eg_mx = struct0.(j).MVA.EIGENVALUES[0]                                & $
  eg_md = struct0.(j).MVA.EIGENVALUES[1]                                & $
  eg_mn = struct0.(j).MVA.EIGENVALUES[2]                                & $
  er_00 = FLOAT([eg_md/eg_mn,eg_mx/eg_md])                              & $
  er_01 = STRCOMPRESS(STRING(FORMAT=eform,er_00),/REMOVE_ALL)           & $
  test  = eg_0p[0]+er_01+kv_0s[0]                                       & $
  eig_ss[j] = test[0]


PRINT, TRANSPOSE(tr_ss)
PRINT, TRANSPOSE(kv_ss)
PRINT, TRANSPOSE(dkv_ss)
PRINT, TRANSPOSE(eig_ss)

prefd   = '1998-09-25/'
tr0     = time_double([prefd[0]+'00:14:50.6478',prefd[0]+'00:14:50.7032'])
tr1     = time_double([prefd[0]+'00:14:50.9112',prefd[0]+'00:14:51.0158'])
tr2     = time_double([prefd[0]+'00:14:51.3822',prefd[0]+'00:14:51.4424'])
tr3     = time_double([prefd[0]+'00:14:51.4899',prefd[0]+'00:14:51.5678'])
tr4     = time_double([prefd[0]+'00:14:51.6467',prefd[0]+'00:14:51.6947'])

kvec0   = [ 0.74314,-0.33136,-0.58133]
kvec1   = [-0.97299,-0.20495, 0.10626]
kvec2   = [ 0.76670, 0.56290,-0.30871]
kvec3   = [-0.82809,-0.00588,-0.56056]
kvec4   = [ 0.76815, 0.62058, 0.15759]

dkvec0  = ABS([ 0.76815, 0.62058, 0.15759])
dkvec1  = ABS([ 0.76815, 0.62058, 0.15759])
dkvec2  = ABS([ 0.76815, 0.62058, 0.15759])
dkvec3  = ABS([ 0.76815, 0.62058, 0.15759])
dkvec4  = ABS([ 0.76815, 0.62058, 0.15759])

elam0   = [51.32791,2.290718]
elam1   = [43.49175,1.476469]
elam2   = [16.63086,1.498320]
elam3   = [60.74822,1.520173]
elam4   = [211.9974,7.537972]

bvec0   = [-0.38238, 0.77342,-0.50559]
bvec1   = [-0.38277, 0.76930,-0.51153]
bvec2   = [-0.37472, 0.78302,-0.49644]
bvec3   = [-0.37477, 0.78392,-0.49498]
bvec4   = [-0.37646, 0.78298,-0.49519]
bmag0   = [23.57741]
bmag1   = [23.49861]
bmag2   = [23.38134]
bmag3   = [23.16161]
bmag4   = [22.82554]

tags    = ['t0','t1','t2','t3','t4']
tr_str  = CREATE_STRUCT(tags,tr0,tr1,tr2,tr3,tr4)
kv_str  = CREATE_STRUCT(tags,kvec0,kvec1,kvec2,kvec3,kvec4)
dkv_str = CREATE_STRUCT(tags,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4)
nn      = N_TAGS(tr_str)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  tr_00  = tr_str.(j)                                               & $
  good   = WHERE(htrmfit LE tr_00[1] AND htrmfit GE tr_00[0],gd)    & $
  avgbm  = MEAN(htrbmag[good],/NAN)                                 & $
  avmagx = MEAN(htrmagf[good,0],/NAN)                               & $
  avmagy = MEAN(htrmagf[good,1],/NAN)                               & $
  avmagz = MEAN(htrmagf[good,2],/NAN)                               & $
  avbvec = [avmagx,avmagy,avmagz]/avgbm[0]                          & $
  trs000 = time_string(tr_str.(j),PREC=4)                           & $
  trs001 = STRMID(trs000[*],11L,13L)                                & $
  t_rang = trs001[0]+'-'+trs001[1]                                  & $
  str_element,bv_str,jstr,avbvec,/ADD_REPLACE                       & $
  str_element,bm_str,jstr,avgbm,/ADD_REPLACE                        & $
  str_element,st_str,jstr,t_rang,/ADD_REPLACE

mform = '(";",a30,7f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(kv_str.(j)),           $
                     REFORM(bv_str.(j)),REFORM(bm_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:14:50.603 UT
;
;   00:14:50.6478-00:14:50.7032      0.743     -0.331     -0.581     -0.382      0.773     -0.506     23.577
;   00:14:50.9112-00:14:51.0158     -0.973     -0.205      0.106     -0.383      0.769     -0.512     23.499
;   00:14:51.3822-00:14:51.4424      0.767      0.563     -0.309     -0.375      0.783     -0.496     23.381
;   00:14:51.4899-00:14:51.5678     -0.828     -0.006     -0.561     -0.375      0.784     -0.495     23.162
;   00:14:51.6467-00:14:51.6947      0.768      0.621      0.158     -0.376      0.783     -0.495     22.826

vswu   = [-715.282,-40.280,-30.922]         ; => My 3DP estimates (km/s) For 1998-09-25/00:14:50.603 UT
vswuv  = vswu/(NORM(vswu))[0]
nvc00  = REFORM(gnorm)
FOR j=0L, nn - 1L DO BEGIN                                            $
  jstr   = 'T'+STRTRIM(j,2L)                                        & $
  mag00  = REFORM(bv_str.(j))                                       & $
  kvc00  = REFORM(kv_str.(j))                                       & $
  thkb0  = ACOS(my_dot_prod(kvc00,mag00,/NOM))*18d1/!DPI            & $
  thkb1  = 18d1 - thkb0[0]                                          & $
  thkn0  = ACOS(my_dot_prod(kvc00,nvc00,/NOM))*18d1/!DPI            & $
  thkn1  = 18d1 - thkn0[0]                                          & $
  thkv0  = ACOS(my_dot_prod(kvc00,vswuv,/NOM))*18d1/!DPI            & $
  thkv1  = 18d1 - thkv0[0]                                          & $
  str_element,thkb_str,jstr,[thkb0,thkb1],/ADD_REPLACE              & $
  str_element,thkn_str,jstr,[thkn0,thkn1],/ADD_REPLACE              & $
  str_element,thkv_str,jstr,[thkv0,thkv1],/ADD_REPLACE

mform = '(";",a30,6f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                            $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(thkb_str.(j)),         $
                     REFORM(thkn_str.(j)),REFORM(thkv_str.(j))
;
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:14:50.603 UT
;
;   00:14:50.6478-00:14:50.7032    104.272     75.728    114.085     65.915    134.234     45.766
;   00:14:50.9112-00:14:51.0158     80.769     99.231     26.082    153.918     12.183    167.817
;   00:14:51.3822-00:14:51.4424     72.138    107.862    135.999     44.001    141.544     38.456
;   00:14:51.4899-00:14:51.5678     54.324    125.676     18.319    161.681     31.732    148.268
;   00:14:51.6467-00:14:51.6947     83.184     96.816    153.171     26.829    143.889     36.111

theta_kb0924_03_30_9   = DBLARR(nn)
theta_kn0924_03_30_9   = DBLARR(nn)
theta_kv0924_03_30_9   = DBLARR(nn)
FOR j=0L, nn - 1L DO BEGIN                                                         $
  theta_kb0924_03_30_9[j]   = REFORM(thkb_str.(j)[0]) < REFORM(thkb_str.(j)[1])    & $
  theta_kn0924_03_30_9[j]   = REFORM(thkn_str.(j)[0]) < REFORM(thkn_str.(j)[1])    & $
  theta_kv0924_03_30_9[j]   = REFORM(thkv_str.(j)[0]) < REFORM(thkv_str.(j)[1])

mform = '(";",a30,3f11.3)'
FOR j=0L, nn - 1L DO BEGIN                                              $
  PRINT,FORMAT=mform,REFORM(st_str.(j)),REFORM(theta_kb0924_03_30_9[j]),  $
                     REFORM(theta_kn0924_03_30_9[j]),$
                     REFORM(theta_kv0924_03_30_9[j])
;
; => For  3 Hz < f < 30 Hz  at  1998-09-25/00:14:50.603 UT
;
;   00:14:50.6478-00:14:50.7032     75.728     65.915     45.766
;   00:14:50.9112-00:14:51.0158     80.769     26.082     12.183
;   00:14:51.3822-00:14:51.4424     72.138     44.001     38.456
;   00:14:51.4899-00:14:51.5678     54.324     18.319     31.732
;   00:14:51.6467-00:14:51.6947     83.184     26.829     36.111

tkbf = '("[",'
FOR k=0L, nn - 1L DO BEGIN                                                      $
  tkbf += 'f5.2,",",' & $
  IF (k EQ nn - 1L) THEN tkbf = STRMID(tkbf,0L,STRLEN(tkbf)-4L)+'"]")'
  
PRINT,FORMAT=tkbf,theta_kb0924_03_30_9
PRINT,FORMAT=tkbf,theta_kn0924_03_30_9
PRINT,FORMAT=tkbf,theta_kv0924_03_30_9

theta_kb0924_03_30_9 = [75.73,80.77,72.14,54.32,83.18]
theta_kn0924_03_30_9 = [65.91,26.08,44.00,18.32,26.83]
theta_kv0924_03_30_9 = [45.77,12.18,38.46,31.73,36.11]

DELVAR,tr0,tr1,tr2,tr3,tr4,tr5,tr6,tr7,tr8,tr9,tr10,tr11,tr12,tr13,tr14,tr15,tr16,tr17,tr18,tr19,tr20,tr21,tr22,tr23,tr24
DELVAR,kvec0,kvec1,kvec2,kvec3,kvec4,kvec5,kvec6,kvec7,kvec8,kvec9,kvec10,kvec11,kvec12,kvec13,kvec14,kvec15,kvec16,kvec17,kvec18,kvec19,kvec20,kvec21,kvec22,kvec23,kvec24
DELVAR,dkvec0,dkvec1,dkvec2,dkvec3,dkvec4,dkvec5,dkvec6,dkvec7,dkvec8,dkvec9,dkvec10,dkvec11,dkvec12,dkvec13,dkvec14,dkvec15,dkvec16,dkvec17,dkvec18,dkvec19,dkvec20,dkvec21,dkvec22,dkvec23,dkvec24



































